(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{183:function(t,e,i){"use strict";e.a={POST_SUBSCRIBE:"/frontend/user/order-activity",GET_LIVEINFO:"/frontend/live/info",GET_SHAREINFO:"/frontend/share/info",GET_QUESTIONINFO:"/frontend/question/info",POST_QUESTIONINFO:"/frontend/user/apply-activity",GET_CREATEACCESSTOKEN:"/common/paas/create-access-token",GET_ONLINENUM:"/frontend/channel/get-online-num",GET_SHARESIGN:"/common/wechat/get-share-sign",GET_SDKTOKEN:"/frontend/live/sdk-token",GET_SEND:"/index/send",GET_SENDANNOUNCEMENT:"/initiator/channel/send-announcement",POST_GAG:"/initiator/user/gag",POST_GAGALL:"/initiator/user/gag-all",POST_KICK:"/initiator/user/kick",POST_EMAILSUBSCRIBE:"/frontend/user/email-subscribe",GET_MESSAGELIST:"/common/paas/message-list",GET_CAPTCHAID:"/common/message/get-captchaid",GET_CODE:"/common/message/send-code",GET_TEMPLATE:"/frontend/live/template",GET_DEFAULEREPLAY:"/frontend/replay/default-replay",GET_WARMINFO:"/manage/warm-up-manage/get"}},184:function(t,e,i){},185:function(t,e,i){"use strict";var a=i(7),s=i.n(a),o=i(11),n=i.n(o),l=i(0),r=i.n(l),c=i(46),h=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"login-container"},[i("com-dialog",{attrs:{visible:t.visible,center:""},on:{"update:visible":function(e){t.visible=e},close:t.closed}},[i("div",[i("div",{staticClass:"rule"},[t._v("登录参与直播互动")]),t._v(" "),i("com-input",{staticClass:"mobile",attrs:{type:"input",placeholder:"请输入手机"},model:{value:t.mobile,callback:function(e){t.mobile=e},expression:"mobile"}}),t._v(" "),i("div",{attrs:{id:"captcha"}}),t._v(" "),i("com-input",{staticClass:"code",attrs:{type:"input",placeholder:"请输入验证码"},model:{value:t.code,callback:function(e){t.code=e},expression:"code"}}),t._v(" "),i("com-button",{staticClass:"codeBtn",attrs:{disabled:!t.codeEnable,type:"primary"},on:{click:t.getCode}},[t._v(t._s(t.codeText))])],1),t._v(" "),i("div",{staticClass:"footer",attrs:{slot:"footer"},slot:"footer"},[i("com-button",{attrs:{type:"primary",disabled:!t.submitEnable},on:{click:t.doLogin}},[t._v("登录")])],1)])],1)};h._withStripped=!0;var d=i(183),u=i(58),p={name:"ComLogin",data:()=>({visible:!1,time:60,captchaIns:null,key:null,verify:!1,mobile:"",code:"",mobileReg:/^1[3|4|5|6|7|8|9][0-9]\d{8}$/,captchaKey:""}),mounted(){this.$get(d.a.GET_CAPTCHAID).then(t=>{this.key=t.data,window.initNECaptcha({element:"#captcha",mode:"float",width:"100%",captchaId:this.key,onVerify:(t,e)=>{t?console.log(t):(this.verify=!0,this.captchaKey=e.validate)}},t=>{this.captchaIns=t},t=>{console.log(t)})})},methods:{getCode(){this.$config({handlers:!0}).$get(d.a.GET_CODE,{mobile:this.mobile,type:"CONSUMER_USER_LOGIN",captcha:this.captchaKey,__errHandler:!0}).then(t=>{this.time--,this.timer=setInterval(()=>{this.time--,0===this.time&&(clearInterval(this.timer),this.time=60)},1e3),console.log(t)})},doLogin(){this.$config({handlers:!0}).$post(u.a.POST_MOBILELOGIN,{mobile:this.mobile,code:this.code,wechatAuth:sessionStorage.getItem("wechatAuth"),__errHandler:!0}).then(t=>{this.$parent.updateLoginInfo(t.data),this.visible=!1,this.closed(),this.$emit("login",t.data)}).catch(()=>{this.verify=!1,this.captchaKey="",this.captchaIns.refresh()})},closed(){this.mobile="",this.time=60,this.verify=!1,this.captchaKey="",this.captchaIns.refresh(),clearInterval(this.timer)}},computed:{codeText(){return this.codeEnable||60===this.time?"发送验证码":`倒计时${this.time}秒`},codeEnable(){return this.mobileReg.test(this.mobile)&&this.verify&&60===this.time},submitEnable(){return this.mobileReg.test(this.mobile)&&this.verify&&this.code}}},v=(i(186),i(1)),m=Object(v.a)(p,h,[],!1,null,"9f4e7bf2",null);m.options.__file="src/components/login-box.vue";var g=m.exports;r.a.use(c.a);const y=new r.a;e.a={components:{ComLogin:g},data:()=>({login:null}),mounted(){this.login=this.$children.find(t=>"ComLogin"===t.$options.name),this.$route.meta.pop&&(this.$route.meta.pop=!1,this.login.visible=!0)},methods:{getAuthInfo:()=>sessionStorage.getItem("wechatAuth"),getLoginInfo:()=>JSON.parse(sessionStorage.getItem("login")),doAuth(t){let e=location.href;t&&(e=t),sessionStorage.getItem("wechatAuth")?location.href=e:(console.log(e),location.href=`/api/frontend/user/wechat-login?backUrl=${encodeURIComponent(e)}`)},doLogin(t){if(sessionStorage.getItem("wechatAuth"))this.login.visible=!0;else{let e=location.href;"string"==typeof t&&(e=t),-1===e.indexOf("?")?e+="?_pop=true":e+="&_pop=true",location.href=`/api/frontend/user/wechat-login?backUrl=${encodeURIComponent(e)}`}},updateLoginInfo(t){t?sessionStorage.setItem("login",n()(t)):(sessionStorage.removeItem("login"),sessionStorage.removeItem("wechatAuth"))},getMasterInfo:t=>new s.a((t,e)=>{sessionStorage.getItem("master")?t(JSON.parse(sessionStorage.getItem("master"))):y.$config({loading:!0,handlers:!0}).$get(u.a.GET_JOININFO).then(e=>{sessionStorage.setItem("master",n()(e.data)),t(e.data)}).catch(t=>{e(t)})})}}},186:function(t,e,i){"use strict";var a=i(184);i.n(a).a},190:function(t,e,i){"use strict";e.a={onLineNum:"INCREMENT_ONLINE",announcement:"ANNOUNCEMENT",kick:"KICK",gag:"GAG",gagAll:"GAG_ALL",beginLive:"BEGIN_LIVE",endLive:"FINISH_LIVE"}},191:function(t,e,i){"use strict";i.d(e,"a",function(){return o});var a=i(179),s=i.n(a);function o(t){s.a.config({debug:!1,appId:t.wxShareData.appId,timestamp:t.wxShareData.timestamp,nonceStr:t.wxShareData.nonceStr,signature:t.wxShareData.signature,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","onMenuShareQZone"]}),s.a.ready(function(){s.a.checkJsApi({jsApiList:["onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","onMenuShareQZone"],success:function(t){console.log(t.checkResult,789486)}}),s.a.onMenuShareTimeline({title:t.shareData.title,desc:t.shareDatadesc,link:t.shareDatalink+(t.shareUser.share_id?"?shareId="+t.shareUser.share_id+"-3":""),imgUrl:t.shareDataimgUrl,success:function(){},cancel:function(){}}),s.a.onMenuShareAppMessage({title:t.shareData.title,desc:t.shareData.desc,link:t.shareData.link+(t.shareUser.share_id?"?shareId="+t.shareUser.share_id+"-3":""),imgUrl:t.shareData.imgUrl,success:function(){},cancel:function(){}}),s.a.onMenuShareQQ({title:t.shareData.title,desc:t.shareData.desc,link:t.shareData.link+(t.shareUser.share_id?"?shareId="+t.shareUser.share_id+"-2":""),imgUrl:t.shareData.imgUrl,success:function(){},cancel:function(){}}),s.a.onMenuShareWeibo({title:t.shareData.title,desc:t.shareData.desc,link:t.shareData.link+(t.shareUser.share_id?"?shareId="+t.shareUser.share_id+"-1":""),imgUrl:t.shareData.imgUrl,success:function(){},cancel:function(){}}),s.a.onMenuShareQZone({title:t.shareData.title,desc:t.shareData.desc,link:t.shareData.link+(t.shareUser.share_id?"?shareId="+t.shareUser.share_id+"-2":""),imgUrl:t.shareData.imgUrl,success:function(){},cancel:function(){}})}),s.a.error(function(t){console.log(t,6666)})}},192:function(t,e,i){t.exports=i.p+"static/img/success@2x.png"},205:function(t,e,i){},206:function(t,e,i){},207:function(t,e,i){},208:function(t,e,i){},209:function(t,e,i){},210:function(t,e,i){},243:function(t,e,i){t.exports=i.p+"static/img/qq.png"},244:function(t,e,i){"use strict";var a=i(205);i.n(a).a},246:function(t,e,i){"use strict";var a=i(206);i.n(a).a},248:function(t,e,i){"use strict";var a=i(207);i.n(a).a},250:function(t,e,i){"use strict";var a=i(208);i.n(a).a},252:function(t,e,i){"use strict";var a=i(209);i.n(a).a},254:function(t,e,i){"use strict";var a=i(210);i.n(a).a},288:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"v-watch"},[t.domShow?a("div",{staticClass:"v-hearder clearfix",on:{orientationchange:function(e){t.orientationchange(e)}}},[a("span",{staticClass:"v-status"},["直播中"===t.activityStatus?a("i"):t._e(),t._v(t._s(t.activityStatus)+"\n    ")]),t._v(" "),"直播中"===t.activityStatus?a("span",{staticClass:"v-onlineNum"},[t._v(t._s(t.showPersonCount)+"人在线")]):t._e(),t._v(" "),a("a",{staticClass:"fr v-my",attrs:{href:"/site/"+t.activityId}},[a("i",{staticClass:"v-showpsd iconfont icon-wode_icon"}),t._v("我的")]),t._v(" "),a("a",{staticClass:"fr",attrs:{href:"javascript:;"},on:{click:function(e){t.subscribe()}}},[a("i",{staticClass:"v-showpsd iconfont icon-dingyue_icon"}),t._v("订阅")])]):t._e(),t._v(" "),a(t.currentView,{tag:"component",attrs:{paasParams:t.vhallParams,domShow:t.domShow}}),t._v(" "),a("message-box",{directives:[{name:"show",rawName:"v-show",value:t.subscribeShow,expression:"subscribeShow"}],on:{handleClick:function(e){t.subscribeClick(e)}}},[a("div",{attrs:{slot:"header"},slot:"header"}),t._v(" "),a("img",{staticClass:"v-logo",attrs:{src:i(243),alt:""}}),t._v(" "),a("p",{staticClass:"v-title"},[t._v("\n      北京微吼时代科技有限公司\n    ")]),t._v(" "),a("div",{staticClass:"v-from"},[a("p",{staticClass:"v-explain"},[t._v("\n        请留下您的邮箱，我们会将更多的活动推送给您\n      ")]),t._v(" "),a("com-input",{attrs:{value:t.email,placeholder:"请输入邮箱","max-length":11,errorTips:t.errorTips},on:{"update:value":function(e){t.email=e},focus:function(e){t.emailFocus()}}})],1)]),t._v(" "),a("message-box",{directives:[{name:"show",rawName:"v-show",value:t.successShow,expression:"successShow"}],attrs:{autoClose:t.autoClose},on:{handleClick:t.successClick}},[a("div",{attrs:{slot:"header"},slot:"header"}),t._v(" "),a("img",{staticClass:"v-success",attrs:{src:i(192),alt:""}}),t._v(" "),a("p",{staticClass:"v-title v-success-title"},[t._v("\n      恭喜您，订阅成功！\n    ")])]),t._v(" "),a("com-login")],1)};a._withStripped=!0;var s=i(7),o=i.n(s),n=i(59),l=i.n(n),r=i(11),c=i.n(r),h=i(8),d=i.n(h),u=i(181),p=i.n(u),v=i(45),m=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticClass:"v-video"},[i("play-video",{attrs:{role:"watcher","play-type":t.playType,startInit:t.startInit}})],1),t._v(" "),t.domShow?i("div",{staticClass:"v-function-box"},[i("div",{staticClass:"v-nav"},[i("com-tabs",{attrs:{value:t.tabValue},on:{"update:value":function(e){t.tabValue=e},change:t.tabChange}},[i("com-tab",{attrs:{label:"活动简介",index:1}},[i("div",{staticClass:"v-introduction",domProps:{innerHTML:t._s(t.activityInfo.description)}})]),t._v(" "),i("com-tab",{attrs:{label:"互动聊天",index:2}},[i("div",{staticClass:"chat-content"},[i("chating",{ref:"chatbox",attrs:{type:t.playType,isWatch:t.isWatch,sendBoxShow:t.sendBoxShow},on:{closeChatBox:t.closeChatBox,isMute:function(e){t.isMute(e)}}})],1),t._v(" "),"live"===t.playType&&t.isLogin?[t.isMuteShow?[i("div",{staticClass:"v-chat-control v-noLogin",attrs:{id:"sendBoxBtn"}},[t._v("\n                "+t._s(t.allMuted?"已开启全体禁言":"您已被禁言")+"\n              ")])]:[i("div",{staticClass:"v-chat-control",attrs:{id:"sendBoxBtn"},on:{click:function(e){t.chatClick()}}},[i("i",{staticClass:"iconfont icon-biaoqing"}),t._v(" "),i("span",{staticClass:"v-chat-clickbox"},[t._v("\n                  输入文字聊天\n                ")])])]]:"live"!==t.playType||t.isLogin?t._e():[i("div",{staticClass:"v-chat-control v-noLogin",attrs:{id:"sendBoxBtn"}},[t._v("\n              需要登录才能参与聊天 "),i("span",{on:{click:t.doLogin}},[t._v("登录")])])]],2)],1),t._v(" "),t._m(0)],1)]):t._e(),t._v(" "),i("com-login",{on:{login:t.loginSuccess}})],1)};m._withStripped=!0;var g=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"play-container"},["live"==t.playType?i("div",{staticClass:"play-video-box",attrs:{id:t.playBoxId}}):"vod"==t.playType?i("div",{staticClass:"play-video-box",attrs:{id:t.playBoxId}},[i("div",{staticStyle:{width:"100%",height:"100%"},domProps:{innerHTML:t._s(this.outLineLink)}})]):"end"==t.playType?i("div",{staticClass:"play-video-box",attrs:{id:t.playBoxId}},[i("span",{staticClass:"end-box"},[t._v("直播已结束")])]):i("div",{staticClass:"play-video-box",attrs:{id:t.playBoxId}},[t.imageSrc?i("img",{attrs:{src:t.imageSrc}}):t._e()]),t._v(" "),t.playBtnShow?i("i",{staticClass:"iconfont icon-bofang",on:{click:t.playVideo}}):t._e(),t._v(" "),i("div",{staticClass:"control-box"},["vod"==t.playType&&!t.outLineLink||"warm"==t.playType?i("div",{staticClass:"control-video-box"},[i("video-control",{attrs:{currentTime:t.currentTime,totalTime:t.totalTime,qualitys:t.qualitys},on:{control:t.playControl}})],1):t._e()])])};g._withStripped=!0;class y{constructor(t,e,i){this.appId=t,this.rootEleId=e,this.token=i,this.type="",this._accountId=null,this.player=null}set accoundId(t){this._accountId=t}get accoundId(){return this._accountId}play(t=null){this.player.play(),t&&t()}pause(t=null){this.player.pause(),t&&t()}resume(t=null){this.player.play(),t&&t()}getQuality(){return this.player.getQuality()}setQuality(t,e=null){this.player.setQuality(t),e&&e()}setFullScreen(t,e=null){this.player.setFullScreen(t),e&&e()}isFullscreen(){return this.player.isFullscreen()}set volume(t){this.player.setVolume(t)}set width(t){this.player.setWidth(t)}set height(t){this.player.setHeight(t)}get netWorkState(){return this.player.getNetworkState()}destroy(){this.player&&this.player.destroy()}}var f=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"control-box"},[i("div",{staticClass:"auto-box",staticStyle:{display:"flex"}},[i("div",{staticClass:"mode-item fl",on:{click:t.playEvent}},[t.isPlay?i("i",{staticClass:"iconfont icon-zanting_icon"}):i("i",{staticClass:"iconfont icon-bofang_icon"})]),t._v(" "),i("div",{staticClass:"mode-item time-box"},[i("span",[t._v(t._s(t.currentDate))]),i("span",[t._v("/"+t._s(t.allDate))])]),t._v(" "),i("div",{staticClass:"mode-item",staticStyle:{flex:"1"}},[i("div",{staticClass:"progress-box"},[i("el-slider",{attrs:{"format-tooltip":t.formatTooltip},on:{change:t.changeVal},model:{value:t.progress,callback:function(e){t.progress=e},expression:"progress"}})],1)]),t._v(" "),i("div",{staticClass:"mode-item fr",on:{mouseover:function(e){return e.stopPropagation(),t.overEvent(e)},mouseout:function(e){return e.stopPropagation(),t.outEvent(e)}}},[i("span",{staticClass:"quality-info"},[t._v("画质")]),t._v(" "),i("transition",{attrs:{name:"fade"}},[t.showQualityBlock?i("div",{staticClass:"qualitys-box"},t._l(t.qualitys,function(e,a){return i("span",{class:{"quality-item":!0,active:t.selectQuality==a},on:{click:function(e){t.selectQuality=a}}},[t._v(t._s(e))])})):t._e()])],1),t._v(" "),i("div",{staticClass:"mode-item fr"},[i("i",{staticClass:"iconfont icon-zuidahua_icon",on:{click:t.fullScreeEvent}})])])])};f._withStripped=!0;const I="mute",w="play",S="volumeSize",_="fullBrowser",C="progress",b={mute:"声音控制",play:"播放控制",volumeSize:"声音大小",fullScree:"全屏控制",selectQuality:"画质量",fullBrowser:"浏览器-全屏",progress:"播放进度"};var T={name:"control",data:()=>({mute:!1,isPlay:!0,volumeSize:100,fullScree:!1,isFullBrowser:!1,showQualityBlock:!1,selectQuality:0,current:0,progress:0}),computed:{allDate(){return this.formatDate(this.totalTime)},currentDate(){return this.formatDate(this.currentTime)},rate(){return parseInt(100*this.currentTime/this.totalTime)}},props:{currentTime:{type:Number,default:0},totalTime:{type:Number,default:1e3},qualitys:{type:Array,default:["same"]}},watch:{currentTime:{handler(t){this.current=t},immediate:!0},rate:{handler(t){this.progress=t},immediate:!0},volumeSize(t){this.changeControl(S,t)}},methods:{changeControl(t,e){this.$emit("control",{type:t,value:e,msg:b[t]})},formatTooltip:t=>t+"%",changeVal(){this.changeControl(C,this.progress)},muteEvent(){this.mute=!this.mute,this.changeControl(I,this.mute)},overEvent(){this.showQualityBlock=!0},outEvent(){this.showQualityBlock=!1},playEvent(){this.isPlay=!this.isPlay,this.changeControl(w,this.isPlay)},fullScreeEvent(){alert("请把手机横评放置")},fullBrowser(){this.isFullBrowser=!this.isFullBrowser,this.changeControl(_,this.isFullBrowser)},formatDate(t){let e=(t/3600>>0)+"",i=((t/60%60>>0)+"").padStart(2,0),a=((t%60>>0)+"").padStart(2,0);return e>0?`${e}:${i}:${a}`:`${i}:${a}`}}},x=(i(244),i(1)),P=Object(x.a)(T,f,[],!1,null,"a65f7196",null);P.options.__file="src/pages/watch/video/control.vue";var k=P.exports,E=i(2),L=i(183),M={name:"index",components:{VideoControl:k},data:()=>({playComps:{},playBtnShow:!1,imageUrl:"",recordId:"",outLineLink:"",playBoxId:`play-vides-${Math.random()}`,sdkPlayParam:{appId:"",accountId:"",token:""},currentTime:0,totalTime:1e4,stInterval:"",isPlay:!1,isAutoPlay:!1,controlPsoition:"1.333vw",qualitys:[]}),props:{role:{type:String,default:"watcher"},playType:{type:String,required:!0,default:""},startInit:{type:Boolean,required:!0,default:!1},paasParams:{appId:"",roomId:"",inavId:"",token:"",accountId:""}},computed:d()({},Object(v.c)("liveMager",{liveDevices:t=>t.liveDevices,roomPaas:t=>t.roomPaas,activityInfo:t=>t.activityInfo}),{imageSrc(){return`${this.$imgHost}/${this.imageUrl}`}}),mounted(){let t=this;window.addEventListener("onorientationchange"in window?"orientationchange":"resize",function(){90===window.orientation||-90===window.orientation?(t.$emit("orientationchange","horizontalScreen"),t.horizontalScreen()):(t.herticalScreen(),t.$emit("orientationchange","herticalScreen"))},!1)},watch:{startInit(t){t?this.initComponent():this.stopPlay()},playType:{handler(){this.changePlayType()}},liveDevices(){this.changeLiveDevice()}},beforeDestroy(){console.log("--video-com--beforeDestroy"),clearInterval(this.setIntervalHandler),window.hostPusher&&window.hostPusher.destroy(),window.playComps&&window.playComps.destroy(),window.VhallPlayer&&window.VhallPlayer.destroy()},methods:d()({},Object(v.b)("liveMager",{storeRoomPaas:E.h}),{initComponent(){"live"===this.playType?this.initLivePlay():"warm"===this.playType?this.queryWarmInfo():"vod"===this.playType?this.initPlayBack():"end"===this.playType&&this.playEnd()},changePlayType(){this.startInit&&-1!=="live|warm|vod|end|pre".indexOf(this.playType)&&(this.isAutoPlay=!1,this.destoryComs(),this.initComponent())},playEnd(){},playVideo(){"warm"===this.playType&&this.playBackVideo()},changeLiveDevice(){window.hostPusher&&window.hostPusher.changeSetting({video:{deviceId:this.liveDevices.camera},audio:{deviceId:this.liveDevices.mic},conf:{videoSize:[800,450,800,450]}})},initLivePlay(){"watcher"===this.role&&this.initPuller()},initPlayBack(){this.$config({handlers:!0}).$get(L.a.GET_DEFAULEREPLAY,{activityId:this.$route.params.id}).then(t=>{t.data&&(this.imageUrl=t.data.cover,"LINK"===t.data.replay.type?this.outLineLink=t.data.replay.link:"VIDEO"!==t.data.replay.type&&"SLICE"!==t.data.replay.type||(this.recordId=t.data.replay.video,this.totalTime=t.data.replay.duration,this.playBackVideo()))}).catch(()=>{})},playBackVideo(){this.$nextTick(()=>{this.recordId&&(window.Vhall.ready(()=>{window.VhallPlayer.init({recordId:this.recordId,type:"vod",videoNode:this.playBoxId,complete:()=>{this.playBtnShow=!1,this.qualitys=window.VhallPlayer.getQualitys(),window.VhallPlayer.play(),this.dealWithVideo()}})}),window.Vhall.config({appId:this.roomPaas.appId,accountId:this.roomPaas.accountId,token:this.roomPaas.token}))})},dealWithVideo(){clearInterval(this.setIntervalHandler),this.setIntervalHandler=setInterval(()=>{this.currentTime=window.VhallPlayer.getCurrentTime(),this.totalTime<=this.currentTime&&(clearInterval(this.setIntervalHandler),this.isAutoPlay&&(window.VhallPlayer.play(),this.dealWithVideo()))},1e3)},queryWarmInfo(){this.$config({handlers:!0}).$get(L.a.GET_WARMINFO,{activityId:this.$route.params.id}).then(t=>{t.data&&(this.imageUrl=t.data.imgUrl,this.recordId=t.data.recordId,this.isAutoPlay="AUTO"===t.data.playType,this.playBtnShow=!0,this.totalTime=parseInt(t.data.record.duration),this.playBackVideo())}).catch(()=>{})},initPuller(){window.playComps&&window.playComps.destroy(),this.$nextTick(()=>{this.playComps=new class extends y{constructor(t,e,i,a){super(t,i,a),this.type="live",this.roomId=e}initLivePlayer(t=!1,e=null){console.log("1调用初始化拉流器"),window.Vhall.ready(()=>{console.log("2SDK初始化完成"),window.VhallPlayer.init({roomId:this.roomId,type:"live",videoNode:this.rootEleId,complete:()=>{console.log("3播放器初始化完成"),e&&e(),t&&window.VhallPlayer.play()}}),this.player=window.VhallPlayer})}set accountId(t){super.accoundId=t,console.log("aaa",this.appId,this.roomId,this.rootEleId,this.token),window.Vhall.config({appId:this.appId,accountId:t,token:this.token})}}(this.roomPaas.appId,this.roomPaas.liveRoom,this.playBoxId,this.roomPaas.token),this.playComps.initLivePlayer(!0,()=>{console.log("----------开始播放----------")}),this.playComps.accountId=this.roomPaas.accountId})},pullBroadCast(){this.hostPusher.stopBroadCast().then(()=>{this.hostPusher.startBroadCast().then(()=>{console.log("----------旁路推流成功----------")}).catch(t=>{console.error(`旁路推流失败:${t}`);let e=setTimeout(()=>{clearTimeout(e),this.pullBroadCast()},500)})}).catch(t=>{console.error(`停止旁路推流失败:${t}`)})},stopPlay(){"live"===this.playType&&window.hostPusher.stop()},showVideo(t){this.isShowVideo=t,"live"===this.playType?"master"===this.role?window.hostPusher.showVideo(t):"watcher"===this.role&&window.playComps.showVideo(t):"warm"===this.playType||this.playType},mutoAuto(t){this.isMutoAuto=t,"live"===this.playType?"master"===this.role?window.hostPusher.mute(t):"watcher"===this.role&&(window.playComps.volume=t?0:50):"warm"===this.playType||this.playType},formatTooltip:t=>t/1e4,formatTime(t){let e={hour:"",min:"",sed:""};return e.hour=((t/3600%24>>0)+"").padStart(2,0),e.min=((t/60%60>>0)+"").padStart(2,0),e.sed=((t%60>>0)+"").padStart(2,0),`${e.hour}:${e.min}:${e.sed}`},fullScreen(){alert("请把手机横评放置")},horizontalScreen(){this.isShowCover=!1,this.height="100%",this.controlPsoition="9.333vw"},herticalScreen(){this.isShowCover=!0,this.height="56.267vw",this.controlPsoition="1.333vw"},start(){this.isStart=!0,this.puller.play()},play(t){"warm"!==this.playType&&"vod"!==this.playType||(t?window.VhallPlayer.play():window.VhallPlayer.pause())},playControl(t){const e=t.type;"progress"===e?this.seekProgress(t.value):"play"===e?this.play(t.value):"mute"===e?this.mutoAuto(t.value):"volumeSize"===e?this.changeVolume(t.value):"selectQuality"===e?window.VhallPlayer.setQuality(t.value):"fullScree"===e?this.fullScree(t.value):"fullBrowser"===e&&this.$emit("fullBrowser",t.value)},seekProgress(t){window.VhallPlayer&&window.VhallPlayer.seek(this.totalTime*t/100)},destoryComs(){clearInterval(this.setIntervalHandler),window.hostPusher&&window.hostPusher.destroy(),window.playComps&&window.playComps.destroy(),window.VhallPlayer&&window.VhallPlayer.destroy()}})},B=(i(246),Object(x.a)(M,g,[],!1,null,"2bb9b82a",null));B.options.__file="src/pages/watch/video/index.vue";var O=B.exports,A=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"chat-wrap",on:{click:t.boxClick}},[i("div",{ref:"bscroll",staticClass:"bscroll",class:"live"!==t.type?"vod":"live",on:{mouseover:function(e){t.stopScroll=!0},mouseout:function(e){t.stopScroll=!1}}},[i("ol",{staticClass:"chat-list bscroll-container"},t._l(t.chatData,function(e,a){return i("li",{class:{right:1*t.joinInfo.activityUserId==1*e.id},attrs:{"data-joinId":e.id}},[i("dl",{staticClass:"clearfix"},[""!==e.avatar?i("dt",[i("img",{attrs:{src:t.imgHost+"/"+e.avatar}})]):i("dt",{staticClass:"avatar"},[t._v(t._s(e.name.substr(0,1)))]),t._v(" "),i("dd",[i("div",{staticClass:"name"},[t._v(t._s(e.name)+" "),e.detail.role?i("em",[t._v(t._s(e.detail.role))]):t._e()]),t._v(" "),i("div",{staticClass:"txt",domProps:{innerHTML:t._s(e.detail.txt)}})])])])})),t._v(" "),t.tipsShow&&t.tipsCount>0?i("transition",[i("span",{staticClass:"msg-tips",on:{click:t.scrollBtm}},[t._v("有"+t._s(t.tipsCount)+"条新消息 "),i("i",{staticClass:"iconfont icon-xiangxia"})])]):t._e(),t._v(" "),i("transition",{attrs:{name:"left-right",mode:"out-in"}},[t.announceShow?i("div",{staticClass:"announce-box"},[i("svg",{staticClass:"icon",staticStyle:{width:"6.667vw",height:"6.667vw","vertical-align":"middle",fill:"currentColor",overflow:"hidden"},attrs:{viewBox:"0 0 1305 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"3285"}},[i("path",{attrs:{d:"M236.3648 689.6384a102.4 102.4 0 0 1 144.6144 7.5776l119.9104 133.1712a102.4 102.4 0 1 1-152.2176 137.0368l-119.9104-133.1712a102.4 102.4 0 0 1 7.6032-144.64z",fill:"#222222","p-id":"3286"}}),t._v(" "),i("path",{attrs:{d:"M277.4528 734.4384a25.6 25.6 0 0 0-1.8944 36.1472l119.9104 133.1968a25.6 25.6 0 0 0 38.0672-34.2784l-119.9104-133.1712a25.6 25.6 0 0 0-36.1728-1.8944z",fill:"#FFD021","p-id":"3287"}}),t._v(" "),i("path",{attrs:{d:"M144.5888 482.4832l47.2064-12.416a464.8448 464.8448 0 0 0 278.3744-207.104l72.832-119.1168c-15.3088 169.7024-7.9104 291.7888 22.1696 366.208 30.08 74.4704 107.52 162.304 232.2944 263.6032l-138.3168-37.7088a456.064 456.064 0 0 0-342.9376 42.1376l-42.5472 23.8336a173.6704 173.6704 0 0 1-245.9392-86.4256 173.6704 173.6704 0 0 1 116.864-233.0112z",fill:"#222222","p-id":"3288"}}),t._v(" "),i("path",{attrs:{d:"M211.328 544.3328l-47.2064 12.4416a96.8448 96.8448 0 0 0-59.904 141.056 96.8704 96.8704 0 0 0 131.8656 37.12l42.5472-23.8336a532.8384 532.8384 0 0 1 389.632-52.1472L528.896 313.9328a541.7728 541.7728 0 0 1-317.5424 230.4z",fill:"#FFD021","p-id":"3289"}}),t._v(" "),i("path",{attrs:{d:"M819.5072 795.9552c-94.4896 38.1696-217.088-93.1072-293.3248-281.856-76.2624-188.7232-79.2832-368.3072 15.2064-406.5024 94.5152-38.144 217.088 93.1328 293.3504 281.856 76.2368 188.7232 79.2576 368.3072-15.232 406.5024z",fill:"#222222","p-id":"3290"}}),t._v(" "),i("path",{attrs:{d:"M790.7328 724.736c12.9792-5.248 24.2944-35.7888 23.424-88.0384-1.024-61.3888-18.7904-139.6736-50.6368-218.496s-73.472-147.456-115.3536-192.3072c-35.6608-38.1952-65.024-52.3264-78.0032-47.104s-24.2688 35.8144-23.3984 88.064c1.024 61.3888 18.7648 139.6736 50.6112 218.496s73.472 147.456 115.3792 192.3328c35.6608 38.1696 65.024 52.3008 77.9776 47.0528z",fill:"#FFD021","p-id":"3291"}}),t._v(" "),i("path",{attrs:{d:"M668.8256 525.4912a76.8 76.8 0 1 1-57.5488-142.3872 76.8 76.8 0 0 1 57.5488 142.3872zM840.9088 233.2928a38.4 38.4 0 1 1-50.176-58.1376l172.544-148.8896a38.4 38.4 0 1 1 50.1504 58.1376l-172.544 148.8896zM951.04 575.1552a38.4 38.4 0 0 1-3.712-76.7232l256.9472-12.3648a38.4 38.4 0 0 1 3.6864 76.7232l-256.9472 12.3648zM902.4 407.9872a38.4 38.4 0 1 1-31.9488-69.8368l370.0736-169.344a38.4 38.4 0 1 1 31.9488 69.8368L902.4 407.9872zM201.3696 637.8496a25.6 25.6 0 1 1-12.1856-49.7152c14.08-3.456 24.576-6.144 31.488-8.0128a25.6 25.6 0 1 1 13.5936 49.3312c-7.4752 2.0736-18.4064 4.864-32.896 8.3968z m111.1552-35.4048a25.6 25.6 0 1 1-20.864-46.7712c40.2688-17.9712 84.7872-42.5216 133.4272-73.6256a25.6 25.6 0 1 1 27.5712 43.136c-50.688 32.4096-97.3568 58.1632-140.1344 77.2608z",fill:"#222222","p-id":"3292"}})]),t._v(" "),i("div",{staticClass:"txt-box"},[i("p",{staticClass:"txt"},[t._v(t._s(t.receiveAnnounce))])]),t._v(" "),i("i",{staticClass:"iconfont icon-close",on:{click:function(e){t.announceShow=!1}}})]):t._e()])],1),t._v(" "),"live"===t.type&&t.isLogin&&t.sendBoxShow?i("div",{staticClass:"v-send-box-bg"},[i("div",{staticClass:"send-box clearfix",attrs:{id:"sendBox"}},[i("div",{staticClass:"top"},[i("span",{staticClass:"cancel-btn fl",on:{click:t.cancelClick}},[t._v("取消")]),t._v(" "),i("span",{staticClass:"v-title"},[t._v("\n          聊天\n        ")]),t._v(" "),(t.mute||t.allMuted)&&t.isWatch?[i("div",{staticClass:"mute-box"},[t._v(t._s(t.allMuted?"已开启全体禁言":"您已被禁言"))])]:[i("span",{staticClass:"send-btn fr",on:{click:t.sendAction}},[t._v("发送")])],t._v(" "),"HOST"!==t.joinInfo.roleName||t.isWatch?t._e():i("div",{staticClass:"fr"},[i("i",{staticClass:"icon-swap",attrs:{title:"切换发送聊天/公告"},on:{click:function(e){t.swapAnnounce?t.swapAnnounce=!1:t.swapAnnounce=!0}}}),t._v(" "),i("div",{staticClass:"switch-box"},[i("span",[t._v("全体禁言")]),t._v(" "),i("el-switch",{staticClass:"switch",attrs:{"inactive-color":"#DEE1FF",width:32,"active-color":"#FFD021"},on:{change:t.muteAll},model:{value:t.allMuted,callback:function(e){t.allMuted=e},expression:"allMuted"}})],1)])],2),t._v(" "),i("div",{staticClass:"bottom clearfix"},[t.swapAnnounce?[i("com-input",{staticClass:"inp",attrs:{value:t.value,placeholder:t.chatPlaceholder,"max-length":140,type:"textarea"},on:{"update:value":function(e){t.value=e}}})]:[i("com-input",{staticClass:"inp",attrs:{value:t.valueAnnounce,placeholder:t.announcePlaceholder,"max-length":140,type:"textarea"},on:{"update:value":function(e){t.valueAnnounce=e}}})],t._v(" "),i("div",{staticClass:"v-emoji"},[i("i",{staticClass:"iconfont icon-biaoqing",attrs:{title:"表情"},on:{click:function(e){t.faceOpen=!t.faceOpen}}}),t._v(" "),t.faceOpen?i("div",{staticClass:"face-box"},t._l(t.faceArr,function(e,a){return i("img",{key:a,attrs:{src:"//cnstatic01.e.vhall.com/static/img/arclist/Expression_"+(a+1)+"@2x.png"},on:{click:function(e){e.stopPropagation(),t.inFace(a)}}})})):t._e()])],2)])]):t._e()])};A._withStripped=!0;var N=i(25),$=i.n(N),D=i(180),U=i.n(D);const V=U()("msgHandler"),G=U()("dispatchHandler");class j{constructor(){if(this._instance)throw new Error("ChatService is singlton");this._instance=this,this._activityId="",this.handlerMap={}}static get OBJ(){return this._instance||(this._instance=new j),this._instance}init(t){this.service||window.vhallChat||(window.Vhall.ready(()=>{this.service=VhallChat({channelId:t.channelId}),window.vhallChat=this.service,this[V](),console.log("初始化成功")}),window.Vhall.config({appId:t.appId,accountId:t.accountId,token:t.token}),console.log(c()(t)))}set activityId(t){this._activityId=t}get activityId(){return this._activityId}sendChat(t){this.service.emit(t)}sendCustomMsg(t,e){this.service.emitCustomMsg({type:t,body:e})}[V](){console.log("[chat]listening..."),window.vhallChat.onCustomMsg(t=>{let{type:e,body:i}=JSON.parse(t);this[G](e,i)}),window.vhallChat.on(t=>{this[G]("chat",t)})}regHandler(t,e){this.handlerMap[t]||(this.handlerMap[t]=[]);let i=this.handlerMap[t];i.includes(e)?console.log("重复注册消息"):i.push(e)}unregHandler(t,e){if(!this.handlerMap[t])return;let i=this.handlerMap[t],a=i.indexOf(e);-1!==a&&i.splice(a,1)}[G](t,e){let i=this.handlerMap[t];i&&0!==i.length&&i.forEach(t=>{t(e)})}}var H=i(182),J={name:"chat",data(){return{vhallParams:{token:"",appId:"",channelId:"",accountId:""},activityId:this.$route.params.id,value:"",valueAnnounce:"",receiveAnnounce:"",service:null,chatData:[],tipsShow:!1,announceShow:!1,faceOpen:!1,swapAnnounce:!0,mute:!1,allMuted:!1,tipsCount:0,timer:null,isLogin:!1,stopScroll:!1,chatPlaceholder:"输入想说的话…",announcePlaceholder:"请输入公告内容",aBScroll:null,imgHost:"http://dev-zhike.oss-cn-beijing.aliyuncs.com/",faceArr:[{"[微笑]":"1"},{"[撇嘴]":"2"},{"[色]":"3"},{"[发呆]":"4"},{"[得意]":"5"},{"[流泪]":"6"},{"[害羞]":"7"},{"[闭嘴]":"8"},{"[睡]":"9"},{"[哭]":"10"},{"[尴尬]":"11"},{"[发怒]":"12"},{"[调皮]":"13"},{"[呲牙]":"14"},{"[惊讶]":"15"},{"[难过]":"16"},{"[酷]":"17"},{"[汗]":"18"},{"[抓狂]":"19"},{"[吐]":"20"},{"[偷笑]":"21"},{"[愉快]":"22"},{"[白眼]":"23"},{"[傲慢]":"24"},{"[饥饿]":"25"},{"[困]":"26"},{"[惊恐]":"27"},{"[流汗]":"28"},{"[憨笑]":"29"},{"[悠闲]":"30"},{"[奋斗]":"31"},{"[咒骂]":"32"},{"[疑问]":"33"},{"[嘘]":"34"},{"[晕]":"35"},{"[疯了]":"36"},{"[衰]":"37"},{"[骷髅]":"38"},{"[敲打]":"39"},{"[再见]":"40"},{"[擦汗]":"41"},{"[抠鼻]":"42"},{"[鼓掌]":"43"},{"[糗大了]":"44"},{"[坏笑]":"45"},{"[左哼哼]":"46"},{"[右哼哼]":"47"},{"[哈欠]":"48"},{"[鄙视]":"49"},{"[委屈]":"50"},{"[快哭了]":"51"},{"[阴险]":"52"},{"[亲亲]":"53"},{"[吓]":"54"},{"[可怜]":"55"},{"[菜刀]":"56"},{"[西瓜]":"57"},{"[啤酒]":"58"},{"[篮球]":"59"},{"[乒乓]":"60"},{"[咖啡]":"61"},{"[饭]":"62"},{"[猪头]":"63"},{"[玫瑰]":"64"},{"[凋谢]":"65"},{"[嘴唇]":"66"},{"[爱心]":"67"},{"[心碎]":"68"},{"[蛋糕]":"69"},{"[闪电]":"70"},{"[炸弹]":"71"},{"[刀]":"72"},{"[足球]":"73"},{"[瓢虫]":"74"},{"[便便]":"75"},{"[月亮]":"76"},{"[太阳]":"77"},{"[礼物]":"78"},{"[拥抱]":"79"},{"[强]":"80"},{"[弱]":"81"},{"[握手]":"82"},{"[胜利]":"83"},{"[抱拳]":"84"},{"[勾引]":"85"},{"[拳头]":"86"},{"[差劲]":"87"},{"[爱你]":"88"},{"[NO]":"89"},{"[OK]":"90"}]}},props:{type:{type:String,default:"live"},isWatch:{type:Boolean,default:!1},sendBoxShow:{type:Boolean,default:!1}},computed:d()({},Object(v.c)("liveMager",{roomPaas:t=>t.roomPaas,activityInfo:t=>t.activityInfo,joinInfo:t=>t.joinInfo}),Object(v.c)("tokenMager",{chatParams:t=>t.chatParams}),Object(v.c)("login",{loginInfo:t=>t.loginInfo})),mounted(){this.isWatch||(this.isLogin=!0)},methods:d()({},Object(v.b)("tokenMager",{setChatParams:E.b}),Object(v.b)("liveMager",{storeJoinInfo:E.d}),{initSdk(){let t={channelId:this.roomPaas.channelRoom};$()(this.roomPaas,t),j.OBJ.init(this.roomPaas),j.OBJ.regHandler("chat",this.listenChat),j.OBJ.regHandler("ANNOUNCEMENT",this.listenAnnounce),j.OBJ.regHandler("KICK",this.listenKick),j.OBJ.regHandler("DISABLE_KICK",this.listenCancelkick),j.OBJ.regHandler("GAG",this.listenMute),j.OBJ.regHandler("DISABLE_GAG",this.listenCancelmute),j.OBJ.regHandler("GAG_ALL",this.listenAllmute),j.OBJ.regHandler("DISABLE_GAG_ALL",this.listenCancelallmute)},sendAction(){if(!this.value.replace(/\n/g,"").length)return this.chatPlaceholder="聊天内容不能为空",!1;const t="HOST"===this.joinInfo.roleName?"主持人":"";j.OBJ.activityId=this.activityId;const e={role:t,txt:this.value};j.OBJ.sendChat(c()(e)),this.value="",this.chatPlaceholder="输入想说的话…",this.faceOpen=!1,this.$emit("closeChatBox",!0)},listenChat(t){console.log("接收 聊天消息",t),this.reArrange(t),this.tipsShow&&this.tipsCount++},listenAnnounce(t){console.log("接收 公告消息",t),this.announceShow=!0,this.receiveAnnounce=t.content;const e=this;clearTimeout(e.timer),e.timer=setTimeout(function(){e.announceShow=!1,this.receiveAnnounce="",clearTimeout(e.timer)},15e3)},listenKick(t){console.log("接收 踢出消息",t),this.refreshList(t.activityUserId,"isKick","Y"),this.isSelf(t.activityUserId)&&this.$router.push({path:"/kicked"})},listenCancelkick(t){console.log("接收 取消踢出消息"+t),this.refreshList(t.activityUserId,"isKick","N")},listenMute(t){console.log("接收 禁言消息",t),this.refreshList(t.activityUserId,"isGag","Y"),this.isSelf(t.activityUserId)&&(this.mute=!0)},listenCancelmute(t){this.refreshList(t.activityUserId,"isGag","N"),console.log("接收 取消禁言消息",t),this.isSelf(t.activityUserId)&&(this.mute=!1)},listenAllmute(t){console.log("接收 全体禁言消息",t),this.allMuted=!0},listenCancelallmute(t){console.log("接收 取消全体禁言消息",t),this.allMuted=!1},isSelf(t){return this.joinInfo.activityUserId===t},refreshList(t,e,i){this.chatData.forEach(a=>{1*a.id==1*t&&(a[e]=i)})},reArrange(t){const e={};if(e.id=t.third_party_user_id,e.avatar=t.avatar,e.name=t.nick_name,e.isGag=t.isGag,e.isKick=t.isKick,e.detail=JSON.parse(t.data),this.faceArr.forEach((t,i)=>{for(let a in i){let t=a.replace(/\[/,"\\[").replace(/\]/,"\\]"),s=new RegExp(t,"g");e.detail.txt=e.detail.txt.replace(s,"<img src='//cnstatic01.e.vhall.com/static/img/arclist/Expression_"+i[a]+"@2x.png'>")}}),this.chatData.push(e),!this.tipsShow&&!this.stopScroll){const t=this;setTimeout(function(){t.scrollBtm()},200)}this.stopScroll&&(this.tipsShow=!0)},sendAnnounce(){if(!this.valueAnnounce.replace(/\n/g,"").length)return this.announcePlaceholder="公告内容不能为空",!1;const t={activityId:this.activityId,message:this.valueAnnounce};this.$get(L.a.GET_SENDANNOUNCEMENT,t).then(t=>{this.$toast({content:"公告发送成功"}),this.valueAnnounce="",this.announcePlaceholder="请输入公告内容",this.$emit("closeChatBox",!0)})},cancelClick(){this.$emit("closeChatBox",!0)},scrollBtm(){this.aBScroll.scrollTo(0,this.aBScroll.maxScrollY,500,"bounce"),setTimeout(()=>{this.tipsCount=0},500)},inFace(t){for(let e in this.faceArr[t])this.value+=e},boxClick(t){"icon-emoji"!==t.target.className&&(this.faceOpen=!1)},getHistroy(){this.$get(L.a.GET_MESSAGELIST,{activityId:this.activityId}).then(t=>{t.data.reverse().forEach(t=>{this.reArrange(t)})})},muteAll(){const t={activityId:this.activityId,cancel:this.allMuted?"N":"Y"};this.$post(L.a.POST_GAGALL,t).then(e=>{this.$toast({content:"Y"===t.cancel?"已取消全体禁言":"已开启全体禁言"})})},initToken(){if(this.isWatch)return this.roomPaas},initScroll(){this.$nextTick(()=>{let t=this.$refs.bscroll;this.aBScroll=new H.a(t,{scrollbar:!0,click:!0,mouseWheel:!0,"probeType ":3}),this.aBScroll.on("scrollEnd",t=>{let e=document.getElementsByClassName("chat-list")[0].offsetHeight;.5*e>document.getElementsByClassName("bscroll")[0].offsetHeight&&.5*e>-1*t.y?this.tipsShow=!0:this.tipsShow=!1})})},initInfo(){var t=this;return l()(function*(){t.initSdk()})()},loginHandler(){this.$emit("showLogin")}}),watch:{"loginInfo.consumerUserId":{handler(t){t&&this.isWatch&&(this.isLogin=!0)},deep:!0,immediate:!0},allMuted:{handler(t){t?this.$emit("isMute",{isMute:!0,type:"allMuted"}):this.$emit("isMute",{isMute:!1,type:"allMuted"})},deep:!0},mute:{handler(t){t?this.$emit("isMute",{isMute:!0,type:"mute"}):this.$emit("isMute",{isMute:!1,type:"mute"})},deep:!0},activityInfo:{handler(t){"Y"===t.setting.gag?this.allMuted=!0:this.allMuted=!1},deep:!0},"roomPaas.channelId":{handler(t){t&&(console.log(t),this.initInfo())},immediate:!0,deep:!0},"joinInfo.isGag":{handler(t){"Y"===t&&this.isWatch&&(this.mute=!0)},deep:!0,immediate:!0},"joinInfo.isKick":{handler(t){"Y"===t&&this.isWatch&&this.$router.push({path:"/kicked"})},deep:!0,immediate:!0}}},F=(i(248),Object(x.a)(J,A,[],!1,null,"3a2ec7eb",null));F.options.__file="src/components/chat/index.vue";var R=F.exports,z=i(185),K=i(190),W={props:{domShow:Boolean},mixins:[z.a],components:{PlayVideo:O,Chating:R},data:()=>({startInit:!1,tabValue:1,isWatch:!0,chatListInit:!1,sendBoxShow:!1,isLogin:!1,isMuteShow:!1,allMuted:!1}),computed:d()({},Object(v.c)("liveMager",{activityInfo:t=>t.activityInfo,roomPaas:t=>t.roomPaas,joinInfo:t=>t.joinInfo}),Object(v.c)("login",{loginInfo:t=>t.loginInfo})),mounted(){this.storeLoginInfo(this.getLoginInfo()),this.playType="vod",this.startInit=!0},created(){this.initToken()},watch:{"loginInfo.consumerUserId":{handler(t){t&&this.isWatch&&(this.isLogin=!0)},deep:!0},activityInfo:{}},methods:d()({},Object(v.b)("login",{storeLoginInfo:E.g}),Object(v.b)("liveMager",{storeActivityInfo:E.a,storeJoinInfo:E.d}),{tabChange(){if(2===this.tabValue&&(this.$refs.chatbox.aBScroll||(this.$refs.chatbox.initScroll(),this.$refs.chatbox.getHistroy()),!this.$refs.chatbox.tipsShow)){const t=this;setTimeout(function(){t.$refs.chatbox.scrollBtm()},200)}},initToken(){this.$nextTick(()=>{this.startInit=!0})},initMsgServe(){j.OBJ.init({accountId:this.roomPaas.accountId,token:this.roomPaas.token,appId:this.roomPaas.appId,channelId:this.roomPaas.channelRoom}),j.OBJ.regHandler(K.a.onLineNum,t=>{const e=JSON.parse(c()(this.liveInfo));e.showOnlineNum=parseInt(e.setting.initOnlineNum)+parseInt(t.num),this.storeLiveInfo(e)}),j.OBJ.regHandler(K.a.beginLive,t=>{this.playType="live";const e=JSON.parse(c()(this.activityInfo));e.status="LIVING",e.statusName="直播中",this.storeActivityInfo(e)}),j.OBJ.regHandler(K.a.endLive,t=>{this.playType="end";const e=JSON.parse(c()(this.activityInfo));e.status="FINISH",e.statusName="结束",this.storeActivityInfo(e)})},isMute(t){this.isMuteShow=t.isMute,this.allMuted="allMuted"===t.type},chatClick(){this.sendBoxShow=!0},closeChatBox(){this.sendBoxShow=!1},loginSuccess(t){this.storeLoginInfo(t),this.isLogin=!0,this.$router.go(0)},loginHandler(){this.$emit("showLogin")}})},Q=(i(250),Object(x.a)(W,m,[function(){var t=this.$createElement,e=this._self._c||t;return e("a",{staticClass:"v-subscribe",attrs:{href:"javascript:;"}},[e("i",{staticClass:"iconfont icon-dingyue"}),this._v(" 关注")])}],!1,null,"3304695f",null));Q.options.__file="src/pages/watch/playback.vue";var q=Q.exports,Y=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticClass:"v-video"},[i("play-video",{attrs:{role:"watcher","play-type":t.playType,startInit:t.startInit}})],1),t._v(" "),t.domShow?i("div",{staticClass:"v-function-box"},[i("div",{staticClass:"v-nav"},[i("com-tabs",{attrs:{value:t.tabValue},on:{"update:value":function(e){t.tabValue=e},change:t.tabChange}},[i("com-tab",{attrs:{label:"活动简介",index:1}},[i("div",{staticClass:"v-introduction",domProps:{innerHTML:t._s(t.activityInfo.description)}})]),t._v(" "),i("com-tab",{attrs:{label:"互动聊天",index:2}},[i("div",{staticClass:"chat-content"},[i("chating",{ref:"chatbox",attrs:{type:t.playType,isWatch:t.isWatch,sendBoxShow:t.sendBoxShow},on:{closeChatBox:t.closeChatBox,isMute:function(e){t.isMute(e)}}})],1),t._v(" "),"live"===t.playType&&t.isLogin?[t.isMuteShow?[i("div",{staticClass:"v-chat-control v-noLogin",attrs:{id:"sendBoxBtn"}},[t._v("\n                "+t._s(t.allMuted?"已开启全体禁言":"您已被禁言")+"\n              ")])]:[i("div",{staticClass:"v-chat-control",attrs:{id:"sendBoxBtn"},on:{click:function(e){t.chatClick()}}},[i("i",{staticClass:"iconfont icon-biaoqing"}),t._v(" "),i("span",{staticClass:"v-chat-clickbox"},[t._v("\n                  输入文字聊天\n                ")])])]]:"live"!==t.playType||t.isLogin?t._e():[i("div",{staticClass:"v-chat-control v-noLogin",attrs:{id:"sendBoxBtn"}},[t._v("\n              需要登录才能参与聊天 "),i("span",{on:{click:t.doLogin}},[t._v("登录")])])]],2)],1),t._v(" "),t._m(0)],1)]):t._e(),t._v(" "),i("com-login",{on:{login:t.loginSuccess}})],1)};Y._withStripped=!0;var Z={props:{domShow:Boolean},mixins:[z.a],components:{PlayVideo:O,Chating:R},data:()=>({playType:"",startInit:!1,tabValue:1,isWatch:!0,chatListInit:!1,sendBoxShow:!1,isLogin:!1,isMuteShow:!1,allMuted:!1}),computed:d()({},Object(v.c)("liveMager",{activityInfo:t=>t.activityInfo,roomPaas:t=>t.roomPaas,joinInfo:t=>t.joinInfo}),Object(v.c)("login",{loginInfo:t=>t.loginInfo})),mounted(){this.storeLoginInfo(this.getLoginInfo()),"PREPARE"===this.activityInfo.status?this.playType="warm":"FINISH"===this.activityInfo.status?this.playType="end":this.playType="live",this.startInit=!0,this.initMsgServe()},created(){this.initToken()},watch:{"loginInfo.consumerUserId":{handler(t){t&&this.isWatch&&(this.isLogin=!0)},deep:!0}},methods:d()({},Object(v.b)("login",{storeLoginInfo:E.g}),Object(v.b)("liveMager",{storeActivityInfo:E.a,storeJoinInfo:E.d}),{tabChange(){if(2===this.tabValue&&(this.$refs.chatbox.aBScroll||(this.$refs.chatbox.initScroll(),this.$refs.chatbox.getHistroy()),!this.$refs.chatbox.tipsShow)){const t=this;setTimeout(function(){t.$refs.chatbox.scrollBtm()},200)}},initToken(){this.$nextTick(()=>{this.startInit=!0})},initMsgServe(){j.OBJ.init({accountId:this.roomPaas.accountId,token:this.roomPaas.token,appId:this.roomPaas.appId,channelId:this.roomPaas.channelRoom}),j.OBJ.regHandler(K.a.onLineNum,t=>{const e=JSON.parse(c()(this.liveInfo));e.showOnlineNum=parseInt(e.setting.initOnlineNum)+parseInt(t.num),this.storeLiveInfo(e)}),j.OBJ.regHandler(K.a.beginLive,t=>{console.log(this.activityInfo),this.playType="live";const e=JSON.parse(c()(this.activityInfo));console.log(e),e.status="LIVING",e.statusName="直播中",this.storeActivityInfo(e),console.log(this.activityInfo)}),j.OBJ.regHandler(K.a.endLive,t=>{this.playType="end";const e=JSON.parse(c()(this.activityInfo));e.status="FINISH",e.statusName="结束",this.storeActivityInfo(e)})},isMute(t){this.isMuteShow=t.isMute,this.allMuted="allMuted"===t.type},chatClick(){this.sendBoxShow=!0},closeChatBox(){this.sendBoxShow=!1},loginSuccess(t){this.storeLoginInfo(t),this.isLogin=!0,this.$router.go(0)},loginHandler(){this.$emit("showLogin")}})},X=(i(252),Object(x.a)(Z,Y,[function(){var t=this.$createElement,e=this._self._c||t;return e("a",{staticClass:"v-subscribe",attrs:{href:"javascript:;"}},[e("i",{staticClass:"iconfont icon-dingyue"}),this._v(" 关注")])}],!1,null,"8c492ca0",null));X.options.__file="src/pages/watch/live.vue";var tt=X.exports,et=function(){var t=this.$createElement;return(this._self._c||t)("div")};et._withStripped=!0;var it={name:"empty"},at=Object(x.a)(it,et,[],!1,null,null,null);at.options.__file="src/pages/watch/empty.vue";var st=at.exports,ot=i(191),nt=i(58);let lt=new p.a;const rt={PREPARE:"pre",LIVING:"live",FINISH:"end",PLAYBACK:"vod"},ct={PREPARE:"预告",LIVING:"直播中",FINISH:"结束",PLAYBACK:"回放"};var ht={mixins:[z.a],data:()=>({activityId:"",playType:"",playStatus:"",currentView:st,vhallParams:{token:"",appId:"",channelId:"",accountId:""},subscribeShow:!1,businessUserId:"",domShow:!0,autoClose:0,email:"",errorTips:"",successShow:!1,wxShare:{wxShareData:{appId:"",timestamp:"",nonceStr:"",signature:""},shareData:{title:"",desc:"",link:"",imgUrl:""},shareUser:{shareId:""}}}),mounted(){console.log(lt),this.storeLoginInfo(this.getLoginInfo())},computed:d()({},Object(v.c)("liveMager",{activityInfo:t=>t.activityInfo,joinInfo:t=>t.joinInfo,roomPaas:t=>t.roomPaas}),Object(v.c)("tokenMager",{chatParams:t=>t.chatParams}),Object(v.c)("login",{loginInfo:t=>t.loginInfo}),{showPersonCount:function(){return parseInt(this.activityInfo.setting.initOnlineNum?this.activityInfo.setting.initOnlineNum:0)+parseInt(this.activityInfo.onlineNum?this.activityInfo.onlineNum:0)},activityStatus:function(){return this.activityInfo.statusName}}),created(){const t=this.$route.params.id;t||this.$router.go(-1),this.activityId=t,this.initPage();let e=this;window.addEventListener("onorientationchange"in window?"orientationchange":"resize",function(){90===window.orientation||-90===window.orientation?e.domShow=!1:e.domShow=!0},!1)},methods:d()({},Object(v.b)("tokenMager",{setChatParams:E.b}),Object(v.b)("liveMager",{storeActivityInfo:E.a,storeRoomPaas:E.h,storeJoinInfo:E.d}),Object(v.b)("login",{storeLoginInfo:E.g}),{subscribe(){this.loginInfo?this.loginInfo.email?this.sendSubScribe():this.subScribeShow=!0:this.doLogin()},emailFocus(){this.errorTips=""},sendSubScribe(){this.$post(L.a.POST_EMAILSUBSCRIBE,{businessUserId:this.activityInfo.userId,email:this.loginInfo.email}).then(t=>{this.autoClose=3,this.subscribeShow=!1,this.successShow=!0;let e=JSON.parse(c()(this.loginInfo));e.email=this.emailInput,this.updateLoginInfo(e),this.storeLoginInfo(e)}).catch(t=>{this.errorTips=t.msg})},subscribeClick(t){if("cancel"===t.action)this.subscribeShow=!1;else if("confirm"===t.action){if(!/^[A-Za-z\d]+([-_.][A-Za-z\d]+)*@([A-Za-z\d]+[-.])+[A-Za-z\d]{2,4}$/.test(this.email))return this.errorTips="邮箱格式不正确",!1;this.errorTips="",this.sendSubScribe()}},successClick(t){"cancel"===t.action?this.successShow=!1:"confirm"===t.action&&(this.successShow=!1)},initPage(){var t=this;return l()(function*(){yield t.initRoomPaas(),t.share();let e=null;yield t.$config({handlers:!0}).$get(L.a.GET_LIVEINFO,{activityId:t.$route.params.id}).then(function(i){(e=i.data.activity).setting=i.data.setting,e.statusName=ct[e.status],e.description=i.data.activity.description,t.playType=rt[e.status],t.playStatus=ct[e.status],t.businessUserId=i.data.activity.userId}),yield t.$config({handlers:!0}).$get(L.a.GET_ONLINENUM,{activityId:t.$route.params.id}).then(function(t){e.onlineNum=t.data.onlineNum}),t.storeActivityInfo(e),"vod"===t.playType?t.currentView=q:t.currentView=tt})()},initSdk(){},initRoomPaas(){const t=this.$route.query.shareid;let e={activityId:this.activityId,__errHandler:!0};return t&&(e.shareId=t),new o.a((t,i)=>{this.roomPaas.token&&t(this.roomPaas),this.$config({handlers:!0}).$get(nt.a.GET_USERREGACTIVITY,e).then(e=>{this.storeJoinInfo(e.data),this.$config({handlers:!0}).$get(L.a.GET_SDKTOKEN,{activityId:this.activityId,activityUserId:e.data.activityUserId}).then(e=>{e.data&&(t(e.data),this.storeRoomPaas(e.data))}).catch(()=>{})})})},share(){var t=this;return l()(function*(){let e=window.location.href;t.joinInfo.activityUserId&&(e=t.joinInfo.activityUserId?`${e}?shareId=${t.joinInfo.activityUserId}`:e),t.wxShare.shareData.link=e,yield t.$config({handlers:!0}).$get(L.a.GET_SHARESIGN,{url:e}).then(function(e){t.wxShare.wxShareData.appId=e.data.appId,t.wxShare.wxShareData.timestamp=e.data.timestamp,t.wxShare.wxShareData.nonceStr=e.data.nonceStr,t.wxShare.wxShareData.signature=e.data.signature}),yield t.$config({handlers:!0}).$get(L.a.GET_SHAREINFO,{route:"live_route"}).then(function(e){e.data&&(t.wxShare.shareData.title=e.data.title?e.data.title:"",t.wxShare.shareData.desc=e.data.description?e.data.description:"",t.wxShare.shareData.imgUrl=e.data.imgUrl?e.data.imgUrl:"")}),Object(ot.a)(t.wxShare)})()},loginSuccess(t){this.storeLoginInfo(t),this.subscribe()}})},dt=(i(254),Object(x.a)(ht,a,[],!1,null,"a2747dca",null));dt.options.__file="src/pages/watch/Watch.vue";e.default=dt.exports}}]);
//# sourceMappingURL=7.6c81c2cf.js.map