(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{242:function(t,e,i){},243:function(t,e,i){},244:function(t,e,i){},245:function(t,e,i){},246:function(t,e,i){},247:function(t,e,i){},290:function(t,e,i){"use strict";var n=i(242);i.n(n).a},292:function(t,e,i){"use strict";var n=i(243);i.n(n).a},294:function(t,e,i){"use strict";var n=i(244);i.n(n).a},296:function(t,e,i){"use strict";var n=i(245);i.n(n).a},298:function(t,e,i){"use strict";var n=i(246);i.n(n).a},300:function(t,e,i){"use strict";var n=i(247);i.n(n).a},342:function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"v-watch",class:{"v-x5-div":t.vx5div,"v-close-x5-div":t.vclosex5div,"v-other-div":t.votherdiv}},[t.domShow?n("div",{staticClass:"v-x5-title"},[t._v("\n    "+t._s(t.activityInfo.title)+"\n  ")]):t._e(),t._v(" "),t.domShow?n("div",{staticClass:"v-hearder clearfix",on:{orientationchange:function(e){t.orientationchange(e)}}},[n("span",{staticClass:"v-status"},["直播中"===t.activityStatus?n("i"):t._e(),t._v(t._s(t.activityStatus)+"\n    ")]),t._v(" "),n("span",{staticClass:"v-onlineNum"},[t._v(t._s(t.showPersonCount)+"人在线")]),t._v(" "),t.loginInfo?[t.isShowSite?n("a",{staticClass:"fr v-my",attrs:{href:"/m/site/"+t.activityId}},[n("i",{staticClass:"v-showpsd iconfont icon-guanwang"}),t._v("官网")]):t._e()]:n("a",{staticClass:"fr v-my",attrs:{href:"javascript:;"},on:{click:function(e){t.doLogin()}}},[n("i",{staticClass:"v-showpsd iconfont icon-wode_icon"}),t._v("登录")]),t._v(" "),n("a",{staticClass:"fr",attrs:{href:"javascript:;"},on:{click:t.subscribe}},[n("i",{staticClass:"v-showpsd iconfont icon-dingyue_icon"}),t._v("订阅")])],2):t._e(),t._v(" "),n(t.currentView,{tag:"component",attrs:{paasParams:t.vhallParams,domShow:t.domShow}}),t._v(" "),n("message-box",{directives:[{name:"show",rawName:"v-show",value:t.subscribeShow,expression:"subscribeShow"}],on:{handleClick:function(e){t.subscribeClick(e)}}},[n("div",{attrs:{slot:"header"},slot:"header"}),t._v(" "),t.defaultImg?n("img",{staticClass:"v-logo",attrs:{src:t.defaultImg,alt:""}}):t._e(),t._v(" "),n("p",{staticClass:"v-title"},[t._v("\n      "+t._s(t.companyName)+"\n    ")]),t._v(" "),n("div",{staticClass:"v-from"},[n("p",{staticClass:"v-explain"},[t._v("\n        请留下您的邮箱，我们会将更多的活动推送给您\n      ")]),t._v(" "),n("com-input",{attrs:{value:t.email,placeholder:"请输入邮箱",errorTips:t.errorTips},on:{"update:value":function(e){t.email=e},focus:function(e){t.emailFocus()}}})],1)]),t._v(" "),n("message-box",{directives:[{name:"show",rawName:"v-show",value:t.successShow,expression:"successShow"}],attrs:{autoClose:t.autoClose},on:{handleClick:t.successClick}},[n("div",{attrs:{slot:"header"},slot:"header"}),t._v(" "),n("img",{staticClass:"v-success",attrs:{src:i(239),alt:""}}),t._v(" "),n("p",{staticClass:"v-title v-success-title"},[t._v("\n      恭喜您，订阅成功！\n    ")])]),t._v(" "),n("com-login",{on:{login:t.loginSuccess}})],1)};n._withStripped=!0;var a=i(10),o=i.n(a),s=i(51),l=i.n(s),r=i(72),c=i.n(r),u=i(17),h=i.n(u),d=i(12),v=i.n(d),p=i(50),f=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"v-video-box"},[i("div",{staticClass:"v-video"},[i("play-video",{attrs:{role:"watcher","play-type":t.playType,startInit:t.startInit}})],1),t._v(" "),t.domShow?i("div",{staticClass:"v-function-box"},[i("div",{staticClass:"v-nav"},[i("com-tabs",{attrs:{value:t.tabValue},on:{"update:value":function(e){t.tabValue=e},change:t.tabChange}},[i("com-tab",{attrs:{label:"活动简介",index:1}},[i("div",{staticClass:"v-introduction",domProps:{innerHTML:t._s(t.activityInfo.description)}})]),t._v(" "),i("com-tab",{attrs:{label:"互动聊天",index:2}},[i("div",{staticClass:"chat-content"},[i("chating",{ref:"chatbox",attrs:{type:t.playType,isWatch:t.isWatch,sendBoxShow:t.sendBoxShow},on:{closeChatBox:t.closeChatBox,isMute:function(e){t.isMute(e)}}})],1),t._v(" "),"live"===t.playType&&t.isLogin?[t.isMuteShow?void 0:[i("div",{staticClass:"v-chat-control",attrs:{id:"sendBoxBtn"},on:{click:function(e){t.chatClick()}}},[i("i",{staticClass:"iconfont icon-biaoqing"}),t._v(" "),i("span",{staticClass:"v-chat-clickbox"},[t._v("\n                  输入文字聊天\n                ")])])]]:"live"!==t.playType||t.isLogin?t._e():[i("div",{staticClass:"v-chat-control v-noLogin",attrs:{id:"sendBoxBtn"}},[t._v("\n              需要登录才能参与聊天\n              "),i("span",{on:{click:t.doLogin}},[t._v("登录")])])]],2)],1)],1)]):t._e(),t._v(" "),i("com-login",{on:{login:t.loginSuccess}})],1)};f._withStripped=!0;var m=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"play-container"},["pre"==t.playType?i("div",{staticClass:"play-video-box",attrs:{id:t.playBoxId}},[t.imageSrc?i("img",{staticClass:"v-mark-img",attrs:{src:t.imageSrc}}):t._e()]):"live"==t.playType?i("div",{staticClass:"play-video-box",attrs:{id:t.playBoxId}}):"vod"==t.playType?i("div",{staticClass:"play-video-box",attrs:{id:t.playBoxId}},[i("div",{staticStyle:{width:"100%",height:"100%"},domProps:{innerHTML:t._s(this.outLineLink)}})]):"end"==t.playType?i("div",{staticClass:"play-video-box",attrs:{id:t.playBoxId}},["master"!==t.role?i("span",{staticClass:"end-box"},[t._v("直播已结束")]):t._e()]):i("div",{staticClass:"play-video-box",attrs:{id:t.playBoxId}},[t.imageSrc?i("img",{staticClass:"v-mark-img",attrs:{src:t.imageSrc}}):t._e()]),t._v(" "),t.playBtnShow?i("i",{staticClass:"iconfont icon-bofang",on:{click:t.playVideo}}):t._e(),t._v(" "),"vod"==t.playType&&!t.outLineLink||"warm"==t.playType||"live"==t.playType&&"watcher"==t.role?i("div",{staticClass:"v-click-modal",on:{click:t.modalClick}}):t._e(),t._v(" "),i("div",{staticClass:"control-box-div"},["vod"==t.playType&&!t.outLineLink||"warm"==t.playType||"live"==t.playType&&"watcher"==t.role?i("div",{staticClass:"control-video-box"},[i("video-control",{ref:"mychild",attrs:{currentTime:t.currentTime,totalTime:t.totalTime,qualitys:t.qualitys,playType:t.playType,playState:t.isPlayState,currentQuality:t.currentQuality},on:{control:t.playControl}})],1):t._e()]),t._v(" "),t.isPlay||"vod"!=t.playType&&"live"!=t.playType&&"warm"!=t.playType?t._e():i("div",{staticClass:"v-mark",on:{click:t.startPlay}},[i("i",{staticClass:"iconfont icon-bofang_anniu"})])])};m._withStripped=!0;var y=i(106),g=i.n(y),w=i(73),I=i.n(w),S=i(74),_=i.n(S),C=i(221),x=i.n(C),b=i(222),P=i.n(b),T=i(223),k=i.n(T),B=function(t){function e(t,i,n,a){I()(this,e);var o=x()(this,(e.__proto__||g()(e)).call(this,t,n,a));return o.type="live",o.roomId=i,o}return k()(e,t),_()(e,[{key:"initLivePlayer",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this,i=(arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]?arguments[2]:null);console.log("1调用初始化拉流器");var n=navigator.userAgent,a={};!!n.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)||!n.match(/MicroMessenger/i)&&!n.match(/QQ/i)||(a={"x5-video-player-type":"h5","x5-video-orientation":"landscape|portrait","x5-video-player-fullscreen":!0}),window.Vhall.ready(function(){console.log("2SDK初始化完成"),window.VhallPlayer.init({roomId:e.roomId,type:"live",videoNode:e.rootEleId,videoAttr:a,complete:function(){},ready:function(){alert(t),console.log("3播放器初始化完成"),i&&i(),t&&window.VhallPlayer.play()},error:function(t){console.log(t)}}),e.player=window.VhallPlayer})}},{key:"accountId",set:function(t){P()(e.prototype.__proto__||g()(e.prototype),"accoundId",t,this),console.log("aaa",this.appId,this.roomId,this.rootEleId,this.token),window.Vhall.config({appId:this.appId,accountId:t,token:this.token})}}]),e}(function(){function t(e,i,n){I()(this,t),this.appId=e,this.rootEleId=i,this.token=n,this.type="",this._accountId=null,this.player=null}return _()(t,[{key:"play",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.player.play(),t&&t()}},{key:"pause",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.player.pause(),t&&t()}},{key:"resume",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.player.play(),t&&t()}},{key:"getQuality",value:function(){return this.player.getQuality()}},{key:"setQuality",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.player.setQuality(t),e&&e()}},{key:"setFullScreen",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.player.setFullScreen(t),e&&e()}},{key:"isFullscreen",value:function(){return this.player.isFullscreen()}},{key:"destroy",value:function(){this.player&&this.player.destroy()}},{key:"accoundId",set:function(t){this._accountId=t},get:function(){return this._accountId}},{key:"volume",set:function(t){this.player.setVolume(t)}},{key:"width",set:function(t){this.player.setWidth(t)}},{key:"height",set:function(t){this.player.setHeight(t)}},{key:"netWorkState",get:function(){return this.player.getNetworkState()}}]),t}()),L=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.controlBoxIsShow?i("div",{staticClass:"control-box"},[i("div",{staticClass:"auto-box",style:{display:t.displayVal}},["live"!=t.playType?i("div",{staticClass:"mode-item fl"},[t.isPlay?i("i",{staticClass:"iconfont icon-zanting_icon",attrs:{title:"播放"},on:{click:function(e){t.playEvent(!1)}}}):i("i",{staticClass:"iconfont icon-bofang_icon",attrs:{title:"暂停"},on:{click:function(e){t.playEvent(!0)}}})]):t._e(),t._v(" "),"live"!=t.playType?i("div",{staticClass:"mode-item time-box"},[i("span",[t._v(t._s(t.currentDate))]),t._v(" "),i("span",[t._v("/"+t._s(t.allDate))])]):t._e(),t._v(" "),"live"!=t.playType?i("div",{staticClass:"mode-item",staticStyle:{flex:"1"}},[i("div",{staticClass:"progress-box"},[i("el-slider",{attrs:{"format-tooltip":t.formatTooltip},on:{change:t.changeVal},model:{value:t.progress,callback:function(e){t.progress=e},expression:"progress"}})],1)]):t._e(),t._v(" "),"live"!=t.playType?i("div",{staticClass:"mode-item fr",on:{click:t.overEvent}},[i("span",{staticClass:"quality-info"},[t._v("画质")]),t._v(" "),i("transition",{attrs:{name:"fade"}},[t.showQualityBlock?i("div",{staticClass:"qualitys-box"},t._l(t.qualitys,function(e,n){return i("span",{class:{"quality-item":!0,active:t.selectQuality==n},on:{click:function(e){e.stopPropagation(),t.selectQualityFn(n)}}},[t._v(t._s(e))])})):t._e()])],1):t._e(),t._v(" "),i("div",{ref:"setFullScreen",staticClass:"mode-item fr"},[i("i",{staticClass:"iconfont icon-zuidahua_icon",on:{click:t.fullScreeEvent}})])])]):t._e()};L._withStripped=!0;var A="mute",O="play",E="volumeSize",M="selectQuality",N="fullBrowser",$="progress",V={mute:"声音控制",play:"播放控制",volumeSize:"声音大小",fullScree:"全屏控制",selectQuality:"画质量",fullBrowser:"浏览器-全屏",progress:"播放进度"},j={name:"control",data:function(){return{mute:!1,isPlay:!0,volumeSize:100,fullScree:!1,isFullBrowser:!1,showQualityBlock:!1,selectQuality:0,current:0,progress:0,controlBoxIsShow:!0,interval:null}},computed:{allDate:function(){return this.formatDate(this.totalTime)},currentDate:function(){return this.formatDate(this.currentTime)},rate:function(){return parseInt(100*this.currentTime/this.totalTime)},displayVal:function(){return"live"===this.playType?"block":"flex"}},props:{currentTime:{type:Number,default:0},totalTime:{type:Number,default:1e3},qualitys:{type:Array,default:["same"]},playType:{type:String,required:!0,default:""},currentQuality:String},watch:{currentTime:{handler:function(t){this.current=t},immediate:!0},rate:{handler:function(t){this.progress=t},immediate:!0},volumeSize:function(t){this.changeControl(E,t)},currentQuality:{handler:function(t){this.selectQuality=this.qualitys.indexOf(t)}}},methods:{changeControl:function(t,e){this.$emit("control",{type:t,value:e,msg:V[t]})},formatTooltip:function(t){return t+"%"},changeVal:function(){this.changeControl($,this.progress)},muteEvent:function(){this.mute=!this.mute,this.changeControl(A,this.mute)},overEvent:function(){this.showQualityBlock=!0},outEvent:function(){this.showQualityBlock=!1},playEvent:function(t){this.isPlay=t,this.changeControl(O,this.isPlay)},fullScreeEvent:function(){this.isX5()?alert("请把手机横屏放置"):window.VhallPlayer.setFullScreen(!0)},fullBrowser:function(){this.isFullBrowser=!this.isFullBrowser,this.changeControl(N,this.isFullBrowser)},formatDate:function(t){var e=(t/3600>>0)+"",i=((t/60%60>>0)+"").padStart(2,0),n=((t%60>>0)+"").padStart(2,0);return e>0?e+":"+i+":"+n:i+":"+n},selectQualityFn:function(t){this.selectQuality!==t&&(this.selectQuality=t,this.changeControl(M,this.qualitys[t]),this.showQualityBlock=!1)},changeControlStatus:function(){var t=this;this.controlBoxIsShow=!0,clearInterval(this.interval),this.interval=setInterval(function(){t.controlBoxIsShow=!1,clearInterval(t.interval)},5e3)},isX5:function(){var t=navigator.userAgent;return!(!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)||!t.match(/MicroMessenger/i)&&!t.match(/QQ/i))}}},U=(i(290),i(1)),H=Object(U.a)(j,L,[],!1,null,"a65f7196",null);H.options.__file="src/pages/watch/video/control.vue";var D=H.exports,F=i(3),J=i(226),Q=i(0),G=i.n(Q),z={},R=[];z.instance||(z.instance=new G.a),z.$on=function(t,e){-1===R.indexOf(t)&&R.push(t),z.instance.$on(t,e)},z.$emit=function(t,e){z.instance.$emit(t,e)},z.offAll=function(t,e){R.forEach(function(t){z.instance.$off(t)})};var W=z,q={name:"index",components:{VideoControl:D},data:function(){return{playComps:{},playBtnShow:!1,imageUrl:"",recordId:"",outLineLink:"",playBoxId:"play-vides-"+Math.random(),sdkPlayParam:{appId:"",accountId:"",token:""},currentTime:0,totalTime:1e4,stInterval:"",isPlay:!1,isAutoPlay:!1,controlPsoition:"1.333vw",qualitys:[],currentQuality:"",isPlayState:!1}},props:{role:{type:String,default:"watcher"},playType:{type:String,required:!0,default:""},startInit:{type:Boolean,required:!0,default:!1},paasParams:{appId:"",roomId:"",inavId:"",token:"",accountId:""}},computed:v()({},Object(p.c)("liveMager",{liveDevices:function(t){return t.liveDevices},roomPaas:function(t){return t.roomPaas},activityInfo:function(t){return t.activityInfo}}),{imageSrc:function(){return this.imageUrl?this.$imgHost+"/"+this.imageUrl:"//cnstatic01.e.vhall.com/static/img/v35-webinar.png"}}),created:function(){var t=this;W.$on("exitFullScreen",function(){t.isPlay=!1})},mounted:function(){var t=this;window.addEventListener("onorientationchange"in window?"orientationchange":"resize",function(){90===window.orientation||-90===window.orientation?(t.$emit("orientationchange","horizontalScreen"),t.horizontalScreen()):(t.herticalScreen(),t.$emit("orientationchange","herticalScreen"))},!1)},watch:{startInit:function(t){t||this.stopPlay()},playType:{handler:function(){this.changePlayType()}},liveDevices:function(){this.changeLiveDevice()}},beforeDestroy:function(){console.log("--video-com--beforeDestroy"),clearInterval(this.setIntervalHandler),window.hostPusher&&window.hostPusher.destroy(),window.playComps&&window.playComps.destroy(),window.VhallPlayer&&window.VhallPlayer.destroy()},methods:v()({},Object(p.b)("liveMager",{storeRoomPaas:F.h}),{initComponent:function(){this.isPlayState=!1,this.destoryComs(),"live"===this.playType?this.initLivePlay():"pre"===this.playType?this.imageUrl=this.activityInfo.imgUrl:"warm"===this.playType?this.queryWarmInfo():"vod"===this.playType?this.initPlayBack():"end"===this.playType&&this.playEnd()},changePlayType:function(){this.startInit&&-1!=="live|warm|vod|end|pre".indexOf(this.playType)&&(this.isAutoPlay=!1,this.destoryComs(),this.initComponent())},playEnd:function(){clearInterval(this.setIntervalHandler),window.hostPusher&&window.hostPusher.destroy(),window.playComps&&window.playComps.destroy(),window.VhallPlayer&&window.VhallPlayer.destroy()},playVideo:function(){"warm"===this.playType&&this.playBackVideo()},startPlay:function(){var t=this.activityInfo.warm;"warm"===this.playType&&t.record.list.length<=0?this.$messageBox({header:"提示",content:"此时没有暖场视频",confirmText:"确定",handleClick:function(t){"cancel"===t.action||t.action}}):(this.isPlay=!this.isPlay,this.imageUrl="",this.qualitys=window.VhallPlayer.getQualitys(),window.VhallPlayer.play(),"live"!==this.playType&&this.dealWithVideo())},changeLiveDevice:function(){window.hostPusher&&window.hostPusher.changeSetting({video:{deviceId:this.liveDevices.camera},audio:{deviceId:this.liveDevices.mic},conf:{videoSize:[800,450,800,450]}})},initLivePlay:function(){"watcher"===this.role&&this.initPuller()},initPlayBack:function(){var t=this;this.$config({handlers:!0}).$get(J.a.GET_DEFAULEREPLAY,{activityId:this.$route.params.id}).then(function(e){e.data&&(t.imageUrl=e.data.cover,"LINK"===e.data.replay.type?t.outLineLink=e.data.replay.link:"VIDEO"!==e.data.replay.type&&"SLICE"!==e.data.replay.type||(t.recordId=e.data.replay.video,t.totalTime=e.data.replay.duration,t.playBackVideo()))}).catch(function(){})},playBackVideo:function(){var t=this;this.$nextTick(function(){if(t.recordId){var e={};t.isX5()&&(e={"x5-video-player-type":"h5","x5-video-orientation":"landscape|portrait","x5-video-player-fullscreen":!0}),window.Vhall.ready(function(){window.VhallPlayer.init({recordId:t.recordId,type:"vod",videoNode:t.playBoxId,videoAttr:e,complete:function(){t.playBtnShow=!1,t.qualitys=window.VhallPlayer.getQualitys(),t.isX5()?(document.getElementsByClassName("vjs-tech")[0].addEventListener("x5videoexitfullscreen",function(){t.changeX5ExitFullScreen()}),document.getElementsByClassName("vjs-tech")[0].addEventListener("x5videoenterfullscreen",function(){t.changeX5EnterFullScreen()})):(document.getElementsByClassName("vjs-tech")[0].style.height="56.267vw",document.getElementsByClassName("vjs-tech")[0].style["margin-top"]="10.667vw")}})}),window.Vhall.config({appId:t.roomPaas.appId,accountId:t.roomPaas.accountId,token:t.roomPaas.token})}})},dealWithVideo:function(){clearInterval(this.setIntervalHandler);var t=this;t.setIntervalHandler=setInterval(function(){t.currentTime=window.VhallPlayer.getCurrentTime(),t.totalTime<=t.currentTime&&(clearInterval(t.setIntervalHandler),t.isAutoPlay?(window.VhallPlayer.play(),t.dealWithVideo()):(t.isPlay=!1,t.currentTime=0)),"live"!==t.playType&&window.VhallPlayer.getCurrentQuality&&(t.currentQuality=window.VhallPlayer.getCurrentQuality())},1e3)},queryWarmInfo:function(){var t=this.activityInfo.warm;this.imageUrl=t.imgUrl,this.playBtnShow=!0,this.filename=t.filename,this.recordId=t.recordId,this.isAutoPlay="AUTO"===t.playType,this.isPlayState=this.isAutoPlay,this.totalTime=parseInt(t.record.duration),this.playBackVideo()},initPuller:function(){var t=this;window.playComps&&window.playComps.destroy(),this.$nextTick(function(){t.playComps=new B(t.roomPaas.appId,t.roomPaas.liveRoom,t.playBoxId,t.roomPaas.token),t.playComps.initLivePlayer(!0,!0,function(){t.isX5()?(document.getElementsByClassName("vjs-tech")[0].addEventListener("x5videoexitfullscreen",function(){t.changeX5ExitFullScreen()}),document.getElementsByClassName("vjs-tech")[0].addEventListener("x5videoenterfullscreen",function(){t.changeX5EnterFullScreen()})):(document.getElementsByClassName("vjs-tech")[0].style.height="56.267vw",document.getElementsByClassName("vjs-tech")[0].style["margin-top"]="10.667vw"),console.log("----------开始播放----------")}),t.playComps.accountId=t.roomPaas.accountId})},pullBroadCast:function(){var t=this;this.hostPusher.stopBroadCast().then(function(){t.hostPusher.startBroadCast().then(function(){console.log("----------旁路推流成功----------")}).catch(function(e){console.error("旁路推流失败:"+e);var i=setTimeout(function(){clearTimeout(i),t.pullBroadCast()},500)})}).catch(function(t){console.error("停止旁路推流失败:"+t)})},stopPlay:function(){"live"===this.playType&&window.hostPusher.stop()},showVideo:function(t){this.isShowVideo=t,"live"===this.playType?"master"===this.role?window.hostPusher.showVideo(t):"watcher"===this.role&&window.playComps.showVideo(t):"warm"===this.playType||this.playType},mutoAuto:function(t){this.isMutoAuto=t,"live"===this.playType?"master"===this.role?window.hostPusher.mute(t):"watcher"===this.role&&(window.playComps.volume=t?0:50):"warm"===this.playType||this.playType},formatTooltip:function(t){return t/1e4},formatTime:function(t){var e={hour:"",min:"",sed:""};return e.hour=((t/3600%24>>0)+"").padStart(2,0),e.min=((t/60%60>>0)+"").padStart(2,0),e.sed=((t%60>>0)+"").padStart(2,0),e.hour+":"+e.min+":"+e.sed},fullScreen:function(){alert("请把手机横评放置")},horizontalScreen:function(){this.isShowCover=!1,this.height="100%",this.controlPsoition="9.333vw"},herticalScreen:function(){this.isShowCover=!0,this.height="56.267vw",this.controlPsoition="1.333vw"},start:function(){this.isStart=!0,this.puller.play()},play:function(t){"warm"!==this.playType&&"vod"!==this.playType||(t?window.VhallPlayer.play():window.VhallPlayer.pause())},playControl:function(t){var e=t.type;"progress"===e?this.seekProgress(t.value):"play"===e?this.play(t.value):"mute"===e?this.mutoAuto(t.value):"volumeSize"===e?this.changeVolume(t.value):"selectQuality"===e?window.VhallPlayer.setQuality(t.value):"fullScree"===e?this.fullScree(t.value):"fullBrowser"===e&&this.$emit("fullBrowser",t.value)},seekProgress:function(t){window.VhallPlayer&&window.VhallPlayer.seek(this.totalTime*t/100)},destoryComs:function(){clearInterval(this.setIntervalHandler),window.hostPusher&&window.hostPusher.destroy(),window.playComps&&window.playComps.destroy(),window.VhallPlayer&&window.VhallPlayer.destroy()},modalClick:function(){this.$refs.mychild.changeControlStatus()},isX5:function(){var t=navigator.userAgent;return!(!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)||!t.match(/MicroMessenger/i)&&!t.match(/QQ/i))},changeX5EnterFullScreen:function(){W.$emit("enterFullScreen",function(){})},changeX5ExitFullScreen:function(){W.$emit("exitFullScreen",function(){})}})},K=(i(292),Object(U.a)(q,m,[],!1,null,"2bb9b82a",null));K.options.__file="src/pages/watch/video/index.vue";var X=K.exports,Y=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"chat-wrap",on:{click:t.boxClick}},[i("div",{ref:"bscroll",staticClass:"bscroll",class:"live"!==t.type?"vod":"live",on:{mouseover:function(e){t.stopScroll=!0},mouseout:function(e){t.stopScroll=!1}}},[i("ol",{staticClass:"chat-list bscroll-container"},t._l(t.chatData,function(e,n){return i("li",{class:{right:1*t.joinInfo.activityUserId==1*e.id},attrs:{"data-joinId":e.id}},[i("dl",{staticClass:"clearfix"},[""!==e.avatar&&null!==e.avatar?i("dt",[i("img",{attrs:{src:t.imgHost+"/"+e.avatar}})]):i("dt",{staticClass:"avatar"},[t._v(t._s(e.name&&e.name.substr(0,1)))]),t._v(" "),i("dd",[i("div",{staticClass:"name"},[t._v(t._s(e.name)+"\n              "),e.detail.role?i("em",[t._v(t._s(e.detail.role))]):t._e()]),t._v(" "),i("div",{staticClass:"txt",domProps:{innerHTML:t._s(e.detail.txt)}})])])])})),t._v(" "),t.tipsShow&&t.tipsCount>0?i("transition",[i("span",{staticClass:"msg-tips",on:{click:t.scrollBtm}},[t._v("有"+t._s(t.tipsCount)+"条新消息\n        "),i("i",{staticClass:"iconfont icon-xiangxia"})])]):t._e(),t._v(" "),t.announceShow?i("div",{staticClass:"announce-box"},[i("svg",{staticClass:"icon",staticStyle:{width:"6.667vw",height:"6.667vw","vertical-align":"middle",fill:"currentColor",overflow:"hidden"},attrs:{viewBox:"0 0 1305 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"3285"}},[i("path",{attrs:{d:"M236.3648 689.6384a102.4 102.4 0 0 1 144.6144 7.5776l119.9104 133.1712a102.4 102.4 0 1 1-152.2176 137.0368l-119.9104-133.1712a102.4 102.4 0 0 1 7.6032-144.64z",fill:"#222222","p-id":"3286"}}),t._v(" "),i("path",{attrs:{d:"M277.4528 734.4384a25.6 25.6 0 0 0-1.8944 36.1472l119.9104 133.1968a25.6 25.6 0 0 0 38.0672-34.2784l-119.9104-133.1712a25.6 25.6 0 0 0-36.1728-1.8944z",fill:"#FFD021","p-id":"3287"}}),t._v(" "),i("path",{attrs:{d:"M144.5888 482.4832l47.2064-12.416a464.8448 464.8448 0 0 0 278.3744-207.104l72.832-119.1168c-15.3088 169.7024-7.9104 291.7888 22.1696 366.208 30.08 74.4704 107.52 162.304 232.2944 263.6032l-138.3168-37.7088a456.064 456.064 0 0 0-342.9376 42.1376l-42.5472 23.8336a173.6704 173.6704 0 0 1-245.9392-86.4256 173.6704 173.6704 0 0 1 116.864-233.0112z",fill:"#222222","p-id":"3288"}}),t._v(" "),i("path",{attrs:{d:"M211.328 544.3328l-47.2064 12.4416a96.8448 96.8448 0 0 0-59.904 141.056 96.8704 96.8704 0 0 0 131.8656 37.12l42.5472-23.8336a532.8384 532.8384 0 0 1 389.632-52.1472L528.896 313.9328a541.7728 541.7728 0 0 1-317.5424 230.4z",fill:"#FFD021","p-id":"3289"}}),t._v(" "),i("path",{attrs:{d:"M819.5072 795.9552c-94.4896 38.1696-217.088-93.1072-293.3248-281.856-76.2624-188.7232-79.2832-368.3072 15.2064-406.5024 94.5152-38.144 217.088 93.1328 293.3504 281.856 76.2368 188.7232 79.2576 368.3072-15.232 406.5024z",fill:"#222222","p-id":"3290"}}),t._v(" "),i("path",{attrs:{d:"M790.7328 724.736c12.9792-5.248 24.2944-35.7888 23.424-88.0384-1.024-61.3888-18.7904-139.6736-50.6368-218.496s-73.472-147.456-115.3536-192.3072c-35.6608-38.1952-65.024-52.3264-78.0032-47.104s-24.2688 35.8144-23.3984 88.064c1.024 61.3888 18.7648 139.6736 50.6112 218.496s73.472 147.456 115.3792 192.3328c35.6608 38.1696 65.024 52.3008 77.9776 47.0528z",fill:"#FFD021","p-id":"3291"}}),t._v(" "),i("path",{attrs:{d:"M668.8256 525.4912a76.8 76.8 0 1 1-57.5488-142.3872 76.8 76.8 0 0 1 57.5488 142.3872zM840.9088 233.2928a38.4 38.4 0 1 1-50.176-58.1376l172.544-148.8896a38.4 38.4 0 1 1 50.1504 58.1376l-172.544 148.8896zM951.04 575.1552a38.4 38.4 0 0 1-3.712-76.7232l256.9472-12.3648a38.4 38.4 0 0 1 3.6864 76.7232l-256.9472 12.3648zM902.4 407.9872a38.4 38.4 0 1 1-31.9488-69.8368l370.0736-169.344a38.4 38.4 0 1 1 31.9488 69.8368L902.4 407.9872zM201.3696 637.8496a25.6 25.6 0 1 1-12.1856-49.7152c14.08-3.456 24.576-6.144 31.488-8.0128a25.6 25.6 0 1 1 13.5936 49.3312c-7.4752 2.0736-18.4064 4.864-32.896 8.3968z m111.1552-35.4048a25.6 25.6 0 1 1-20.864-46.7712c40.2688-17.9712 84.7872-42.5216 133.4272-73.6256a25.6 25.6 0 1 1 27.5712 43.136c-50.688 32.4096-97.3568 58.1632-140.1344 77.2608z",fill:"#222222","p-id":"3292"}})]),t._v(" "),i("com-marquee",{staticClass:"marquee",attrs:{content:t.receiveAnnounce},on:{over:function(e){t.announceShow=!1}}}),t._v(" "),i("i",{staticClass:"iconfont icon-close",on:{click:function(e){t.announceShow=!1}}})],1):t._e()],1),t._v(" "),"live"===t.type&&t.isLogin&&t.sendBoxShow?i("div",{staticClass:"v-send-box-bg"},[i("div",{staticClass:"send-box clearfix",attrs:{id:"sendBox"}},[i("div",{staticClass:"top"},[i("span",{staticClass:"cancel-btn fl",on:{click:t.cancelClick}},[t._v("取消")]),t._v(" "),i("span",{staticClass:"v-title"},[t._v("\n          聊天\n        ")]),t._v(" "),(t.mute||t.allMuted)&&t.isWatch?void 0:[i("span",{staticClass:"send-btn fr",on:{click:t.sendAction}},[t._v("发送")])],t._v(" "),"HOST"!==t.joinInfo.roleName||t.isWatch?t._e():i("div",{staticClass:"fr"},[i("i",{staticClass:"icon-swap",attrs:{title:"切换发送聊天/公告"},on:{click:function(e){t.swapAnnounce?t.swapAnnounce=!1:t.swapAnnounce=!0}}}),t._v(" "),i("div",{staticClass:"switch-box"},[i("span",[t._v("全体禁言")]),t._v(" "),i("el-switch",{staticClass:"switch",attrs:{"inactive-color":"#DEE1FF",width:32,"active-color":"#FFD021"},on:{change:t.muteAll},model:{value:t.allMuted,callback:function(e){t.allMuted=e},expression:"allMuted"}})],1)])],2),t._v(" "),i("div",{staticClass:"bottom clearfix"},[t.swapAnnounce?[i("com-input",{staticClass:"inp",attrs:{value:t.value,placeholder:t.chatPlaceholder,"max-length":140,type:"textarea"},on:{"update:value":function(e){t.value=e}}})]:[i("com-input",{staticClass:"inp",attrs:{value:t.valueAnnounce,placeholder:t.announcePlaceholder,"max-length":140,type:"textarea"},on:{"update:value":function(e){t.valueAnnounce=e}}})],t._v(" "),i("div",{staticClass:"v-emoji"},[i("i",{staticClass:"iconfont icon-biaoqing",attrs:{title:"表情"},on:{click:function(e){return e.stopPropagation(),t.changeFace(e)}}}),t._v(" "),t.faceOpen?i("div",{staticClass:"face-box"},t._l(t.faceArr,function(e,n){return i("img",{key:n,attrs:{src:"//cnstatic01.e.vhall.com/static/img/arclist/Expression_"+(n+1)+"@2x.png"},on:{click:function(e){e.stopPropagation(),t.inFace(n)}}})})):t._e()])],2)])]):t._e()])};Y._withStripped=!0;var Z=i(29),tt=i.n(Z),et=i(228),it=i(224),nt={name:"chat",data:function(){return{vhallParams:{token:"",appId:"",channelId:"",accountId:""},activityId:this.$route.params.id,value:"",valueAnnounce:"",receiveAnnounce:"",service:null,chatData:[],tipsShow:!1,announceShow:!1,faceOpen:!1,swapAnnounce:!0,mute:!1,allMuted:!1,tipsCount:0,timer:null,isLogin:!1,stopScroll:!1,chatPlaceholder:"输入想说的话…",announcePlaceholder:"请输入公告内容",aBScroll:null,imgHost:"//test-zhike.oss-cn-beijing.aliyuncs.com/",faceArr:[{"[微笑]":"1"},{"[撇嘴]":"2"},{"[色]":"3"},{"[发呆]":"4"},{"[得意]":"5"},{"[流泪]":"6"},{"[害羞]":"7"},{"[闭嘴]":"8"},{"[睡]":"9"},{"[哭]":"10"},{"[尴尬]":"11"},{"[发怒]":"12"},{"[调皮]":"13"},{"[呲牙]":"14"},{"[惊讶]":"15"},{"[难过]":"16"},{"[酷]":"17"},{"[汗]":"18"},{"[抓狂]":"19"},{"[吐]":"20"},{"[偷笑]":"21"},{"[愉快]":"22"},{"[白眼]":"23"},{"[傲慢]":"24"},{"[饥饿]":"25"},{"[困]":"26"},{"[惊恐]":"27"},{"[流汗]":"28"},{"[憨笑]":"29"},{"[悠闲]":"30"},{"[奋斗]":"31"},{"[咒骂]":"32"},{"[疑问]":"33"},{"[嘘]":"34"},{"[晕]":"35"},{"[疯了]":"36"},{"[衰]":"37"},{"[骷髅]":"38"},{"[敲打]":"39"},{"[再见]":"40"},{"[擦汗]":"41"},{"[抠鼻]":"42"},{"[鼓掌]":"43"},{"[糗大了]":"44"},{"[坏笑]":"45"},{"[左哼哼]":"46"},{"[右哼哼]":"47"},{"[哈欠]":"48"},{"[鄙视]":"49"},{"[委屈]":"50"},{"[快哭了]":"51"},{"[阴险]":"52"},{"[亲亲]":"53"},{"[吓]":"54"},{"[可怜]":"55"},{"[菜刀]":"56"},{"[西瓜]":"57"},{"[啤酒]":"58"},{"[篮球]":"59"},{"[乒乓]":"60"},{"[咖啡]":"61"},{"[饭]":"62"},{"[猪头]":"63"},{"[玫瑰]":"64"},{"[凋谢]":"65"},{"[嘴唇]":"66"},{"[爱心]":"67"},{"[心碎]":"68"},{"[蛋糕]":"69"},{"[闪电]":"70"},{"[炸弹]":"71"},{"[刀]":"72"},{"[足球]":"73"},{"[瓢虫]":"74"},{"[便便]":"75"},{"[月亮]":"76"},{"[太阳]":"77"},{"[礼物]":"78"},{"[拥抱]":"79"},{"[强]":"80"},{"[弱]":"81"},{"[握手]":"82"},{"[胜利]":"83"},{"[抱拳]":"84"},{"[勾引]":"85"},{"[拳头]":"86"},{"[差劲]":"87"},{"[爱你]":"88"},{"[NO]":"89"},{"[OK]":"90"}]}},props:{type:{type:String,default:"live"},isWatch:{type:Boolean,default:!1},sendBoxShow:{type:Boolean,default:!1}},computed:v()({},Object(p.c)("liveMager",{roomPaas:function(t){return t.roomPaas},activityInfo:function(t){return t.activityInfo},joinInfo:function(t){return t.joinInfo}}),Object(p.c)("tokenMager",{chatParams:function(t){return t.chatParams}}),Object(p.c)("login",{loginInfo:function(t){return t.loginInfo}})),mounted:function(){this.isWatch||(this.isLogin=!0)},methods:v()({},Object(p.b)("tokenMager",{setChatParams:F.b}),Object(p.b)("liveMager",{storeJoinInfo:F.d}),{initSdk:function(){var t={channelId:this.roomPaas.channelRoom};tt()(this.roomPaas,t),et.a.OBJ.init(this.roomPaas),et.a.OBJ.regHandler("chat",this.listenChat),et.a.OBJ.regHandler("ANNOUNCEMENT",this.listenAnnounce),et.a.OBJ.regHandler("KICK",this.listenKick),et.a.OBJ.regHandler("DISABLE_KICK",this.listenCancelkick),et.a.OBJ.regHandler("GAG",this.listenMute),et.a.OBJ.regHandler("DISABLE_GAG",this.listenCancelmute),et.a.OBJ.regHandler("GAG_ALL",this.listenAllmute),et.a.OBJ.regHandler("DISABLE_GAG_ALL",this.listenCancelallmute)},changeFace:function(){this.faceOpen=!this.faceOpen},sendAction:function(){if(!this.value.replace(/\n/g,"").length)return this.chatPlaceholder="聊天内容不能为空",!1;var t="HOST"===this.joinInfo.roleName?"主持人":"";et.a.OBJ.activityId=this.activityId;var e={role:t,txt:this.value};et.a.OBJ.sendChat(h()(e)),_log.track(Vhall_User_Actions.CHAT,{event:encodeURIComponent(this.value)}),this.value="",this.chatPlaceholder="输入想说的话…",this.faceOpen=!1,this.$emit("closeChatBox",!0)},listenChat:function(t){console.log("接收 聊天消息",t),this.reArrange(t),this.tipsShow&&this.tipsCount++},listenAnnounce:function(t){console.log("接收 公告消息",t),this.announceShow=!0,this.receiveAnnounce=t.content},listenKick:function(t){console.log("接收 踢出消息",t),this.refreshList(t.activityUserId,"isKick","Y"),this.isSelf(t.activityUserId)&&this.$router.push({path:"/kicked"})},listenCancelkick:function(t){console.log("接收 取消踢出消息"+t),this.refreshList(t.activityUserId,"isKick","N")},listenMute:function(t){console.log("接收 禁言消息",t),this.refreshList(t.activityUserId,"isGag","Y"),this.isSelf(t.activityUserId)&&(this.mute=!0)},listenCancelmute:function(t){this.refreshList(t.activityUserId,"isGag","N"),console.log("接收 取消禁言消息",t),this.isSelf(t.activityUserId)&&(this.mute=!1)},listenAllmute:function(t){console.log("接收 全体禁言消息",t),this.allMuted=!0},listenCancelallmute:function(t){console.log("接收 取消全体禁言消息",t),this.allMuted=!1},isSelf:function(t){return this.joinInfo.activityUserId===t},refreshList:function(t,e,i){this.chatData.forEach(function(n){1*n.id==1*t&&(n[e]=i)})},reArrange:function(t){var e={};if(e.id=t.third_party_user_id,e.avatar=t.avatar,e.name=t.nick_name,e.isGag=t.isGag,e.isKick=t.isKick,e.detail=JSON.parse(t.data),this.faceArr.forEach(function(t,i){for(var n in t){var a=n.replace(/\[/,"\\[").replace(/\]/,"\\]"),o=new RegExp(a,"g");e.detail.txt=e.detail.txt.replace(o,"<img src='//cnstatic01.e.vhall.com/static/img/arclist/Expression_"+t[n]+"@2x.png'>")}}),this.chatData.push(e),!this.tipsShow&&!this.stopScroll){var i=this;setTimeout(function(){i.scrollBtm()},200)}this.stopScroll&&(this.tipsShow=!0)},sendAnnounce:function(){var t=this;if(!this.valueAnnounce.replace(/\n/g,"").length)return this.announcePlaceholder="公告内容不能为空",!1;var e={activityId:this.activityId,message:this.valueAnnounce};this.$get(J.a.GET_SENDANNOUNCEMENT,e).then(function(e){t.$toast({content:"公告发送成功"}),t.valueAnnounce="",t.announcePlaceholder="请输入公告内容",t.$emit("closeChatBox",!0)})},cancelClick:function(){this.$emit("closeChatBox",!0)},scrollBtm:function(){var t=this;this.aBScroll.scrollTo(0,this.aBScroll.maxScrollY,500,"bounce"),setTimeout(function(){t.tipsCount=0},500)},inFace:function(t){for(var e in this.faceArr[t])this.value+=e},boxClick:function(t){"icon-emoji"!==t.target.className&&(this.faceOpen=!1)},getHistroy:function(){var t=this;this.$get(J.a.GET_MESSAGELIST,{activityId:this.activityId}).then(function(e){e.data.reverse().forEach(function(e){t.reArrange(e)})})},muteAll:function(){var t=this,e={activityId:this.activityId,cancel:this.allMuted?"N":"Y"};this.$post(J.a.POST_GAGALL,e).then(function(i){t.$toast({content:"Y"===e.cancel?"已取消全体禁言":"已开启全体禁言"})})},initToken:function(){if(this.isWatch)return this.roomPaas},initScroll:function(){var t=this;this.$nextTick(function(){var e=t.$refs.bscroll;t.aBScroll=new it.a(e,{scrollbar:!0,click:!0,mouseWheel:!0,"probeType ":3}),t.aBScroll.on("scrollEnd",function(e){var i=document.getElementsByClassName("chat-list")[0].offsetHeight;.5*i>document.getElementsByClassName("bscroll")[0].offsetHeight&&.5*i>-1*e.y?t.tipsShow=!0:t.tipsShow=!1})})},initInfo:function(){var t=this;return c()(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.initSdk();case 1:case"end":return e.stop()}},e,t)}))()},loginHandler:function(){this.$emit("showLogin")}}),watch:{"loginInfo.consumerUserId":{handler:function(t){t&&this.isWatch&&(this.isLogin=!0)},deep:!0,immediate:!0},allMuted:{handler:function(t){t?this.$emit("isMute",{isMute:!0,type:"allMuted"}):this.$emit("isMute",{isMute:!1,type:"allMuted"})},deep:!0},mute:{handler:function(t){t?this.$emit("isMute",{isMute:!0,type:"mute"}):this.$emit("isMute",{isMute:!1,type:"mute"})},deep:!0},"activityInfo.setting.gag":{handler:function(t){this.allMuted="Y"===t},deep:!0},"roomPaas.channelId":{handler:function(t){t&&(console.log(t),this.initInfo())},immediate:!0,deep:!0},"joinInfo.isGag":{handler:function(t){"Y"===t&&this.isWatch&&(this.mute=!0)},deep:!0,immediate:!0},"joinInfo.isKick":{handler:function(t){"Y"===t&&this.isWatch&&this.$router.push({path:"/kicked"})},deep:!0,immediate:!0}}},at=(i(294),Object(U.a)(nt,Y,[],!1,null,"3a2ec7eb",null));at.options.__file="src/components/chat/index.vue";var ot=at.exports,st=i(227),lt=i(229),rt={props:{domShow:Boolean},mixins:[st.a],components:{PlayVideo:X,Chating:ot},data:function(){return{playType:"",startInit:!1,tabValue:1,isWatch:!0,chatListInit:!1,sendBoxShow:!1,isLogin:!1,isMuteShow:!1,allMuted:!1}},computed:v()({},Object(p.c)("liveMager",{activityInfo:function(t){return t.activityInfo},roomPaas:function(t){return t.roomPaas},joinInfo:function(t){return t.joinInfo}}),Object(p.c)("login",{loginInfo:function(t){return t.loginInfo}})),mounted:function(){this.storeLoginInfo(this.getLoginInfo()),this.playType="vod",this.startInit=!0,this.initMsgServe()},created:function(){},watch:{"loginInfo.consumerUserId":{handler:function(t){t&&this.isWatch&&(this.isLogin=!0)},deep:!0}},methods:v()({},Object(p.b)("login",{storeLoginInfo:F.g}),Object(p.b)("liveMager",{storeActivityInfo:F.a,storeJoinInfo:F.d}),{tabChange:function(){if(2===this.tabValue&&(this.$refs.chatbox.aBScroll||(this.$refs.chatbox.initScroll(),this.$refs.chatbox.getHistroy()),!this.$refs.chatbox.tipsShow)){var t=this;setTimeout(function(){t.$refs.chatbox.scrollBtm()},200)}},initMsgServe:function(){var t=this;et.a.OBJ.init({accountId:this.roomPaas.accountId,token:this.roomPaas.token,appId:this.roomPaas.appId,channelId:this.roomPaas.channelRoom}),et.a.OBJ.regHandler(lt.a.onLineNum,function(e){var i=JSON.parse(h()(t.activityInfo));i.setting.initOnlineNum=e.num,t.storeActivityInfo(i)}),et.a.OBJ.regHandler(lt.a.beginLive,function(e){t.playType="live";var i=JSON.parse(h()(t.activityInfo));console.log(i),i.status="LIVING",i.statusName="直播中",t.storeActivityInfo(i)}),et.a.OBJ.regHandler(lt.a.endLive,function(e){t.playType="end";var i=JSON.parse(h()(t.activityInfo));i.status="FINISH",i.statusName="结束",t.storeActivityInfo(i)}),et.a.OBJ.regHandler(lt.a.joinLive,function(e){console.log("--进入房间--消息--");var i=JSON.parse(h()(t.activityInfo));i.onlineNum=parseInt(i.onlineNum)+1,t.storeActivityInfo(i)}),et.a.OBJ.regHandler(lt.a.leaveLive,function(e){console.log("--离开房间--消息--");var i=JSON.parse(h()(t.activityInfo));i.onlineNum=parseInt(i.onlineNum)-1,t.storeActivityInfo(i)})},isMute:function(t){this.isMuteShow=t.isMute,this.allMuted="allMuted"===t.type},chatClick:function(){this.sendBoxShow=!0},closeChatBox:function(){this.sendBoxShow=!1},loginSuccess:function(t){this.storeLoginInfo(t),this.isLogin=!0,this.$router.go(0)},loginHandler:function(){this.$emit("showLogin")}})},ct=(i(296),Object(U.a)(rt,f,[],!1,null,"3304695f",null));ct.options.__file="src/pages/watch/playback.vue";var ut=ct.exports,ht=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"v-video-box"},[i("div",{staticClass:"v-video"},[i("play-video",{attrs:{role:"watcher","play-type":t.playType,startInit:t.startInit}})],1),t._v(" "),t.domShow?i("div",{staticClass:"v-function-box"},[i("div",{staticClass:"v-nav"},[i("com-tabs",{attrs:{value:t.tabValue},on:{"update:value":function(e){t.tabValue=e},change:t.tabChange}},[i("com-tab",{attrs:{label:"活动简介",index:1}},[i("div",{staticClass:"v-introduction",domProps:{innerHTML:t._s(t.activityInfo.description)}})]),t._v(" "),i("com-tab",{attrs:{label:"互动聊天",index:2}},[i("div",{staticClass:"chat-content"},[i("chating",{ref:"chatbox",attrs:{type:t.playType,isWatch:t.isWatch,sendBoxShow:t.sendBoxShow},on:{closeChatBox:t.closeChatBox,isMute:function(e){t.isMute(e)}}})],1),t._v(" "),"live"===t.playType&&t.isLogin?[t.isMuteShow?[i("div",{staticClass:"v-chat-control v-noLogin",attrs:{id:"sendBoxBtn"}},[t._v("\n                "+t._s(t.allMuted?"已开启全体禁言":"您已被禁言")+"\n              ")])]:[i("div",{staticClass:"v-chat-control",attrs:{id:"sendBoxBtn"},on:{click:function(e){t.chatClick()}}},[i("i",{staticClass:"iconfont icon-biaoqing"}),t._v(" "),i("span",{staticClass:"v-chat-clickbox"},[t._v("\n                  输入文字聊天\n                ")])])]]:"live"!==t.playType||t.isLogin?t._e():[i("div",{staticClass:"v-chat-control v-noLogin",attrs:{id:"sendBoxBtn"}},[t._v("\n              需要登录才能参与聊天\n              "),i("span",{on:{click:t.doLogin}},[t._v("登录")])])]],2)],1)],1)]):t._e(),t._v(" "),i("com-login",{on:{login:t.loginSuccess}})],1)};ht._withStripped=!0;var dt={props:{domShow:Boolean},mixins:[st.a],components:{PlayVideo:X,Chating:ot},data:function(){return{playType:"",startInit:!1,tabValue:1,isWatch:!0,chatListInit:!1,sendBoxShow:!1,isLogin:!1,isMuteShow:!1,allMuted:!1}},computed:v()({},Object(p.c)("liveMager",{activityInfo:function(t){return t.activityInfo},roomPaas:function(t){return t.roomPaas},joinInfo:function(t){return t.joinInfo}}),Object(p.c)("login",{loginInfo:function(t){return t.loginInfo}})),mounted:function(){this.storeLoginInfo(this.getLoginInfo()),"PREPARE"===this.activityInfo.status?this.activityInfo.warm&&"Y"===this.activityInfo.warm.enabled?this.playType="warm":this.playType="pre":"FINISH"===this.activityInfo.status?this.playType="end":this.playType="live",this.startInit=!0,this.initMsgServe()},created:function(){},watch:{"loginInfo.consumerUserId":{handler:function(t){t&&this.isWatch&&(this.isLogin=!0)},deep:!0}},methods:v()({},Object(p.b)("login",{storeLoginInfo:F.g}),Object(p.b)("liveMager",{storeActivityInfo:F.a,storeJoinInfo:F.d}),{tabChange:function(){if(2===this.tabValue&&(this.$refs.chatbox.aBScroll||(this.$refs.chatbox.initScroll(),this.$refs.chatbox.getHistroy()),!this.$refs.chatbox.tipsShow)){var t=this;setTimeout(function(){t.$refs.chatbox.scrollBtm()},200)}},initMsgServe:function(){var t=this;et.a.OBJ.init({accountId:this.roomPaas.accountId,token:this.roomPaas.token,appId:this.roomPaas.appId,channelId:this.roomPaas.channelRoom}),et.a.OBJ.regHandler(lt.a.onLineNum,function(e){var i=JSON.parse(h()(t.activityInfo));i.setting.initOnlineNum=e.num,t.storeActivityInfo(i)}),et.a.OBJ.regHandler(lt.a.beginLive,function(e){t.playType="live";var i=JSON.parse(h()(t.activityInfo));console.log(i),i.status="LIVING",i.statusName="直播中",t.storeActivityInfo(i)}),et.a.OBJ.regHandler(lt.a.endLive,function(e){t.playType="end";var i=JSON.parse(h()(t.activityInfo));i.status="FINISH",i.statusName="结束",t.storeActivityInfo(i)}),et.a.OBJ.regHandler(lt.a.joinLive,function(e){console.log("--进入房间--消息--");var i=JSON.parse(h()(t.activityInfo));i.onlineNum=parseInt(i.onlineNum)+1,t.storeActivityInfo(i)}),et.a.OBJ.regHandler(lt.a.leaveLive,function(e){console.log("--离开房间--消息--");var i=JSON.parse(h()(t.activityInfo));i.onlineNum=parseInt(i.onlineNum)-1,t.storeActivityInfo(i)})},isMute:function(t){this.isMuteShow=t.isMute,this.allMuted="allMuted"===t.type},chatClick:function(){this.sendBoxShow=!0},closeChatBox:function(){this.sendBoxShow=!1},loginSuccess:function(t){this.storeLoginInfo(t),this.isLogin=!0,this.$router.go(0)},loginHandler:function(){this.$emit("showLogin")}})},vt=(i(298),Object(U.a)(dt,ht,[],!1,null,"8c492ca0",null));vt.options.__file="src/pages/watch/live.vue";var pt=vt.exports,ft=function(){var t=this.$createElement;return(this._self._c||t)("div")};ft._withStripped=!0;var mt={name:"empty"},yt=Object(U.a)(mt,ft,[],!1,null,null,null);yt.options.__file="src/pages/watch/empty.vue";var gt=yt.exports,wt=i(230),It=i(71),St={PREPARE:"pre",LIVING:"live",FINISH:"end",PLAYBACK:"vod"},_t={PREPARE:"预告",LIVING:"直播中",FINISH:"结束",PLAYBACK:"回放"},Ct={mixins:[st.a],data:function(){return{MOBILE_HOST:"//test-zhike.vhall.com/m/",activityId:"",companyName:"",playType:"",playStatus:"",imgUrl:"",currentView:gt,vhallParams:{token:"",appId:"",channelId:"",accountId:""},subscribeShow:!1,businessUserId:"",domShow:!0,autoClose:0,email:"",errorTips:"",successShow:!1,isShowSite:"",wxShare:{wxShareData:{appId:"",timestamp:"",nonceStr:"",signature:""},shareData:{title:"",shareDatadesc:"",shareDatalink:"",shareDataimgUrl:""},shareUser:{shareId:""}},vx5div:!1,vclosex5div:!1,votherdiv:!1,showPersonCount:0}},mounted:function(){this.storeLoginInfo(this.getLoginInfo())},computed:v()({},Object(p.c)("liveMager",{activityInfo:function(t){return t.activityInfo},joinInfo:function(t){return t.joinInfo},roomPaas:function(t){return t.roomPaas}}),Object(p.c)("tokenMager",{chatParams:function(t){return t.chatParams}}),Object(p.c)("login",{loginInfo:function(t){return t.loginInfo}}),{activityStatus:function(){return this.activityInfo.statusName},defaultImg:function(){return this.imgUrl?this.$imgHost+"/"+this.imgUrl:""}}),created:function(){var t=this;W.$on("enterFullScreen",function(){t.vx5div=!0,t.vclosex5div=!1}),W.$on("exitFullScreen",function(){t.vx5div=!1,t.vclosex5div=!0});var e=this.$route.params.id;e||this.$router.go(-1),this.activityId=e,this.initPage();var i=this;window.addEventListener("onorientationchange"in window?"orientationchange":"resize",function(){90===window.orientation||-90===window.orientation?(i.votherdiv=!0,i.domShow=!1):(i.votherdiv=!1,i.domShow=!0)},!1)},watch:{activityInfo:{handler:function(t){t&&t.setting&&(this.showPersonCount=parseInt(t.setting.initOnlineNum?t.setting.initOnlineNum:0)+parseInt(t.onlineNum?t.onlineNum:0))},deep:!0,immediate:!0}},methods:v()({},Object(p.b)("tokenMager",{setChatParams:F.b}),Object(p.b)("liveMager",{storeActivityInfo:F.a,storeRoomPaas:F.h,storeJoinInfo:F.d}),Object(p.b)("login",{storeLoginInfo:F.g}),{subscribe:function(){this.loginInfo?this.loginInfo.email?this.sendSubScribe():this.subscribeShow=!0:this.doLogin()},emailFocus:function(){this.errorTips=""},isX5:function(){var t=navigator.userAgent;return!(!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)||!t.match(/MicroMessenger/i)&&!t.match(/QQ/i))},sendSubScribe:function(){var t=this;this.$config({handlers:!0}).$post(J.a.POST_EMAILSUBSCRIBE,{businessUserId:this.activityInfo.userId,email:this.loginInfo.email?this.loginInfo.email:this.email}).then(function(e){t.autoClose=3,t.subscribeShow=!1,t.successShow=!0;var i=JSON.parse(h()(t.loginInfo));i.email=t.email,t.updateLoginInfo(i),t.storeLoginInfo(i)}).catch(function(e){t.subscribeShow=!1,t.$messageBox({header:"提示",content:e.msg,confirmText:"确定",handleClick:function(t){"cancel"===t.action||t.action}})})},subscribeClick:function(t){if("cancel"===t.action)this.subscribeShow=!1;else if("confirm"===t.action){if(""===this.email)return this.errorTips="请输入邮箱",!1;if(this.email&&!/^[A-Za-z\d]+([-_.][A-Za-z\d]+)*@([A-Za-z\d]+[-.])+[A-Za-z\d]{2,4}$/.test(this.email))return this.errorTips="邮箱格式不正确",!1;this.errorTips="",this.sendSubScribe()}},successClick:function(t){"cancel"===t.action?this.successShow=!1:"confirm"===t.action&&(this.successShow=!1)},initPage:function(){var t=this;return c()(l.a.mark(function e(){var i,n,a,o;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.initRoomPaas();case 2:return t.isWx()&&setTimeout(function(){t.share()},1e3),i=null,n=null,e.next=7,t.$config({handlers:!0}).$get(J.a.GET_LIVEINFO,{activityId:t.$route.params.id}).then(function(e){document.title=e.data.activity.title;var a=document.createElement("iframe");a.style.display="none",a.setAttribute("src","/");a.addEventListener("load",function t(){setTimeout(function(){a.removeEventListener("load",t),document.body.removeChild(a)},0)}),document.body.appendChild(a),t.companyName=e.data.businessUserInfo.company,t.imgUrl=e.data.businessUserInfo.avatar,t.isShowSite=e.data.template,i=v()({},i,e.data.activity),n=e.data.joinInfo,i.setting=e.data.setting,i.warm=e.data.warm,i.statusName=_t[i.status],t.playType=St[i.status],t.playStatus=_t[i.status],t.businessUserId=e.data.activity.userId,"LIVING"===i.status?"APPOINT"!==i.viewCondition||n.isApplay||t.doAuth(t.MOBILE_HOST+"guide/"+t.$route.params.id):"PLAYBACK"===i.status?"APPOINT"!==i.viewCondition||n.isApplay||t.doAuth(t.MOBILE_HOST+"guide/"+t.$route.params.id):"FINISH"===i.status?"APPOINT"!==i.viewCondition||n.isApplay||t.doAuth(t.MOBILE_HOST+"guide/"+t.$route.params.id):i.countDown<1800?"APPOINT"===i.viewCondition&&(n.isApplay||t.doAuth(t.MOBILE_HOST+"guide/"+t.$route.params.id)):t.doAuth(t.MOBILE_HOST+"guide/"+t.$route.params.id)}).catch(function(e){t.$messageBox({header:"提示",content:e.msg,confirmText:"确定",handleClick:function(t){"cancel"===t.action||t.action}})});case 7:return e.next=9,t.$config({handlers:!0}).$get(J.a.GET_ONLINENUM,{activityId:t.$route.params.id}).then(function(t){i.onlineNum=t.data.onlineNum});case 9:return t.storeActivityInfo(i),console.log(i),"vod"===t.playType?t.currentView=ut:t.currentView=pt,e.next=14,t.$config({handlers:!0}).$post(It.a.GET_VISITOR_INFO,{}).then(function(t){_log.set("visitor_id",t.data.visitorId)});case 14:a=t.getLoginInfo(),_log.set("business_uid",i.userId),a&&_log.set("consumer_uid",a.consumerUserId),_log.set("activity_id",i.id),o=0,"LIVING"===i.status?o=1:"PLAYBACK"===i.status&&(o=2),_log.set("service_names",o),localStorage.getItem("refer_"+i.id)?_log.track(Vhall_User_Actions.ENTER,{event:parseInt(localStorage.getItem("refer_"+i.id))}):_log.track(Vhall_User_Actions.ENTER);case 22:case"end":return e.stop()}},e,t)}))()},initSdk:function(){},initRoomPaas:function(){var t=this,e=this.$route.query.shareid,i={activityId:this.activityId,__errHandler:!0};return e&&(i.shareId=e),new o.a(function(e,n){t.roomPaas.token&&e(t.roomPaas),t.$config({handlers:!0}).$get(It.a.GET_USERREGACTIVITY,i).then(function(i){t.storeJoinInfo(i.data),t.$config({handlers:!0}).$get(J.a.GET_SDKTOKEN,{activityId:t.activityId,activityUserId:i.data.activityUserId}).then(function(i){i.data&&(e(i.data),t.storeRoomPaas(i.data))})}).catch(function(e){12004===e.code||11030===e.code?t.doAuth(t.MOBILE_HOST+"guide/"+t.$route.params.id):12031===e.code&&t.$router.replace("/kicked")})})},share:function(){var t=this;return c()(l.a.mark(function e(){var i;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=window.location.href,e.next=3,t.$config({handlers:!0}).$get(J.a.GET_SHARESIGN,{url:encodeURIComponent(i)}).then(function(e){t.wxShare.wxShareData.appId=e.data.appId,t.wxShare.wxShareData.timestamp=e.data.timestamp,t.wxShare.wxShareData.nonceStr=e.data.nonceStr,t.wxShare.wxShareData.signature=e.data.signature});case 3:return e.next=5,t.$config({handlers:!0}).$get(J.a.GET_SHAREINFO,{route:"live_route",param:t.$route.params.id}).then(function(e){if(e.data){var i=window.location.href;t.wxShare.shareData.shareDatalink=i,t.joinInfo.activityUserId&&(i=t.joinInfo.activityUserId?i+"?shareId="+t.joinInfo.activityUserId:i),t.wxShare.shareData.title=e.data.title?e.data.title:"",t.wxShare.shareData.shareDatadesc=e.data.description?e.data.description:"",t.wxShare.shareData.shareDataimgUrl=e.data.imgUrl?"https:"+t.$imgHost+"/"+e.data.imgUrl:""}});case 5:Object(wt.a)(t.wxShare);case 6:case"end":return e.stop()}},e,t)}))()},loginSuccess:function(t){_log.set("consumer_uid",t.consumerUserId),this.storeLoginInfo(t),this.$router.go(0)},isWx:function(){return!(-1===navigator.userAgent.toLowerCase().indexOf("micromessenger"))}})},xt=(i(300),Object(U.a)(Ct,n,[],!1,null,"3753a13b",null));xt.options.__file="src/pages/watch/watch.vue";e.default=xt.exports}}]);
//# sourceMappingURL=8.beb16185.js.map