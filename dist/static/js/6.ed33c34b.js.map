{"version":3,"sources":["webpack:///./src/pages/guide/success.vue?a0c6","webpack:///./src/pages/guide/success.vue?fb45","webpack:///./src/pages/guide/success.vue?4491","webpack:///src/pages/guide/success.vue","webpack:///./src/pages/guide/success.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","activity","countDown","status","staticClass","attrs","src","__webpack_require__","alt","_v","on","click","accountSubmit","viewCondition","_e","_s","startTime","_withStripped","guide_successvue_type_script_lang_js_","mixins","login_mixin","data","MOBILE_HOST","extChannel","user","phone","isApplay","isOrder","vhallParams","token","appId","channelId","accountId","visitorObj","mounted","components","created","getInfo","computed","Object","vuex_esm","chatParams","state","watch","methods","extends_default","setChatParams","mutation_types","doAuth","$route","params","id","initSdk","initMsgServe","_this","asyncToGenerator_default","regenerator_default","a","mark","_callee","roomInfo","wrap","_context","prev","next","$config","handlers","$post","user_service","GET_VISITOR_INFO","wechatAuth","sessionStorage","getItem","then","res","visitorId","abrupt","activity_service","GET_REG_SDK_INFO","thirdUserId","channel","sent","ChatService","OBJ","init","channelRoom","regHandler","chat_config","beginLive","msg","console","log","stop","handleActivityStart","_this2","_callee2","_context2","$get","GET_LIVEINFO","activityId","joinInfo","extChannelRoom","time","interval","setInterval","i","clearInterval","component","componentNormalizer","options","__file","__webpack_exports__"],"mappings":"oIAAua,2CCAva,IAAAA,EAAA,WACA,IAAAC,EAAAC,KACAC,EAAAF,EAAAG,eACAC,EAAAJ,EAAAK,MAAAD,IAAAF,EACA,OAAAF,EAAAM,SAAAC,UAAA,iBAAAP,EAAAM,SAAAE,OACAJ,EAAA,OAAiBK,YAAA,cACjBL,EAAA,OACAK,YAAA,QACAC,OAAkBC,IAAAC,EAAA,KAAAC,IAAA,MAElBb,EAAAc,GAAA,KACA,WAAAd,EAAAM,SAAAE,OACAJ,EAAA,KAAqBK,YAAA,kBACrBL,EAAA,QAAAJ,EAAAc,GAAA,eAEAV,EAAA,KAAqBK,YAAA,kBACrBL,EAAA,QAAAJ,EAAAc,GAAA,eAEAd,EAAAc,GAAA,KACAV,EACA,UACWK,YAAA,iBAAAM,IAAqCC,MAAAhB,EAAAiB,iBAChDjB,EAAAc,GAAA,YAGAV,EAAA,OAAiBK,YAAA,cACjBL,EAAA,OACAK,YAAA,QACAC,OAAkBC,IAAAC,EAAA,KAAAC,IAAA,MAElBb,EAAAc,GAAA,KACA,WAAAd,EAAAM,SAAAE,OACAJ,EAAA,KAAqBK,YAAA,oBACrBL,EAAA,QAAAJ,EAAAc,GAAA,aAEAV,EAAA,KAAqBK,YAAA,oBACrB,YAAAT,EAAAM,SAAAY,cACAd,EAAA,QAAAJ,EAAAc,GAAA,UACA,SAAAd,EAAAM,SAAAY,cACAd,EAAA,QAAAJ,EAAAc,GAAA,UACAd,EAAAmB,OAEAnB,EAAAc,GAAA,KACA,UAAAd,EAAAM,SAAAE,OACAJ,EAAA,KACAJ,EAAAc,GAAA,cACAV,EAAA,QAA0BK,YAAA,UAC1BT,EAAAc,GAAAd,EAAAoB,GAAApB,EAAAM,SAAAe,cAEArB,EAAAc,GAAA,UAEAd,EAAAmB,QAIApB,EAAAuB,eAAA,oHCvD6KC,GCwC7KC,QAAAC,EAAA,GACAC,KAFA,WAGA,OACAC,YAAA,4BACArB,UACAY,cAAA,GACAV,OAAA,GACAa,UAAA,GACAd,UAAA,GACAqB,WAAA,IAEAC,MACAC,MAAA,GACAC,UAAA,EACAC,SAAA,GAEAC,aACAC,MAAA,GACAC,MAAA,GACAC,UAAA,GACAC,UAAA,IAEAC,gBAGAC,QA1BA,aA4BAC,cAEAC,QA9BA,WA+BAxC,KAAAyC,WAEAC,SAAAC,OAAAC,EAAA,EAAAD,CAAA,cACAE,WAAA,SAAAC,GAAA,OAAAA,EAAAD,cAEAE,SAEAC,QAAAC,OACAN,OAAAC,EAAA,EAAAD,CAAA,cACAO,cAAAC,EAAA,KAEAnC,cAJA,WAKAhB,KAAAoD,OAAApD,KAAA0B,YAAA,SAAA1B,KAAAqD,OAAAC,OAAAC,KAEAC,QAPA,WAQAxD,KAAAyD,gBAIAA,aAZA,WAYA,IAAAC,EAAA1D,KAAA,OAAA2D,IAAAC,EAAAC,EAAAC,KAAA,SAAAC,IAAA,IAAAC,EAAA,OAAAJ,EAAAC,EAAAI,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,cAAAF,EAAAE,KAAA,EACAV,EAAAW,SAAAC,UAAA,IAAAC,MAAAC,EAAA,EAAAC,kBACAC,WAAAC,eAAAC,QAAA,gBACAC,KAAA,SAAAC,GACApB,EAAArB,WAAA0C,UAAAD,EAAArD,OAJA,UAMAiC,EAAA/B,WANA,CAAAuC,EAAAE,KAAA,eAAAF,EAAAc,OAAA,UAMA,GANA,cAAAd,EAAAE,KAAA,EAOAV,EAAAW,SAAAC,UAAA,IAAAC,MAAAU,EAAA,EAAAC,kBACAC,YAAA,WAAAzB,EAAArB,WAAA0C,UACAK,QAAA1B,EAAA/B,aACAkD,KAAA,SAAAC,GACA,OAAAA,EAAArD,OAXA,OAOAuC,EAPAE,EAAAmB,KAaAC,EAAA,EAAAC,IAAAC,MACApD,UAAA4B,EAAA5B,UACAH,MAAA+B,EAAA/B,MACAC,MAAA8B,EAAA9B,MACAC,UAAA6B,EAAAyB,cAGAH,EAAA,EAAAC,IAAAG,WAAAC,EAAA,EAAAC,UAAA,SAAAC,GACAC,QAAAC,IAAAF,GACAnC,EAAAN,OAAAM,EAAAhC,YAAA,SAAAgC,EAAAL,OAAAC,OAAAC,MAtBA,wBAAAW,EAAA8B,SAAAjC,EAAAL,KAAAC,IAyBAsC,oBArCA,SAqCAJ,GACA7F,KAAAK,SAAAC,UAAA,MAEAmC,QAxCA,WAwCA,IAAAyD,EAAAlG,KAAA,OAAA2D,IAAAC,EAAAC,EAAAC,KAAA,SAAAqC,IAAA,OAAAvC,EAAAC,EAAAI,KAAA,SAAAmC,GAAA,cAAAA,EAAAjC,KAAAiC,EAAAhC,MAAA,cAAAgC,EAAAhC,KAAA,EACA8B,EAAA7B,SAAAC,UAAA,IAAA+B,KAAApB,EAAA,EAAAqB,cACAC,WAAAL,EAAA7C,OAAAC,OAAAC,KACAsB,KAAA,SAAAC,GAkBA,GAjBAoB,EAAA1C,UACA0C,EAAA7F,SAAAY,cAAA6D,EAAArD,KAAApB,SAAAY,cACAiF,EAAA7F,SAAAE,OAAAuE,EAAArD,KAAApB,SAAAE,OACA2F,EAAA7F,SAAAe,UAAA0D,EAAArD,KAAApB,SAAAe,UACA8E,EAAA7F,SAAAC,UAAAwE,EAAArD,KAAApB,SAAAC,UACA4F,EAAAtE,KAAAE,SAAAgD,EAAArD,KAAA+E,SAAA1E,SACAoE,EAAAtE,KAAAG,QAAA+C,EAAArD,KAAA+E,SAAAzE,QACAmE,EAAAvE,WAAAmD,EAAArD,KAAApB,SAAAoG,gBACA,WAAAP,EAAA7F,SAAAE,QAAA2F,EAAA7F,SAAAC,WAAA,mBAAA4F,EAAA7F,SAAAE,UACA,YAAA2F,EAAA7F,SAAAY,cACA6D,EAAArD,KAAA+E,SAAA1E,UACAoE,EAAA9C,OAAA8C,EAAAxE,YAAA,SAAAwE,EAAA7C,OAAAC,OAAAC,IAEAuB,EAAArD,KAAA+E,SAAAzE,SAAA,SAAAmE,EAAA7F,SAAAY,eACAiF,EAAA9C,OAAA8C,EAAAxE,YAAA,SAAAwE,EAAA7C,OAAAC,OAAAC,KAGA2C,EAAA7F,SAAAC,UAAA,KACA,IAAAoG,EAAAR,EAAA7F,SAAAC,UACAqG,EAAAC,YAAA,SAAAC,KACAH,EACA,OACAR,EAAA7F,SAAAC,UAAA,KACAwG,cAAAH,KAEA,OA7BA,wBAAAP,EAAAJ,SAAAG,EAAAD,KAAAvC,uBC7GAoD,EAAApE,OAAAqE,EAAA,EAAArE,CACArB,EACAxB,MAEA,EACA,KACA,WACA,MAuBAiH,EAAAE,QAAAC,OAAA,8BACAC,EAAA,QAAAJ","file":"static/js/6.ed33c34b.js","sourcesContent":["import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js!../../../node_modules/css-loader/index.js!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/lib/index.js!../../../node_modules/sass-loader/lib/loader.js!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./success.vue?vue&type=style&index=0&id=3ffef81c&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js!../../../node_modules/css-loader/index.js!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/lib/index.js!../../../node_modules/sass-loader/lib/loader.js!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./success.vue?vue&type=style&index=0&id=3ffef81c&lang=scss&scoped=true&\"","var render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  return _vm.activity.countDown < 1800 || _vm.activity.status === \"LIVING\"\n    ? _c(\"div\", { staticClass: \"v-success\" }, [\n        _c(\"img\", {\n          staticClass: \"v-img\",\n          attrs: { src: require(\"../../assets/image/success@2x.png\"), alt: \"\" }\n        }),\n        _vm._v(\" \"),\n        _vm.activity.status === \"LIVING\"\n          ? _c(\"p\", { staticClass: \"v-start-title\" }, [\n              _c(\"span\", [_vm._v(\"直播正在进行中\")])\n            ])\n          : _c(\"p\", { staticClass: \"v-start-title\" }, [\n              _c(\"span\", [_vm._v(\"直播将要开始啦\")])\n            ]),\n        _vm._v(\" \"),\n        _c(\n          \"button\",\n          { staticClass: \"primary-button\", on: { click: _vm.accountSubmit } },\n          [_vm._v(\"进入直播\")]\n        )\n      ])\n    : _c(\"div\", { staticClass: \"v-success\" }, [\n        _c(\"img\", {\n          staticClass: \"v-img\",\n          attrs: { src: require(\"../../assets/image/success@2x.png\"), alt: \"\" }\n        }),\n        _vm._v(\" \"),\n        _vm.activity.status === \"FINISH\"\n          ? _c(\"p\", { staticClass: \"v-success-title\" }, [\n              _c(\"span\", [_vm._v(\"直播已结束\")])\n            ])\n          : _c(\"p\", { staticClass: \"v-success-title\" }, [\n              _vm.activity.viewCondition === \"APPOINT\"\n                ? _c(\"span\", [_vm._v(\"报名成功\")])\n                : _vm.activity.viewCondition === \"NONE\"\n                  ? _c(\"span\", [_vm._v(\"预约成功\")])\n                  : _vm._e()\n            ]),\n        _vm._v(\" \"),\n        _vm.activity.status != \"FINISH\"\n          ? _c(\"p\", [\n              _vm._v(\"活动将于\\n    \"),\n              _c(\"span\", { staticClass: \"v-red\" }, [\n                _vm._v(_vm._s(_vm.activity.startTime))\n              ]),\n              _vm._v(\"准时开播\")\n            ])\n          : _vm._e()\n      ])\n}\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns }","import mod from \"-!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./success.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./success.vue?vue&type=script&lang=js&\"","<template>\r\n  <div class=\"v-success\"\r\n       v-if=\"activity.countDown < 1800 || activity.status === 'LIVING'\">\r\n    <img src=\"../../assets/image/success@2x.png\"\r\n         alt=\"\"\r\n         class=\"v-img\">\r\n    <p class=\"v-start-title\" v-if=\"activity.status === 'LIVING'\">\r\n      <span>直播正在进行中</span>\r\n    </p>\r\n    <p class=\"v-start-title\" v-else>\r\n      <span>直播将要开始啦</span>\r\n    </p>\r\n    <button class=\"primary-button\"\r\n            @click=\"accountSubmit\">进入直播</button>\r\n  </div>\r\n  <div class=\"v-success\"\r\n       v-else>\r\n    <img src=\"../../assets/image/success@2x.png\"\r\n         alt=\"\"\r\n         class=\"v-img\">\r\n    <p class=\"v-success-title\" v-if=\"activity.status === 'FINISH'\">\r\n      <span>直播已结束</span>\r\n    </p>\r\n    <p class=\"v-success-title\" v-else>\r\n      <span v-if=\"activity.viewCondition === 'APPOINT'\">报名成功</span>\r\n      <span v-else-if=\"activity.viewCondition === 'NONE'\">预约成功</span>\r\n    </p>\r\n    <p v-if=\"activity.status != 'FINISH'\">活动将于\r\n      <span class=\"v-red\">{{activity.startTime}}</span>准时开播</p>\r\n  </div>\r\n</template>\r\n<script>\r\nimport loginMixin from 'components/login-mixin'\r\nimport { mapMutations, mapState } from 'vuex'\r\nimport * as types from 'src/store/mutation-types'\r\nimport ChatConfig from 'src/api/chat-config'\r\nimport activityService from 'src/api/activity-service'\r\nimport userService from 'src/api/user-service'\r\nimport ChatService from 'src/components/chat/ChatService.js'\r\nexport default {\r\n  mixins: [loginMixin],\r\n  data () {\r\n    return {\r\n      MOBILE_HOST: process.env.MOBILE_HOST,\r\n      activity: {\r\n        viewCondition: '', // APPOINT是报名活动 NONE是无限制活动\r\n        status: '', // 当前活动状态 LIVING 直播中\r\n        startTime: '', // 当前活动开始时间\r\n        countDown: '',\r\n        extChannel: '' // sdk消息频道\r\n      },\r\n      user: {\r\n        phone: '', // 无条件观看用户手机\r\n        isApplay: false, // 是否已经报名\r\n        isOrder: false // 是否已经预约\r\n      },\r\n      vhallParams: {\r\n        token: '',\r\n        appId: '',\r\n        channelId: '',\r\n        accountId: ''\r\n      },\r\n      visitorObj: {} // 游客信息\r\n    }\r\n  },\r\n  mounted () {\r\n  },\r\n  components: {\r\n  },\r\n  created () {\r\n    this.getInfo()\r\n  },\r\n  computed: mapState('tokenMager', {\r\n    chatParams: state => state.chatParams\r\n  }),\r\n  watch: {\r\n  },\r\n  methods: {\r\n    ...mapMutations('tokenMager', {\r\n      setChatParams: types.CHAT_PARAMS\r\n    }),\r\n    accountSubmit () {\r\n      this.doAuth(this.MOBILE_HOST + 'watch/' + this.$route.params.id)\r\n    },\r\n    initSdk () {\r\n      this.initMsgServe()\r\n      // window.Vhall.ready(() => {\r\n      // })\r\n    },\r\n    async initMsgServe () {\r\n      await this.$config({ handlers: true }).$post(userService.GET_VISITOR_INFO, {\r\n        wechatAuth: sessionStorage.getItem('wechatAuth')\r\n      }).then((res) => {\r\n        this.visitorObj.visitorId = res.data\r\n      })\r\n      if (!this.extChannel) return false\r\n      const roomInfo = await this.$config({ handlers: true }).$post(activityService.GET_REG_SDK_INFO, {\r\n        thirdUserId: `visitor_${this.visitorObj.visitorId}`,\r\n        channel: this.extChannel\r\n      }).then((res) => {\r\n        return res.data\r\n      })\r\n      ChatService.OBJ.init({\r\n        accountId: roomInfo.accountId,\r\n        token: roomInfo.token,\r\n        appId: roomInfo.appId,\r\n        channelId: roomInfo.channelRoom\r\n      })\r\n      /* 监听微信测试发送成功消息 */\r\n      ChatService.OBJ.regHandler(ChatConfig.beginLive, (msg) => {\r\n        console.log(msg)\r\n        this.doAuth(this.MOBILE_HOST + 'watch/' + this.$route.params.id)\r\n      })\r\n    },\r\n    handleActivityStart (msg) {\r\n      this.activity.countDown = 1799\r\n    },\r\n    async getInfo () {\r\n      await this.$config({ handlers: true }).$get(activityService.GET_LIVEINFO, {\r\n        activityId: this.$route.params.id\r\n      }).then((res) => {\r\n        this.initSdk()\r\n        this.activity.viewCondition = res.data.activity.viewCondition\r\n        this.activity.status = res.data.activity.status\r\n        this.activity.startTime = res.data.activity.startTime\r\n        this.activity.countDown = res.data.activity.countDown\r\n        this.user.isApplay = res.data.joinInfo.isApplay\r\n        this.user.isOrder = res.data.joinInfo.isOrder\r\n        this.extChannel = res.data.activity.extChannelRoom\r\n        if ((this.activity.status === 'LIVING' || this.activity.countDown <= 1799 || this.activity.status === 'PLAYBACK')) {\r\n          if (this.activity.viewCondition === 'APPOINT') {\r\n            if (res.data.joinInfo.isApplay) {\r\n              this.doAuth(this.MOBILE_HOST + 'watch/' + this.$route.params.id)\r\n            }\r\n          } else if (res.data.joinInfo.isOrder && this.activity.viewCondition === 'NONE') {\r\n            this.doAuth(this.MOBILE_HOST + 'watch/' + this.$route.params.id)\r\n          }\r\n        }\r\n        if (this.activity.countDown > 1800) {\r\n          let time = this.activity.countDown\r\n          let interval = setInterval(i => {\r\n            time--\r\n            if (time < 30 * 60) {\r\n              this.activity.countDown = 1799\r\n              clearInterval(interval)\r\n            }\r\n          }, 1000)\r\n        }\r\n      })\r\n      // this.getToken()\r\n    }\r\n    // ,\r\n    // getToken () {\r\n    //   if ((this.activity.viewCondition === 'APPOINT' && this.user.isApplay) || this.activity.viewCondition !== 'APPOINT') {\r\n    //     // 报名活动在已报名状态下和预约活动所有状态下可收到消息\r\n    //     if (!this.chatParams.token) {\r\n    //       // 当前vuex中没有聊天token 需要获取\r\n    //       this.$config({ handlers: true }).$get(userService.GET_USERREGACTIVITY, { // 获取参会信息\r\n    //         activityId: this.$route.params.id\r\n    //       }).then((res) => {\r\n    //         this.$config({ handlers: true }).$get(activityService.GET_SDKTOKEN, { // 获取观看端token\r\n    //           activityId: this.$route.params.id,\r\n    //           activityUserId: res.data.activityUserId\r\n    //         }).then((res) => {\r\n    //           this.vhallParams.token = res.data.token\r\n    //           this.vhallParams.appId = res.data.appId\r\n    //           this.vhallParams.channelId = res.data.channelRoom\r\n    //           this.vhallParams.accountId = res.data.accountId // 从参会接口取activiUserID\r\n    //           this.setChatParams(this.vhallParams)\r\n    //           this.$nextTick(() => {\r\n    //             this.initSdk()\r\n    //           })\r\n    //         })\r\n    //       })\r\n    //     } else {\r\n    //       this.vhallParams = this.chatParams\r\n    //       this.$nextTick(() => {\r\n    //         this.initSdk()\r\n    //       })\r\n    //     }\r\n    //   }\r\n    // }\r\n  }\r\n}\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n@import '~assets/css/mixin.scss';\r\n.v-success {\r\n  .v-img {\r\n    display: block;\r\n    width: 224px;\r\n    margin: 0 auto;\r\n  }\r\n  p {\r\n    text-align: center;\r\n    margin-top: 22px;\r\n    font-size: 28px;\r\n    color: #222;\r\n    &.v-success-title,\r\n    &.v-start-title {\r\n      font-size: 40px;\r\n    }\r\n    .v-red {\r\n      color: #fc5659;\r\n    }\r\n  }\r\n  .primary-button {\r\n    width: 490px;\r\n    height: 90px;\r\n    border-radius: 50px;\r\n    display: block;\r\n    margin: 25px auto 5px;\r\n  }\r\n}\r\n</style>\r\n","import { render, staticRenderFns } from \"./success.vue?vue&type=template&id=3ffef81c&scoped=true&\"\nimport script from \"./success.vue?vue&type=script&lang=js&\"\nexport * from \"./success.vue?vue&type=script&lang=js&\"\nimport style0 from \"./success.vue?vue&type=style&index=0&id=3ffef81c&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"3ffef81c\",\n  null\n  \n)\n\n/* hot reload */\nif (module.hot) {\n  var api = require(\"E:\\\\work\\\\saas营销\\\\fe_interaction_h5\\\\node_modules\\\\vue-hot-reload-api\\\\dist\\\\index.js\")\n  api.install(require('vue'))\n  if (api.compatible) {\n    module.hot.accept()\n    if (!module.hot.data) {\n      api.createRecord('3ffef81c', component.options)\n    } else {\n      api.reload('3ffef81c', component.options)\n    }\n    module.hot.accept(\"./success.vue?vue&type=template&id=3ffef81c&scoped=true&\", function () {\n      api.rerender('3ffef81c', {\n        render: render,\n        staticRenderFns: staticRenderFns\n      })\n    })\n  }\n}\ncomponent.options.__file = \"src/pages/guide/success.vue\"\nexport default component.exports"],"sourceRoot":""}