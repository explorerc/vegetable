(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{183:function(t,e,i){"use strict";e.a={POST_SUBSCRIBE:"/frontend/user/order-activity",GET_LIVEINFO:"/frontend/live/info",GET_SHAREINFO:"/frontend/share/info",GET_QUESTIONINFO:"/frontend/question/info",POST_QUESTIONINFO:"/frontend/user/apply-activity",GET_CREATEACCESSTOKEN:"/common/paas/create-access-token",GET_ONLINENUM:"/frontend/channel/get-online-num",GET_SHARESIGN:"/common/wechat/get-share-sign",GET_SDKTOKEN:"/frontend/live/sdk-token",GET_SEND:"/index/send",GET_SENDANNOUNCEMENT:"/initiator/channel/send-announcement",POST_GAG:"/initiator/user/gag",POST_GAGALL:"/initiator/user/gag-all",POST_KICK:"/initiator/user/kick",POST_EMAILSUBSCRIBE:"/frontend/user/email-subscribe",GET_MESSAGELIST:"/common/paas/message-list",GET_CAPTCHAID:"/common/message/get-captchaid",GET_CODE:"/common/message/send-code",GET_TEMPLATE:"/frontend/live/template",GET_DEFAULEREPLAY:"/frontend/replay/default-replay",GET_WARMINFO:"/manage/warm-up-manage/get"}},184:function(t,e,i){},185:function(t,e,i){"use strict";var a=i(7),s=i.n(a),o=i(11),n=i.n(o),l=i(0),r=i.n(l),c=i(46),h=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"login-container"},[i("com-dialog",{attrs:{visible:t.visible,center:""},on:{"update:visible":function(e){t.visible=e},close:t.closed}},[i("div",[i("div",{staticClass:"rule"},[t._v("登录参与直播互动")]),t._v(" "),i("com-input",{staticClass:"mobile",attrs:{type:"input",placeholder:"请输入手机"},model:{value:t.mobile,callback:function(e){t.mobile=e},expression:"mobile"}}),t._v(" "),i("div",{attrs:{id:"captcha"}}),t._v(" "),i("com-input",{staticClass:"code",attrs:{type:"input",placeholder:"请输入验证码"},model:{value:t.code,callback:function(e){t.code=e},expression:"code"}}),t._v(" "),i("com-button",{staticClass:"codeBtn",attrs:{disabled:!t.codeEnable,type:"primary"},on:{click:t.getCode}},[t._v(t._s(t.codeText))])],1),t._v(" "),i("div",{staticClass:"footer",attrs:{slot:"footer"},slot:"footer"},[i("com-button",{attrs:{type:"primary",disabled:!t.submitEnable},on:{click:t.doLogin}},[t._v("登录")])],1)])],1)};h._withStripped=!0;var d=i(183),u=i(58),p={name:"ComLogin",data:()=>({visible:!1,time:60,captchaIns:null,key:null,verify:!1,mobile:"",code:"",mobileReg:/^1[3|4|5|6|7|8|9][0-9]\d{8}$/,captchaKey:""}),mounted(){this.$get(d.a.GET_CAPTCHAID).then(t=>{this.key=t.data,window.initNECaptcha({element:"#captcha",mode:"float",width:"100%",captchaId:this.key,onVerify:(t,e)=>{t?console.log(t):(this.verify=!0,this.captchaKey=e.validate)}},t=>{this.captchaIns=t},t=>{console.log(t)})})},methods:{getCode(){this.$config({handlers:!0}).$get(d.a.GET_CODE,{mobile:this.mobile,type:"CONSUMER_USER_LOGIN",captcha:this.captchaKey,__errHandler:!0}).then(t=>{this.time--,this.timer=setInterval(()=>{this.time--,0===this.time&&(clearInterval(this.timer),this.time=60)},1e3),console.log(t)})},doLogin(){this.$config({handlers:!0}).$post(u.a.POST_MOBILELOGIN,{mobile:this.mobile,code:this.code,wechatAuth:sessionStorage.getItem("wechatAuth"),__errHandler:!0}).then(t=>{this.$parent.updateLoginInfo(t.data),this.visible=!1,this.closed(),this.$emit("login",t.data)}).catch(()=>{this.verify=!1,this.captchaKey="",this.captchaIns.refresh()})},closed(){this.mobile="",this.time=60,this.verify=!1,this.captchaKey="",this.captchaIns.refresh(),clearInterval(this.timer)}},computed:{codeText(){return this.codeEnable||60===this.time?"发送验证码":`倒计时${this.time}秒`},codeEnable(){return this.mobileReg.test(this.mobile)&&this.verify&&60===this.time},submitEnable(){return this.mobileReg.test(this.mobile)&&this.verify&&this.code}}},m=(i(186),i(1)),v=Object(m.a)(p,h,[],!1,null,"9f4e7bf2",null);v.options.__file="src/components/login-box.vue";var y=v.exports;r.a.use(c.a);const g=new r.a;e.a={components:{ComLogin:y},data:()=>({login:null}),mounted(){this.login=this.$children.find(t=>"ComLogin"===t.$options.name),this.$route.meta.pop&&(this.$route.meta.pop=!1,this.login.visible=!0)},methods:{getAuthInfo:()=>sessionStorage.getItem("wechatAuth"),getLoginInfo:()=>JSON.parse(sessionStorage.getItem("login")),doAuth(t){let e=location.href;t&&(e=t),sessionStorage.getItem("wechatAuth")?location.href=e:(console.log(e),location.href=`/api/frontend/user/wechat-login?backUrl=${encodeURIComponent(e)}`)},doLogin(t){if(sessionStorage.getItem("wechatAuth"))this.login.visible=!0;else{let e=location.href;"string"==typeof t&&(e=t),-1===e.indexOf("?")?e+="?_pop=true":e+="&_pop=true",location.href=`/api/frontend/user/wechat-login?backUrl=${encodeURIComponent(e)}`}},updateLoginInfo(t){t?sessionStorage.setItem("login",n()(t)):(sessionStorage.removeItem("login"),sessionStorage.removeItem("wechatAuth"))},getMasterInfo:t=>new s.a((t,e)=>{sessionStorage.getItem("master")?t(JSON.parse(sessionStorage.getItem("master"))):g.$config({loading:!0,handlers:!0}).$get(u.a.GET_JOININFO).then(e=>{sessionStorage.setItem("master",n()(e.data)),t(e.data)}).catch(t=>{e(t)})})}}},186:function(t,e,i){"use strict";var a=i(184);i.n(a).a},188:function(t,e,i){"use strict";e.a={onLineNum:"INCREMENT_ONLINE",announcement:"ANNOUNCEMENT",kick:"KICK",gag:"GAG",gagAll:"GAG_ALL",beginLive:"BEGIN_LIVE",endLive:"FINISH_LIVE"}},194:function(t,e,i){"use strict";i.d(e,"a",function(){return c});var a=i(11),s=i.n(a),o=i(181),n=i.n(o);const l=n()("msgHandler"),r=n()("dispatchHandler");class c{constructor(){if(this._instance)throw new Error("ChatService is singlton");this._instance=this,this._activityId="",this.handlerMap={}}static get OBJ(){return this._instance||(this._instance=new c),this._instance}init(t){this.service||window.vhallChat||(window.Vhall.ready(()=>{this.service=VhallChat({channelId:t.channelId}),window.vhallChat=this.service,this[l](),console.log("初始化成功")}),window.Vhall.config({appId:t.appId,accountId:t.accountId,token:t.token}),console.log(s()(t)))}set activityId(t){this._activityId=t}get activityId(){return this._activityId}sendChat(t){this.service.emit(t)}sendCustomMsg(t,e){this.service.emitCustomMsg({type:t,body:e})}[l](){console.log("[chat]listening..."),window.vhallChat.onCustomMsg(t=>{let{type:e,body:i}=JSON.parse(t);this[r](e,i)}),window.vhallChat.on(t=>{this[r]("chat",t)})}regHandler(t,e){this.handlerMap[t]||(this.handlerMap[t]=[]);let i=this.handlerMap[t];i.includes(e)?console.log("重复注册消息"):i.push(e)}unregHandler(t,e){if(!this.handlerMap[t])return;let i=this.handlerMap[t],a=i.indexOf(e);-1!==a&&i.splice(a,1)}[r](t,e){let i=this.handlerMap[t];i&&0!==i.length&&i.forEach(t=>{t(e)})}}},196:function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"play-container"},["live"==t.playType?i("div",{staticClass:"play-video-box",attrs:{id:t.playBoxId}}):"vod"==t.playType?i("div",{staticClass:"play-video-box",attrs:{id:t.playBoxId}},[i("div",{staticStyle:{width:"100%",height:"100%"},domProps:{innerHTML:t._s(this.outLineLink)}})]):i("div",{staticClass:"play-video-box",attrs:{id:t.playBoxId}},[t.imageSrc?i("img",{attrs:{src:t.imageSrc}}):t._e()]),t._v(" "),t.playBtnShow?i("i",{staticClass:"iconfont icon-bofang",on:{click:t.playVideo}}):t._e(),t._v(" "),i("div",{staticClass:"control-box"},["vod"==t.playType&&!t.outLineLink||"warm"==t.playType?i("div",{staticClass:"control-video-box"},[i("video-control",{attrs:{currentTime:t.currentTime,totalTime:t.totalTime,qualitys:t.qualitys},on:{control:t.playControl}})],1):t._e()])])};a._withStripped=!0;var s=i(8),o=i.n(s);class n{constructor(t,e,i){this.appId=t,this.rootEleId=e,this.token=i,this.type="",this._accountId=null,this.player=null}set accoundId(t){this._accountId=t}get accoundId(){return this._accountId}play(t=null){this.player.play(),t&&t()}pause(t=null){this.player.pause(),t&&t()}resume(t=null){this.player.play(),t&&t()}getQuality(){return this.player.getQuality()}setQuality(t,e=null){this.player.setQuality(t),e&&e()}setFullScreen(t,e=null){this.player.setFullScreen(t),e&&e()}isFullscreen(){return this.player.isFullscreen()}set volume(t){this.player.setVolume(t)}set width(t){this.player.setWidth(t)}set height(t){this.player.setHeight(t)}get netWorkState(){return this.player.getNetworkState()}destroy(){this.player&&this.player.destroy()}}var l=i(45),r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"control-box"},[i("div",{staticClass:"auto-box",staticStyle:{display:"flex"}},[i("div",{staticClass:"mode-item fl",on:{click:t.playEvent}},[t.isPlay?i("i",{staticClass:"iconfont icon-bofang1"}):i("i",{staticClass:"iconfont icon-zanting"})]),t._v(" "),i("div",{staticClass:"mode-item time-box"},[i("span",[t._v(t._s(t.currentDate))]),i("span",[t._v("/"+t._s(t.allDate))])]),t._v(" "),i("div",{staticClass:"mode-item",staticStyle:{flex:"1"}},[i("div",{staticClass:"progress-box"},[i("el-slider",{attrs:{"format-tooltip":t.formatTooltip},on:{change:t.changeVal},model:{value:t.progress,callback:function(e){t.progress=e},expression:"progress"}})],1)]),t._v(" "),i("div",{staticClass:"mode-item fr",on:{mouseover:function(e){return e.stopPropagation(),t.overEvent(e)},mouseout:function(e){return e.stopPropagation(),t.outEvent(e)}}},[i("span",{staticClass:"quality-info"},[t._v("画质")]),t._v(" "),i("transition",{attrs:{name:"fade"}},[t.showQualityBlock?i("div",{staticClass:"qualitys-box"},t._l(t.qualitys,function(e,a){return i("span",{class:{"quality-item":!0,active:t.selectQuality==a},on:{click:function(e){t.selectQuality=a}}},[t._v(t._s(e))])})):t._e()])],1),t._v(" "),i("div",{staticClass:"mode-item fr"},[i("i",{staticClass:"iconfont icon-zuidahua_icon",on:{click:t.fullScreeEvent}})])])])};r._withStripped=!0;const c="mute",h="play",d="volumeSize",u="fullBrowser",p="progress",m={mute:"声音控制",play:"播放控制",volumeSize:"声音大小",fullScree:"全屏控制",selectQuality:"画质量",fullBrowser:"浏览器-全屏",progress:"播放进度"};var v={name:"control",data:()=>({mute:!1,isPlay:!0,volumeSize:100,fullScree:!1,isFullBrowser:!1,showQualityBlock:!1,selectQuality:0,current:0,progress:0}),computed:{allDate(){return this.formatDate(this.totalTime)},currentDate(){return this.formatDate(this.currentTime)},rate(){return parseInt(100*this.currentTime/this.totalTime)}},props:{currentTime:{type:Number,default:0},totalTime:{type:Number,default:1e3},qualitys:{type:Array,default:["same"]}},watch:{currentTime:{handler(t){this.current=t},immediate:!0},rate:{handler(t){this.progress=t},immediate:!0},volumeSize(t){this.changeControl(d,t)}},methods:{changeControl(t,e){this.$emit("control",{type:t,value:e,msg:m[t]})},formatTooltip:t=>t+"%",changeVal(){this.changeControl(p,this.progress)},muteEvent(){this.mute=!this.mute,this.changeControl(c,this.mute)},overEvent(){this.showQualityBlock=!0},outEvent(){this.showQualityBlock=!1},playEvent(){this.isPlay=!this.isPlay,this.changeControl(h,this.isPlay)},fullScreeEvent(){alert("请把手机横评放置")},fullBrowser(){this.isFullBrowser=!this.isFullBrowser,this.changeControl(u,this.isFullBrowser)},formatDate(t){let e=(t/3600>>0)+"",i=((t/60%60>>0)+"").padStart(2,0),a=((t%60>>0)+"").padStart(2,0);return e>0?`${e}:${i}:${a}`:`${i}:${a}`}}},y=(i(251),i(1)),g=Object(y.a)(v,r,[],!1,null,"a65f7196",null);g.options.__file="src/pages/watch/video/control.vue";var f=g.exports,w=i(2),I=i(183),_={name:"index",components:{VideoControl:f},data:()=>({playComps:{},playBtnShow:!1,imageUrl:"",recordId:"",outLineLink:"",playBoxId:`play-vides-${Math.random()}`,sdkPlayParam:{appId:"",accountId:"",token:""},currentTime:0,totalTime:1e4,stInterval:"",isPlay:!1,controlPsoition:"1.333vw",qualitys:[]}),props:{role:{type:String,default:"watcher"},playType:{type:String,required:!0,default:""},startInit:{type:Boolean,required:!0,default:!1},paasParams:{appId:"",roomId:"",inavId:"",token:"",accountId:""}},computed:o()({},Object(l.c)("liveMager",{liveDevices:t=>t.liveDevices,roomPaas:t=>t.roomPaas,activityInfo:t=>t.activityInfo}),{imageSrc(){return`${this.$imgHost}/${this.imageUrl}`}}),mounted(){let t=this;window.addEventListener("onorientationchange"in window?"orientationchange":"resize",function(){90===window.orientation||-90===window.orientation?(t.$emit("orientationchange","horizontalScreen"),t.horizontalScreen()):(t.herticalScreen(),t.$emit("orientationchange","herticalScreen"))},!1)},watch:{startInit(t){t?this.initComponent():this.stopPlay()},liveDevices(){this.changeLiveDevice()}},beforeDestroy(){console.log("--video-com--beforeDestroy"),clearInterval(this.setIntervalHandler),window.hostPusher&&window.hostPusher.destroy(),window.playComps&&window.playComps.destroy(),window.VhallPlayer&&window.VhallPlayer.destroy()},methods:o()({},Object(l.b)("liveMager",{storeRoomPaas:w.h}),{initComponent(){"live"===this.playType?this.initLivePlay():"warm"===this.playType?this.queryWarmInfo():"vod"===this.playType?this.initPlayBack():"end"===this.playType&&this.playEnd()},playEnd(){},playVideo(){"warm"===this.playType&&this.playBackVideo()},changeLiveDevice(){window.hostPusher&&window.hostPusher.changeSetting({video:{deviceId:this.liveDevices.camera},audio:{deviceId:this.liveDevices.mic},conf:{videoSize:[800,450,800,450]}})},initLivePlay(){"watcher"===this.role&&this.initPuller()},initPlayBack(){this.$config({handlers:!0}).$get(I.a.GET_DEFAULEREPLAY,{activityId:this.$route.params.id}).then(t=>{t.data&&(this.imageUrl=t.data.cover,"LINK"===t.data.replay.type?this.outLineLink=t.data.replay.link:"VIDEO"!==t.data.replay.type&&"SLICE"!==t.data.replay.type||(this.recordId=t.data.replay.video,this.totalTime=t.data.replay.duration,this.playBackVideo()))}).catch(()=>{})},playBackVideo(){this.$nextTick(()=>{this.recordId&&(window.Vhall.ready(()=>{window.VhallPlayer.init({recordId:this.recordId,type:"vod",videoNode:this.playBoxId,complete:()=>{this.playBtnShow=!1,this.qualitys=window.VhallPlayer.getQualitys(),window.VhallPlayer.play(),this.dealWithVideo()}})}),window.Vhall.config({appId:this.roomPaas.appId,accountId:this.roomPaas.accountId,token:this.roomPaas.token}))})},dealWithVideo(){clearInterval(this.setIntervalHandler),this.setIntervalHandler=setInterval(()=>{this.currentTime=window.VhallPlayer.getCurrentTime(),this.totalTime===this.currentTime&&clearInterval(this.setIntervalHandler)},1e3)},queryWarmInfo(){this.$config({handlers:!0}).$get(I.a.GET_WARMINFO,{activityId:this.$route.params.id}).then(t=>{t.data&&(this.imageUrl=t.data.imgUrl,this.recordId=t.data.recordId,this.playBtnShow=!0,this.totalTime=parseInt(t.data.record.duration),this.playBackVideo())}).catch(()=>{})},initPuller(){window.playComps&&window.playComps.destroy(),this.$nextTick(()=>{this.playComps=new class extends n{constructor(t,e,i,a){super(t,i,a),this.type="live",this.roomId=e}initLivePlayer(t=!1,e=null){console.log("1调用初始化拉流器"),window.Vhall.ready(()=>{console.log("2SDK初始化完成"),window.VhallPlayer.init({roomId:this.roomId,type:"live",videoNode:this.rootEleId,complete:()=>{console.log("3播放器初始化完成"),e&&e(),t&&window.VhallPlayer.play()}}),this.player=window.VhallPlayer})}set accountId(t){super.accoundId=t,console.log("aaa",this.appId,this.roomId,this.rootEleId,this.token),window.Vhall.config({appId:this.appId,accountId:t,token:this.token})}}(this.roomPaas.appId,this.roomPaas.liveRoom,this.playBoxId,this.roomPaas.token),this.playComps.initLivePlayer(!0,()=>{console.log("----------开始播放----------")}),this.playComps.accountId=this.roomPaas.accountId})},pullBroadCast(){this.hostPusher.stopBroadCast().then(()=>{this.hostPusher.startBroadCast().then(()=>{console.log("----------旁路推流成功----------")}).catch(t=>{console.error(`旁路推流失败:${t}`);let e=setTimeout(()=>{clearTimeout(e),this.pullBroadCast()},500)})}).catch(t=>{console.error(`停止旁路推流失败:${t}`)})},stopPlay(){"live"===this.playType&&window.hostPusher.stop()},showVideo(t){this.isShowVideo=t,"live"===this.playType?"master"===this.role?window.hostPusher.showVideo(t):"watcher"===this.role&&window.playComps.showVideo(t):"warm"===this.playType||this.playType},mutoAuto(t){this.isMutoAuto=t,"live"===this.playType?"master"===this.role?window.hostPusher.mute(t):"watcher"===this.role&&(window.playComps.volume=t?0:50):"warm"===this.playType||this.playType},formatTooltip:t=>t/1e4,formatTime(t){let e={hour:"",min:"",sed:""};return e.hour=((t/3600%24>>0)+"").padStart(2,0),e.min=((t/60%60>>0)+"").padStart(2,0),e.sed=((t%60>>0)+"").padStart(2,0),`${e.hour}:${e.min}:${e.sed}`},fullScreen(){alert("请把手机横评放置")},horizontalScreen(){this.isShowCover=!1,this.height="100%",this.controlPsoition="9.333vw"},herticalScreen(){this.isShowCover=!0,this.height="56.267vw",this.controlPsoition="1.333vw"},start(){this.isStart=!0,this.puller.play()},play(t){"warm"!==this.playType&&"vod"!==this.playType||(t?window.VhallPlayer.play():window.VhallPlayer.pause())},playControl(t){const e=t.type;"progress"===e?this.seekProgress(t.value):"play"===e?this.play(t.value):"mute"===e?this.mutoAuto(t.value):"volumeSize"===e?this.changeVolume(t.value):"selectQuality"===e?window.VhallPlayer.setQuality(t.value):"fullScree"===e?this.fullScree(t.value):"fullBrowser"===e&&this.$emit("fullBrowser",t.value)},seekProgress(t){window.VhallPlayer&&window.VhallPlayer.seek(this.totalTime*t/100)}})},C=(i(253),Object(y.a)(_,a,[],!1,null,"2bb9b82a",null));C.options.__file="src/pages/watch/video/index.vue";e.a=C.exports},197:function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"chat-wrap",on:{click:t.boxClick}},[i("div",{ref:"bscroll",staticClass:"bscroll",class:"live"!==t.type?"vod":"live",on:{mouseover:function(e){t.stopScroll=!0},mouseout:function(e){t.stopScroll=!1}}},[i("ol",{staticClass:"chat-list bscroll-container"},t._l(t.chatData,function(e,a){return i("li",{class:{right:1*t.joinInfo.activityUserId==1*e.id},attrs:{"data-joinId":e.id}},[i("dl",{staticClass:"clearfix"},[""!==e.avatar?i("dt",[i("img",{attrs:{src:t.imgHost+"/"+e.avatar}})]):i("dt",{staticClass:"avatar"},[t._v(t._s(e.name.substr(0,1)))]),t._v(" "),i("dd",[i("div",{staticClass:"name"},[t._v(t._s(e.name)+" "),e.detail.role?i("em",[t._v(t._s(e.detail.role))]):t._e()]),t._v(" "),i("div",{staticClass:"txt",domProps:{innerHTML:t._s(e.detail.txt)}})])])])})),t._v(" "),t.tipsShow&&t.tipsCount>0?i("transition",[i("span",{staticClass:"msg-tips",on:{click:t.scrollBtm}},[t._v("有"+t._s(t.tipsCount)+"条新消息 "),i("i",{staticClass:"iconfont icon-xiangxia"})])]):t._e(),t._v(" "),i("transition",{attrs:{name:"left-right",mode:"out-in"}},[t.announceShow?i("div",{staticClass:"announce-box"},[i("svg",{staticClass:"icon",staticStyle:{width:"6.667vw",height:"6.667vw","vertical-align":"middle",fill:"currentColor",overflow:"hidden"},attrs:{viewBox:"0 0 1305 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"3285"}},[i("path",{attrs:{d:"M236.3648 689.6384a102.4 102.4 0 0 1 144.6144 7.5776l119.9104 133.1712a102.4 102.4 0 1 1-152.2176 137.0368l-119.9104-133.1712a102.4 102.4 0 0 1 7.6032-144.64z",fill:"#222222","p-id":"3286"}}),i("path",{attrs:{d:"M277.4528 734.4384a25.6 25.6 0 0 0-1.8944 36.1472l119.9104 133.1968a25.6 25.6 0 0 0 38.0672-34.2784l-119.9104-133.1712a25.6 25.6 0 0 0-36.1728-1.8944z",fill:"#FFD021","p-id":"3287"}}),i("path",{attrs:{d:"M144.5888 482.4832l47.2064-12.416a464.8448 464.8448 0 0 0 278.3744-207.104l72.832-119.1168c-15.3088 169.7024-7.9104 291.7888 22.1696 366.208 30.08 74.4704 107.52 162.304 232.2944 263.6032l-138.3168-37.7088a456.064 456.064 0 0 0-342.9376 42.1376l-42.5472 23.8336a173.6704 173.6704 0 0 1-245.9392-86.4256 173.6704 173.6704 0 0 1 116.864-233.0112z",fill:"#222222","p-id":"3288"}}),i("path",{attrs:{d:"M211.328 544.3328l-47.2064 12.4416a96.8448 96.8448 0 0 0-59.904 141.056 96.8704 96.8704 0 0 0 131.8656 37.12l42.5472-23.8336a532.8384 532.8384 0 0 1 389.632-52.1472L528.896 313.9328a541.7728 541.7728 0 0 1-317.5424 230.4z",fill:"#FFD021","p-id":"3289"}}),i("path",{attrs:{d:"M819.5072 795.9552c-94.4896 38.1696-217.088-93.1072-293.3248-281.856-76.2624-188.7232-79.2832-368.3072 15.2064-406.5024 94.5152-38.144 217.088 93.1328 293.3504 281.856 76.2368 188.7232 79.2576 368.3072-15.232 406.5024z",fill:"#222222","p-id":"3290"}}),i("path",{attrs:{d:"M790.7328 724.736c12.9792-5.248 24.2944-35.7888 23.424-88.0384-1.024-61.3888-18.7904-139.6736-50.6368-218.496s-73.472-147.456-115.3536-192.3072c-35.6608-38.1952-65.024-52.3264-78.0032-47.104s-24.2688 35.8144-23.3984 88.064c1.024 61.3888 18.7648 139.6736 50.6112 218.496s73.472 147.456 115.3792 192.3328c35.6608 38.1696 65.024 52.3008 77.9776 47.0528z",fill:"#FFD021","p-id":"3291"}}),i("path",{attrs:{d:"M668.8256 525.4912a76.8 76.8 0 1 1-57.5488-142.3872 76.8 76.8 0 0 1 57.5488 142.3872zM840.9088 233.2928a38.4 38.4 0 1 1-50.176-58.1376l172.544-148.8896a38.4 38.4 0 1 1 50.1504 58.1376l-172.544 148.8896zM951.04 575.1552a38.4 38.4 0 0 1-3.712-76.7232l256.9472-12.3648a38.4 38.4 0 0 1 3.6864 76.7232l-256.9472 12.3648zM902.4 407.9872a38.4 38.4 0 1 1-31.9488-69.8368l370.0736-169.344a38.4 38.4 0 1 1 31.9488 69.8368L902.4 407.9872zM201.3696 637.8496a25.6 25.6 0 1 1-12.1856-49.7152c14.08-3.456 24.576-6.144 31.488-8.0128a25.6 25.6 0 1 1 13.5936 49.3312c-7.4752 2.0736-18.4064 4.864-32.896 8.3968z m111.1552-35.4048a25.6 25.6 0 1 1-20.864-46.7712c40.2688-17.9712 84.7872-42.5216 133.4272-73.6256a25.6 25.6 0 1 1 27.5712 43.136c-50.688 32.4096-97.3568 58.1632-140.1344 77.2608z",fill:"#222222","p-id":"3292"}})]),t._v(" "),i("div",{staticClass:"txt-box"},[i("p",{staticClass:"txt"},[t._v(t._s(t.receiveAnnounce))])]),t._v(" "),i("i",{staticClass:"iconfont icon-close",on:{click:function(e){t.announceShow=!1}}})]):t._e()])],1),t._v(" "),"live"===t.type&&t.isLogin&&t.sendBoxShow?i("div",{staticClass:"v-send-box-bg"},[i("div",{staticClass:"send-box clearfix",attrs:{id:"sendBox"}},[i("div",{staticClass:"top"},[t.swapAnnounce?[i("com-input",{staticClass:"inp",attrs:{value:t.value,placeholder:t.chatPlaceholder,"max-length":140,type:"textarea"},on:{"update:value":function(e){t.value=e}}})]:[i("com-input",{staticClass:"inp",attrs:{value:t.valueAnnounce,placeholder:t.announcePlaceholder,"max-length":140,type:"textarea"},on:{"update:value":function(e){t.valueAnnounce=e}}})]],2),t._v(" "),i("div",{staticClass:"bottom clearfix"},[i("i",{staticClass:"icon-emoji",attrs:{title:"表情"},on:{click:function(e){t.faceOpen=!t.faceOpen}}}),t._v(" "),t.faceOpen?i("div",{staticClass:"face-box"},t._l(t.faceArr,function(e,a){return i("img",{key:a,attrs:{src:"//cnstatic01.e.vhall.com/static/img/arclist/Expression_"+(a+1)+"@2x.png"},on:{click:function(e){e.stopPropagation(),t.inFace(a)}}})})):t._e(),t._v(" "),t.swapAnnounce?[(t.mute||t.allMuted)&&t.isWatch?[i("div",{staticClass:"mute-box"},[t._v(t._s(t.allMuted?"已开启全体禁言":"您已被禁言"))])]:[i("span",{staticClass:"send-btn fr",on:{click:t.sendAction}},[t._v("发送")])]]:[i("span",{staticClass:"send-btn fr",on:{click:t.sendAnnounce}},[t._v("发送")])],t._v(" "),"HOST"!==t.joinInfo.roleName||t.isWatch?t._e():i("div",{staticClass:"fr"},[i("i",{staticClass:"icon-swap",attrs:{title:"切换发送聊天/公告"},on:{click:function(e){t.swapAnnounce?t.swapAnnounce=!1:t.swapAnnounce=!0}}}),t._v(" "),i("div",{staticClass:"switch-box"},[i("span",[t._v("全体禁言")]),i("el-switch",{staticClass:"switch",attrs:{"inactive-color":"#DEE1FF",width:32,"active-color":"#FFD021"},on:{change:t.muteAll},model:{value:t.allMuted,callback:function(e){t.allMuted=e},expression:"allMuted"}})],1)])],2)])]):t._e()])};a._withStripped=!0;var s=i(59),o=i.n(s),n=i(11),l=i.n(n),r=i(25),c=i.n(r),h=i(8),d=i.n(h),u=i(194),p=i(45),m=i(2),v=i(182),y=i(183),g={name:"chat",data(){return{vhallParams:{token:"",appId:"",channelId:"",accountId:""},activityId:this.$route.params.id,value:"",valueAnnounce:"",receiveAnnounce:"",service:null,chatData:[],tipsShow:!1,announceShow:!1,faceOpen:!1,swapAnnounce:!0,mute:!1,allMuted:!1,tipsCount:0,timer:null,isLogin:!1,stopScroll:!1,chatPlaceholder:"请输入聊天内容",announcePlaceholder:"请输入公告内容",aBScroll:null,imgHost:"http://dev-zhike.oss-cn-beijing.aliyuncs.com/",faceArr:[{"[微笑]":"1"},{"[撇嘴]":"2"},{"[色]":"3"},{"[发呆]":"4"},{"[得意]":"5"},{"[流泪]":"6"},{"[害羞]":"7"},{"[闭嘴]":"8"},{"[睡]":"9"},{"[哭]":"10"},{"[尴尬]":"11"},{"[发怒]":"12"},{"[调皮]":"13"},{"[呲牙]":"14"},{"[惊讶]":"15"},{"[难过]":"16"},{"[酷]":"17"},{"[汗]":"18"},{"[抓狂]":"19"},{"[吐]":"20"},{"[偷笑]":"21"},{"[愉快]":"22"},{"[白眼]":"23"},{"[傲慢]":"24"},{"[饥饿]":"25"},{"[困]":"26"},{"[惊恐]":"27"},{"[流汗]":"28"},{"[憨笑]":"29"},{"[悠闲]":"30"},{"[奋斗]":"31"},{"[咒骂]":"32"},{"[疑问]":"33"},{"[嘘]":"34"},{"[晕]":"35"},{"[疯了]":"36"},{"[衰]":"37"},{"[骷髅]":"38"},{"[敲打]":"39"},{"[再见]":"40"},{"[擦汗]":"41"},{"[抠鼻]":"42"},{"[鼓掌]":"43"},{"[糗大了]":"44"},{"[坏笑]":"45"},{"[左哼哼]":"46"},{"[右哼哼]":"47"},{"[哈欠]":"48"},{"[鄙视]":"49"},{"[委屈]":"50"},{"[快哭了]":"51"},{"[阴险]":"52"},{"[亲亲]":"53"},{"[吓]":"54"},{"[可怜]":"55"},{"[菜刀]":"56"},{"[西瓜]":"57"},{"[啤酒]":"58"},{"[篮球]":"59"},{"[乒乓]":"60"},{"[咖啡]":"61"},{"[饭]":"62"},{"[猪头]":"63"},{"[玫瑰]":"64"},{"[凋谢]":"65"},{"[嘴唇]":"66"},{"[爱心]":"67"},{"[心碎]":"68"},{"[蛋糕]":"69"},{"[闪电]":"70"},{"[炸弹]":"71"},{"[刀]":"72"},{"[足球]":"73"},{"[瓢虫]":"74"},{"[便便]":"75"},{"[月亮]":"76"},{"[太阳]":"77"},{"[礼物]":"78"},{"[拥抱]":"79"},{"[强]":"80"},{"[弱]":"81"},{"[握手]":"82"},{"[胜利]":"83"},{"[抱拳]":"84"},{"[勾引]":"85"},{"[拳头]":"86"},{"[差劲]":"87"},{"[爱你]":"88"},{"[NO]":"89"},{"[OK]":"90"}]}},props:{type:{type:String,default:"live"},isWatch:{type:Boolean,default:!1},sendBoxShow:{type:Boolean,default:!1}},computed:d()({},Object(p.c)("liveMager",{roomPaas:t=>t.roomPaas,activityInfo:t=>t.activityInfo,joinInfo:t=>t.joinInfo}),Object(p.c)("tokenMager",{chatParams:t=>t.chatParams}),Object(p.c)("login",{loginInfo:t=>t.loginInfo})),mounted(){this.isWatch||(this.isLogin=!0)},methods:d()({},Object(p.b)("tokenMager",{setChatParams:m.b}),Object(p.b)("liveMager",{storeJoinInfo:m.d}),{initSdk(){let t={channelId:this.roomPaas.channelRoom};c()(this.roomPaas,t),u.a.OBJ.init(this.roomPaas),u.a.OBJ.regHandler("chat",this.listenChat),u.a.OBJ.regHandler("ANNOUNCEMENT",this.listenAnnounce),u.a.OBJ.regHandler("KICK",this.listenKick),u.a.OBJ.regHandler("DISABLE_KICK",this.listenCancelkick),u.a.OBJ.regHandler("GAG",this.listenMute),u.a.OBJ.regHandler("DISABLE_GAG",this.listenCancelmute),u.a.OBJ.regHandler("GAG_ALL",this.listenAllmute),u.a.OBJ.regHandler("DISABLE_GAG_ALL",this.listenCancelallmute)},sendAction(){if(!this.value.replace(/\n/g,"").length)return this.chatPlaceholder="聊天内容不能为空",!1;const t="HOST"===this.joinInfo.roleName?"主持人":"";u.a.OBJ.activityId=this.activityId;const e={role:t,txt:this.value};u.a.OBJ.sendChat(l()(e)),this.value="",this.chatPlaceholder="请输入聊天内容",this.faceOpen=!1,this.$emit("closeChatBox",!0)},listenChat(t){console.log("接收 聊天消息",t),this.reArrange(t),this.tipsShow&&this.tipsCount++},listenAnnounce(t){console.log("接收 公告消息",t),this.announceShow=!0,this.receiveAnnounce=t.content;const e=this;clearTimeout(e.timer),e.timer=setTimeout(function(){e.announceShow=!1,this.receiveAnnounce="",clearTimeout(e.timer)},15e3)},listenKick(t){console.log("接收 踢出消息",t),this.refreshList(t.activityUserId,"isKick","Y"),this.isSelf(t.activityUserId)&&this.$router.push({path:"/kicked"})},listenCancelkick(t){console.log("接收 取消踢出消息"+t),this.refreshList(t.activityUserId,"isKick","N")},listenMute(t){console.log("接收 禁言消息",t),this.refreshList(t.activityUserId,"isGag","Y"),this.isSelf(t.activityUserId)&&(this.mute=!0)},listenCancelmute(t){this.refreshList(t.activityUserId,"isGag","N"),console.log("接收 取消禁言消息",t),this.isSelf(t.activityUserId)&&(this.mute=!1)},listenAllmute(t){console.log("接收 全体禁言消息",t),this.allMuted=!0},listenCancelallmute(t){console.log("接收 取消全体禁言消息",t),this.allMuted=!1},isSelf(t){return this.joinInfo.activityUserId===t},refreshList(t,e,i){this.chatData.forEach(a=>{1*a.id==1*t&&(a[e]=i)})},reArrange(t){const e={};e.id=t.third_party_user_id,e.avatar=t.avatar,e.name=t.nick_name,e.isGag=t.isGag,e.isKick=t.isKick,e.detail=JSON.parse(t.data);for(let t=0;t<this.faceArr.length;t++)for(let i in this.faceArr[t]){let a=i.replace(/\[/,"\\[").replace(/\]/,"\\]"),s=new RegExp(a,"g");e.detail.txt=e.detail.txt.replace(s,"<img src='//cnstatic01.e.vhall.com/static/img/arclist/Expression_"+this.faceArr[t][i]+"@2x.png'>")}if(this.chatData.push(e),!this.tipsShow&&!this.stopScroll){const t=this;setTimeout(function(){t.scrollBtm()},200)}this.stopScroll&&(this.tipsShow=!0)},sendAnnounce(){if(!this.valueAnnounce.replace(/\n/g,"").length)return this.announcePlaceholder="公告内容不能为空",!1;const t={activityId:this.activityId,message:this.valueAnnounce};this.$get(y.a.GET_SENDANNOUNCEMENT,t).then(t=>{this.$toast({content:"公告发送成功"}),this.valueAnnounce="",this.announcePlaceholder="请输入公告内容",this.$emit("closeChatBox",!0)})},scrollBtm(){this.aBScroll.scrollTo(0,this.aBScroll.maxScrollY,500,"bounce"),setTimeout(()=>{this.tipsCount=0},500)},inFace(t){for(let e in this.faceArr[t])this.value+=e},boxClick(t){"icon-emoji"!==t.target.className&&(this.faceOpen=!1)},getHistroy(){this.$get(y.a.GET_MESSAGELIST,{activityId:this.activityId}).then(t=>{t.data.reverse().forEach(t=>{this.reArrange(t)})})},muteAll(){const t={activityId:this.activityId,cancel:this.allMuted?"N":"Y"};this.$post(y.a.POST_GAGALL,t).then(e=>{this.$toast({content:"Y"===t.cancel?"已取消全体禁言":"已开启全体禁言"})})},initToken(){if(this.isWatch)return this.roomPaas},initScroll(){this.$nextTick(()=>{let t=this.$refs.bscroll;this.aBScroll=new v.a(t,{scrollbar:!0,click:!0,mouseWheel:!0,"probeType ":3}),this.aBScroll.on("scrollEnd",t=>{let e=document.getElementsByClassName("chat-list")[0].offsetHeight;.5*e>document.getElementsByClassName("bscroll")[0].offsetHeight&&.5*e>-1*t.y?this.tipsShow=!0:this.tipsShow=!1})})},initInfo(){var t=this;return o()(function*(){t.initSdk()})()},loginHandler(){this.$emit("showLogin")}}),watch:{"loginInfo.consumerUserId":{handler(t){t&&this.isWatch&&(this.isLogin=!0)},deep:!0,immediate:!0},allMuted:{handler(t){t?this.$emit("isMute",{isMute:!0,type:"allMuted"}):this.$emit("isMute",{isMute:!1,type:"allMuted"})},deep:!0},mute:{handler(t){t?this.$emit("isMute",{isMute:!0,type:"mute"}):this.$emit("isMute",{isMute:!1,type:"mute"})},deep:!0},activityInfo:{handler(t){"Y"===t.setting.gag?this.allMuted=!0:this.allMuted=!1},deep:!0},"roomPaas.channelId":{handler(t){t&&(console.log(t),this.initInfo())},immediate:!0,deep:!0},"joinInfo.isGag":{handler(t){"Y"===t&&this.isWatch&&(this.mute=!0)},deep:!0,immediate:!0},"joinInfo.isKick":{handler(t){"Y"===t&&this.isWatch&&this.$router.push({path:"/kicked"})},deep:!0,immediate:!0}}},f=(i(255),i(1)),w=Object(f.a)(g,a,[],!1,null,"3a2ec7eb",null);w.options.__file="src/components/chat/index.vue";e.a=w.exports},210:function(t,e,i){},211:function(t,e,i){},212:function(t,e,i){},251:function(t,e,i){"use strict";var a=i(210);i.n(a).a},253:function(t,e,i){"use strict";var a=i(211);i.n(a).a},255:function(t,e,i){"use strict";var a=i(212);i.n(a).a}}]);
//# sourceMappingURL=1.1b9129c1.js.map