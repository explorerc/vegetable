{"version":3,"sources":["webpack:///./src/pages/guide/success.vue?411a","webpack:///./src/pages/guide/success.vue?19ed","webpack:///./src/pages/guide/success.vue?439f","webpack:///src/pages/guide/success.vue","webpack:///./src/pages/guide/success.vue"],"names":["_node_modules_mini_css_extract_plugin_0_4_3_mini_css_extract_plugin_dist_loader_js_node_modules_css_loader_1_0_0_css_loader_index_js_node_modules_vue_loader_15_4_2_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_2_1_6_postcss_loader_lib_index_js_node_modules_sass_loader_7_1_0_sass_loader_lib_loader_js_node_modules_vue_loader_15_4_2_vue_loader_lib_index_js_vue_loader_options_success_vue_vue_type_style_index_0_id_3ffef81c_lang_scss_scoped_true___WEBPACK_IMPORTED_MODULE_0__","__webpack_require__","n","render","_vm","this","_h","$createElement","_c","_self","activity","countDown","status","staticClass","attrs","src","alt","_v","on","click","accountSubmit","viewCondition","_e","_s","startTime","_withStripped","guide_successvue_type_script_lang_js_","mixins","login_mixin","data","MOBILE_HOST","extChannel","user","phone","isApplay","isOrder","vhallParams","token","appId","channelId","accountId","visitorObj","mounted","components","created","getInfo","computed","Object","vuex_esm","chatParams","state","watch","methods","extends_default","setChatParams","mutation_types","doAuth","$route","params","id","initSdk","initMsgServe","_this","asyncToGenerator_default","regenerator_default","a","mark","_callee","roomInfo","wrap","_context","prev","next","$config","handlers","$post","user_service","GET_VISITOR_INFO","wechatAuth","sessionStorage","getItem","then","res","visitorId","abrupt","activity_service","GET_REG_SDK_INFO","thirdUserId","channel","sent","ChatService","OBJ","init","channelRoom","regHandler","chat_config","beginLive","msg","console","log","stop","handleActivityStart","_this2","_callee2","_context2","$get","GET_LIVEINFO","activityId","joinInfo","extChannelRoom","time","interval","setInterval","i","clearInterval","component","componentNormalizer","options","__file","__webpack_exports__"],"mappings":"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","file":"static/js/6.375142d9.js","sourcesContent":["import mod from \"-!../../../node_modules/_mini-css-extract-plugin@0.4.3@mini-css-extract-plugin/dist/loader.js!../../../node_modules/_css-loader@1.0.0@css-loader/index.js!../../../node_modules/_vue-loader@15.4.2@vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/_postcss-loader@2.1.6@postcss-loader/lib/index.js!../../../node_modules/_sass-loader@7.1.0@sass-loader/lib/loader.js!../../../node_modules/_vue-loader@15.4.2@vue-loader/lib/index.js??vue-loader-options!./success.vue?vue&type=style&index=0&id=3ffef81c&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../node_modules/_mini-css-extract-plugin@0.4.3@mini-css-extract-plugin/dist/loader.js!../../../node_modules/_css-loader@1.0.0@css-loader/index.js!../../../node_modules/_vue-loader@15.4.2@vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/_postcss-loader@2.1.6@postcss-loader/lib/index.js!../../../node_modules/_sass-loader@7.1.0@sass-loader/lib/loader.js!../../../node_modules/_vue-loader@15.4.2@vue-loader/lib/index.js??vue-loader-options!./success.vue?vue&type=style&index=0&id=3ffef81c&lang=scss&scoped=true&\"","var render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  return _vm.activity.countDown < 1800 || _vm.activity.status === \"LIVING\"\n    ? _c(\"div\", { staticClass: \"v-success\" }, [\n        _c(\"img\", {\n          staticClass: \"v-img\",\n          attrs: { src: require(\"../../assets/image/success@2x.png\"), alt: \"\" }\n        }),\n        _vm._v(\" \"),\n        _vm.activity.status === \"LIVING\"\n          ? _c(\"p\", { staticClass: \"v-start-title\" }, [\n              _c(\"span\", [_vm._v(\"直播正在进行中\")])\n            ])\n          : _c(\"p\", { staticClass: \"v-start-title\" }, [\n              _c(\"span\", [_vm._v(\"直播将要开始啦\")])\n            ]),\n        _vm._v(\" \"),\n        _c(\n          \"button\",\n          { staticClass: \"primary-button\", on: { click: _vm.accountSubmit } },\n          [_vm._v(\"进入直播\")]\n        )\n      ])\n    : _c(\"div\", { staticClass: \"v-success\" }, [\n        _c(\"img\", {\n          staticClass: \"v-img\",\n          attrs: { src: require(\"../../assets/image/success@2x.png\"), alt: \"\" }\n        }),\n        _vm._v(\" \"),\n        _vm.activity.status === \"FINISH\"\n          ? _c(\"p\", { staticClass: \"v-success-title\" }, [\n              _c(\"span\", [_vm._v(\"直播已结束\")])\n            ])\n          : _c(\"p\", { staticClass: \"v-success-title\" }, [\n              _vm.activity.viewCondition === \"APPOINT\"\n                ? _c(\"span\", [_vm._v(\"报名成功\")])\n                : _vm.activity.viewCondition === \"NONE\"\n                  ? _c(\"span\", [_vm._v(\"预约成功\")])\n                  : _vm._e()\n            ]),\n        _vm._v(\" \"),\n        _vm.activity.status != \"FINISH\"\n          ? _c(\"p\", [\n              _vm._v(\"活动将于\\n    \"),\n              _c(\"span\", { staticClass: \"v-red\" }, [\n                _vm._v(_vm._s(_vm.activity.startTime))\n              ]),\n              _vm._v(\"准时开播\")\n            ])\n          : _vm._e()\n      ])\n}\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns }","import mod from \"-!../../../node_modules/_babel-loader@7.1.5@babel-loader/lib/index.js!../../../node_modules/_vue-loader@15.4.2@vue-loader/lib/index.js??vue-loader-options!./success.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/_babel-loader@7.1.5@babel-loader/lib/index.js!../../../node_modules/_vue-loader@15.4.2@vue-loader/lib/index.js??vue-loader-options!./success.vue?vue&type=script&lang=js&\"","<template>\n  <div class=\"v-success\"\n       v-if=\"activity.countDown < 1800 || activity.status === 'LIVING'\">\n    <img src=\"../../assets/image/success@2x.png\"\n         alt=\"\"\n         class=\"v-img\">\n    <p class=\"v-start-title\" v-if=\"activity.status === 'LIVING'\">\n      <span>直播正在进行中</span>\n    </p>\n    <p class=\"v-start-title\" v-else>\n      <span>直播将要开始啦</span>\n    </p>\n    <button class=\"primary-button\"\n            @click=\"accountSubmit\">进入直播</button>\n  </div>\n  <div class=\"v-success\"\n       v-else>\n    <img src=\"../../assets/image/success@2x.png\"\n         alt=\"\"\n         class=\"v-img\">\n    <p class=\"v-success-title\" v-if=\"activity.status === 'FINISH'\">\n      <span>直播已结束</span>\n    </p>\n    <p class=\"v-success-title\" v-else>\n      <span v-if=\"activity.viewCondition === 'APPOINT'\">报名成功</span>\n      <span v-else-if=\"activity.viewCondition === 'NONE'\">预约成功</span>\n    </p>\n    <p v-if=\"activity.status != 'FINISH'\">活动将于\n      <span class=\"v-red\">{{activity.startTime}}</span>准时开播</p>\n  </div>\n</template>\n<script>\nimport loginMixin from 'components/login-mixin'\nimport { mapMutations, mapState } from 'vuex'\nimport * as types from 'src/store/mutation-types'\nimport ChatConfig from 'src/api/chat-config'\nimport activityService from 'src/api/activity-service'\nimport userService from 'src/api/user-service'\nimport ChatService from 'src/components/chat/ChatService.js'\nexport default {\n  mixins: [loginMixin],\n  data () {\n    return {\n      MOBILE_HOST: process.env.MOBILE_HOST,\n      activity: {\n        viewCondition: '', // APPOINT是报名活动 NONE是无限制活动\n        status: '', // 当前活动状态 LIVING 直播中\n        startTime: '', // 当前活动开始时间\n        countDown: '',\n        extChannel: '' // sdk消息频道\n      },\n      user: {\n        phone: '', // 无条件观看用户手机\n        isApplay: false, // 是否已经报名\n        isOrder: false // 是否已经预约\n      },\n      vhallParams: {\n        token: '',\n        appId: '',\n        channelId: '',\n        accountId: ''\n      },\n      visitorObj: {} // 游客信息\n    }\n  },\n  mounted () {\n  },\n  components: {\n  },\n  created () {\n    this.getInfo()\n  },\n  computed: mapState('tokenMager', {\n    chatParams: state => state.chatParams\n  }),\n  watch: {\n  },\n  methods: {\n    ...mapMutations('tokenMager', {\n      setChatParams: types.CHAT_PARAMS\n    }),\n    accountSubmit () {\n      this.doAuth(this.MOBILE_HOST + 'watch/' + this.$route.params.id)\n    },\n    initSdk () {\n      this.initMsgServe()\n      // window.Vhall.ready(() => {\n      // })\n    },\n    async initMsgServe () {\n      await this.$config({ handlers: true }).$post(userService.GET_VISITOR_INFO, {\n        wechatAuth: sessionStorage.getItem('wechatAuth')\n      }).then((res) => {\n        this.visitorObj.visitorId = res.data\n      })\n      if (!this.extChannel) return false\n      const roomInfo = await this.$config({ handlers: true }).$post(activityService.GET_REG_SDK_INFO, {\n        thirdUserId: `visitor_${this.visitorObj.visitorId}`,\n        channel: this.extChannel\n      }).then((res) => {\n        return res.data\n      })\n      ChatService.OBJ.init({\n        accountId: roomInfo.accountId,\n        token: roomInfo.token,\n        appId: roomInfo.appId,\n        channelId: roomInfo.channelRoom\n      })\n      /* 监听微信测试发送成功消息 */\n      ChatService.OBJ.regHandler(ChatConfig.beginLive, (msg) => {\n        console.log(msg)\n        this.doAuth(this.MOBILE_HOST + 'watch/' + this.$route.params.id)\n      })\n    },\n    handleActivityStart (msg) {\n      this.activity.countDown = 1799\n    },\n    async getInfo () {\n      await this.$config({ handlers: true }).$get(activityService.GET_LIVEINFO, {\n        activityId: this.$route.params.id\n      }).then((res) => {\n        this.initSdk()\n        this.activity.viewCondition = res.data.activity.viewCondition\n        this.activity.status = res.data.activity.status\n        this.activity.startTime = res.data.activity.startTime\n        this.activity.countDown = res.data.activity.countDown\n        this.user.isApplay = res.data.joinInfo.isApplay\n        this.user.isOrder = res.data.joinInfo.isOrder\n        this.extChannel = res.data.activity.extChannelRoom\n        if ((this.activity.status === 'LIVING' || this.activity.countDown <= 1799 || this.activity.status === 'PLAYBACK')) {\n          if (this.activity.viewCondition === 'APPOINT') {\n            if (res.data.joinInfo.isApplay) {\n              this.doAuth(this.MOBILE_HOST + 'watch/' + this.$route.params.id)\n            }\n          } else if (res.data.joinInfo.isOrder && this.activity.viewCondition === 'NONE') {\n            this.doAuth(this.MOBILE_HOST + 'watch/' + this.$route.params.id)\n          }\n        }\n        if (this.activity.countDown > 1800) {\n          let time = this.activity.countDown\n          let interval = setInterval(i => {\n            time--\n            if (time < 30 * 60) {\n              this.activity.countDown = 1799\n              clearInterval(interval)\n            }\n          }, 1000)\n        }\n      })\n      // this.getToken()\n    }\n    // ,\n    // getToken () {\n    //   if ((this.activity.viewCondition === 'APPOINT' && this.user.isApplay) || this.activity.viewCondition !== 'APPOINT') {\n    //     // 报名活动在已报名状态下和预约活动所有状态下可收到消息\n    //     if (!this.chatParams.token) {\n    //       // 当前vuex中没有聊天token 需要获取\n    //       this.$config({ handlers: true }).$get(userService.GET_USERREGACTIVITY, { // 获取参会信息\n    //         activityId: this.$route.params.id\n    //       }).then((res) => {\n    //         this.$config({ handlers: true }).$get(activityService.GET_SDKTOKEN, { // 获取观看端token\n    //           activityId: this.$route.params.id,\n    //           activityUserId: res.data.activityUserId\n    //         }).then((res) => {\n    //           this.vhallParams.token = res.data.token\n    //           this.vhallParams.appId = res.data.appId\n    //           this.vhallParams.channelId = res.data.channelRoom\n    //           this.vhallParams.accountId = res.data.accountId // 从参会接口取activiUserID\n    //           this.setChatParams(this.vhallParams)\n    //           this.$nextTick(() => {\n    //             this.initSdk()\n    //           })\n    //         })\n    //       })\n    //     } else {\n    //       this.vhallParams = this.chatParams\n    //       this.$nextTick(() => {\n    //         this.initSdk()\n    //       })\n    //     }\n    //   }\n    // }\n  }\n}\n</script>\n<style lang=\"scss\" scoped>\n@import '~assets/css/mixin.scss';\n.v-success {\n  .v-img {\n    display: block;\n    width: 224px;\n    margin: 0 auto;\n  }\n  p {\n    text-align: center;\n    margin-top: 22px;\n    font-size: 28px;\n    color: #222;\n    &.v-success-title,\n    &.v-start-title {\n      font-size: 40px;\n    }\n    .v-red {\n      color: #fc5659;\n    }\n  }\n  .primary-button {\n    width: 490px;\n    height: 90px;\n    border-radius: 50px;\n    display: block;\n    margin: 25px auto 5px;\n  }\n}\n</style>\n","import { render, staticRenderFns } from \"./success.vue?vue&type=template&id=3ffef81c&scoped=true&\"\nimport script from \"./success.vue?vue&type=script&lang=js&\"\nexport * from \"./success.vue?vue&type=script&lang=js&\"\nimport style0 from \"./success.vue?vue&type=style&index=0&id=3ffef81c&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/_vue-loader@15.4.2@vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"3ffef81c\",\n  null\n  \n)\n\n/* hot reload */\nif (module.hot) {\n  var api = require(\"/Users/x.g/Documents/work/fe_interaction_h5/node_modules/_vue-hot-reload-api@2.3.1@vue-hot-reload-api/dist/index.js\")\n  api.install(require('vue'))\n  if (api.compatible) {\n    module.hot.accept()\n    if (!module.hot.data) {\n      api.createRecord('3ffef81c', component.options)\n    } else {\n      api.reload('3ffef81c', component.options)\n    }\n    module.hot.accept(\"./success.vue?vue&type=template&id=3ffef81c&scoped=true&\", function () {\n      api.rerender('3ffef81c', {\n        render: render,\n        staticRenderFns: staticRenderFns\n      })\n    })\n  }\n}\ncomponent.options.__file = \"src/pages/guide/success.vue\"\nexport default component.exports"],"sourceRoot":""}