(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{184:function(e,t,i){"use strict";t.a={POST_SUBSCRIBE:"/frontend/user/order-activity",GET_LIVEINFO:"/frontend/live/info",GET_SHAREINFO:"/frontend/share/info",GET_QUESTIONINFO:"/frontend/question/info",POST_QUESTIONINFO:"/frontend/user/apply-activity",GET_CREATEACCESSTOKEN:"/common/paas/create-access-token",GET_ONLINENUM:"/frontend/channel/get-online-num",GET_SHARESIGN:"/common/wechat/get-share-sign",GET_SDKTOKEN:"/frontend/live/sdk-token",GET_SEND:"/index/send",GET_SENDANNOUNCEMENT:"/initiator/channel/send-announcement",POST_GAG:"/initiator/user/gag",POST_GAGALL:"/initiator/user/gag-all",POST_KICK:"/initiator/user/kick",POST_EMAILSUBSCRIBE:"/frontend/user/email-subscribe",GET_MESSAGELIST:"/common/paas/message-list",GET_CAPTCHAID:"/common/message/get-captchaid",GET_CODE:"/common/message/send-code",GET_TEMPLATE:"/frontend/live/template",GET_DEFAULEREPLAY:"/frontend/replay/default-replay",GET_WARMINFO:"/manage/warm-up-manage/get"}},185:function(e,t,i){},186:function(e,t,i){"use strict";var o=i(7),n=i.n(o),s=i(11),a=i.n(s),c=i(0),r=i.n(c),l=i(46),h=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"login-container"},[i("com-dialog",{attrs:{visible:e.visible,center:""},on:{"update:visible":function(t){e.visible=t},close:e.closed}},[i("div",[i("div",{staticClass:"rule"},[e._v("登录参与直播互动")]),e._v(" "),i("com-input",{staticClass:"mobile",attrs:{type:"input",placeholder:"请输入手机"},model:{value:e.mobile,callback:function(t){e.mobile=t},expression:"mobile"}}),e._v(" "),i("div",{attrs:{id:"captcha"}}),e._v(" "),i("com-input",{staticClass:"code",attrs:{type:"input",placeholder:"请输入验证码"},model:{value:e.code,callback:function(t){e.code=t},expression:"code"}}),e._v(" "),i("com-button",{staticClass:"codeBtn",attrs:{disabled:!e.codeEnable,type:"primary"},on:{click:e.getCode}},[e._v(e._s(e.codeText))])],1),e._v(" "),i("div",{staticClass:"footer",attrs:{slot:"footer"},slot:"footer"},[i("com-button",{attrs:{type:"primary",disabled:!e.submitEnable},on:{click:e.doLogin}},[e._v("登录")])],1)])],1)};h._withStripped=!0;var d=i(184),m=i(58),u={name:"ComLogin",data:()=>({visible:!1,time:60,captchaIns:null,key:null,verify:!1,mobile:"",code:"",mobileReg:/^1[3|4|5|6|7|8|9][0-9]\d{8}$/,captchaKey:""}),mounted(){this.$get(d.a.GET_CAPTCHAID).then(e=>{this.key=e.data,window.initNECaptcha({element:"#captcha",mode:"float",width:"100%",captchaId:this.key,onVerify:(e,t)=>{e?console.log(e):(this.verify=!0,this.captchaKey=t.validate)}},e=>{this.captchaIns=e},e=>{console.log(e)})})},methods:{getCode(){this.$config({handlers:!0}).$get(d.a.GET_CODE,{mobile:this.mobile,type:"CONSUMER_USER_LOGIN",captcha:this.captchaKey,__errHandler:!0}).then(e=>{this.time--,this.timer=setInterval(()=>{this.time--,0===this.time&&(clearInterval(this.timer),this.time=60)},1e3),console.log(e)})},doLogin(){this.$config({handlers:!0}).$post(m.a.POST_MOBILELOGIN,{mobile:this.mobile,code:this.code,wechatAuth:sessionStorage.getItem("wechatAuth"),__errHandler:!0}).then(e=>{this.$parent.updateLoginInfo(e.data),this.visible=!1,this.closed(),this.$emit("login",e.data)}).catch(()=>{this.verify=!1,this.captchaKey="",this.captchaIns.refresh()})},closed(){this.mobile="",this.time=60,this.verify=!1,this.captchaKey="",this.captchaIns.refresh(),clearInterval(this.timer)}},computed:{codeText(){return this.codeEnable||60===this.time?"发送验证码":`倒计时${this.time}秒`},codeEnable(){return this.mobileReg.test(this.mobile)&&this.verify&&60===this.time},submitEnable(){return this.mobileReg.test(this.mobile)&&this.verify&&this.code}}},g=(i(187),i(1)),p=Object(g.a)(u,h,[],!1,null,"9f4e7bf2",null);p.options.__file="src/components/login-box.vue";var f=p.exports;r.a.use(l.a);const v=new r.a;t.a={components:{ComLogin:f},data:()=>({login:null}),mounted(){this.login=this.$children.find(e=>"ComLogin"===e.$options.name),this.$route.meta.pop&&(this.$route.meta.pop=!1,this.login.visible=!0)},methods:{getAuthInfo:()=>sessionStorage.getItem("wechatAuth"),getLoginInfo:()=>JSON.parse(sessionStorage.getItem("login")),doAuth(e){let t=location.href;e&&(t=e),sessionStorage.getItem("wechatAuth")?location.href=t:(console.log(t),location.href=`/api/frontend/user/wechat-login?backUrl=${encodeURIComponent(t)}`)},doLogin(e){if(sessionStorage.getItem("wechatAuth"))this.login.visible=!0;else{let t=location.href;"string"==typeof e&&(t=e),-1===t.indexOf("?")?t+="?_pop=true":t+="&_pop=true",location.href=`/api/frontend/user/wechat-login?backUrl=${encodeURIComponent(t)}`}},updateLoginInfo(e){e?sessionStorage.setItem("login",a()(e)):(sessionStorage.removeItem("login"),sessionStorage.removeItem("wechatAuth"))},getMasterInfo:e=>new n.a((e,t)=>{sessionStorage.getItem("master")?e(JSON.parse(sessionStorage.getItem("master"))):v.$config({loading:!0,handlers:!0}).$get(m.a.GET_JOININFO).then(t=>{sessionStorage.setItem("master",a()(t.data)),e(t.data)}).catch(e=>{t(e)})})}}},187:function(e,t,i){"use strict";var o=i(185);i.n(o).a},219:function(e,t,i){},260:function(e,t,i){"use strict";var o=i(219);i.n(o).a},297:function(e,t,i){"use strict";i.r(t);var o=function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("com-login"),this._v(" "),t("button",{on:{click:this.doAuth}},[this._v("授权")]),this._v(" "),t("button",{on:{click:this.doLogin}},[this._v("登陆")])],1)};o._withStripped=!0;var n={mixins:[i(186).a]},s=(i(260),i(1)),a=Object(s.a)(n,o,[],!1,null,null,null);a.options.__file="src/pages/test-login.vue";t.default=a.exports}}]);
//# sourceMappingURL=11.8b158fde.js.map