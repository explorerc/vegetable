(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{238:function(t,i,e){},239:function(t,i,e){},240:function(t,i,e){},241:function(t,i,e){},242:function(t,i,e){},243:function(t,i,e){},284:function(t,i,e){"use strict";var n=e(238);e.n(n).a},286:function(t,i,e){"use strict";var n=e(239);e.n(n).a},288:function(t,i,e){"use strict";var n=e(240);e.n(n).a},290:function(t,i,e){"use strict";var n=e(241);e.n(n).a},292:function(t,i,e){"use strict";var n=e(242);e.n(n).a},294:function(t,i,e){"use strict";var n=e(243);e.n(n).a},330:function(t,i,e){"use strict";e.r(i);var n=function(){var t=this,i=t.$createElement,n=t._self._c||i;return n("div",{staticClass:"v-watch"},[t.domShow?n("div",{staticClass:"v-hearder clearfix",on:{orientationchange:function(i){t.orientationchange(i)}}},[n("span",{staticClass:"v-status"},["直播中"===t.activityStatus?n("i"):t._e(),t._v(t._s(t.activityStatus)+"\n    ")]),t._v(" "),"直播中"===t.activityStatus?n("span",{staticClass:"v-onlineNum"},[t._v(t._s(t.showPersonCount)+"人在线")]):t._e(),t._v(" "),t.loginInfo?n("a",{staticClass:"fr v-my",attrs:{href:"/m/site/"+t.activityId}},[n("i",{staticClass:"v-showpsd iconfont icon-guanwang"}),t._v("官网")]):n("a",{staticClass:"fr v-my",attrs:{href:"javascript:;"},on:{click:function(i){t.doLogin()}}},[n("i",{staticClass:"v-showpsd iconfont icon-wode_icon"}),t._v("登录")]),t._v(" "),n("a",{staticClass:"fr",attrs:{href:"javascript:;"},on:{click:t.subscribe}},[n("i",{staticClass:"v-showpsd iconfont icon-dingyue_icon"}),t._v("订阅")])]):t._e(),t._v(" "),n(t.currentView,{tag:"component",attrs:{paasParams:t.vhallParams,domShow:t.domShow}}),t._v(" "),n("message-box",{directives:[{name:"show",rawName:"v-show",value:t.subscribeShow,expression:"subscribeShow"}],on:{handleClick:function(i){t.subscribeClick(i)}}},[n("div",{attrs:{slot:"header"},slot:"header"}),t._v(" "),t.defaultImg?n("img",{staticClass:"v-logo",attrs:{src:t.defaultImg,alt:""}}):t._e(),t._v(" "),n("p",{staticClass:"v-title"},[t._v("\n      "+t._s(t.companyName)+"\n    ")]),t._v(" "),n("div",{staticClass:"v-from"},[n("p",{staticClass:"v-explain"},[t._v("\n        请留下您的邮箱，我们会将更多的活动推送给您\n      ")]),t._v(" "),n("com-input",{attrs:{value:t.email,placeholder:"请输入邮箱",errorTips:t.errorTips},on:{"update:value":function(i){t.email=i},focus:function(i){t.emailFocus()}}})],1)]),t._v(" "),n("message-box",{directives:[{name:"show",rawName:"v-show",value:t.successShow,expression:"successShow"}],attrs:{autoClose:t.autoClose},on:{handleClick:t.successClick}},[n("div",{attrs:{slot:"header"},slot:"header"}),t._v(" "),n("img",{staticClass:"v-success",attrs:{src:e(235),alt:""}}),t._v(" "),n("p",{staticClass:"v-title v-success-title"},[t._v("\n      恭喜您，订阅成功！\n    ")])]),t._v(" "),n("com-login",{on:{login:t.loginSuccess}})],1)};n._withStripped=!0;var a=e(10),o=e.n(a),s=e(50),c=e.n(s),r=e(71),l=e.n(r),u=e(17),h=e.n(u),d=e(12),v=e.n(d),p=e(49),f=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",[e("div",{staticClass:"v-video"},[e("play-video",{attrs:{role:"watcher","play-type":t.playType,startInit:t.startInit}})],1),t._v(" "),t.domShow?e("div",{staticClass:"v-function-box"},[e("div",{staticClass:"v-nav"},[e("com-tabs",{attrs:{value:t.tabValue},on:{"update:value":function(i){t.tabValue=i},change:t.tabChange}},[e("com-tab",{attrs:{label:"活动简介",index:1}},[e("div",{staticClass:"v-introduction",domProps:{innerHTML:t._s(t.activityInfo.description)}})]),t._v(" "),e("com-tab",{attrs:{label:"互动聊天",index:2}},[e("div",{staticClass:"chat-content"},[e("chating",{ref:"chatbox",attrs:{type:t.playType,isWatch:t.isWatch,sendBoxShow:t.sendBoxShow},on:{closeChatBox:t.closeChatBox,isMute:function(i){t.isMute(i)}}})],1),t._v(" "),"live"===t.playType&&t.isLogin?[t.isMuteShow?[e("div",{staticClass:"v-chat-control v-noLogin",attrs:{id:"sendBoxBtn"}},[t._v("\n                "+t._s(t.allMuted?"已开启全体禁言":"您已被禁言")+"\n              ")])]:[e("div",{staticClass:"v-chat-control",attrs:{id:"sendBoxBtn"},on:{click:function(i){t.chatClick()}}},[e("i",{staticClass:"iconfont icon-biaoqing"}),t._v(" "),e("span",{staticClass:"v-chat-clickbox"},[t._v("\n                  输入文字聊天\n                ")])])]]:"live"!==t.playType||t.isLogin?t._e():[e("div",{staticClass:"v-chat-control v-noLogin",attrs:{id:"sendBoxBtn"}},[t._v("\n              需要登录才能参与聊天\n              "),e("span",{on:{click:t.doLogin}},[t._v("登录")])])]],2)],1)],1)]):t._e(),t._v(" "),e("com-login",{on:{login:t.loginSuccess}})],1)};f._withStripped=!0;var m=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"play-container"},["pre"==t.playType?e("div",{staticClass:"play-video-box",attrs:{id:t.playBoxId}},[t.imageSrc?e("img",{attrs:{src:t.imageSrc}}):t._e()]):"live"==t.playType?e("div",{staticClass:"play-video-box",attrs:{id:t.playBoxId}}):"vod"==t.playType?e("div",{staticClass:"play-video-box",attrs:{id:t.playBoxId}},[e("div",{staticStyle:{width:"100%",height:"100%"},domProps:{innerHTML:t._s(this.outLineLink)}})]):(t.playType,e("div",{staticClass:"play-video-box",attrs:{id:t.playBoxId}},[t.imageSrc?e("img",{attrs:{src:t.imageSrc}}):t._e()])),t._v(" "),t.playBtnShow?e("i",{staticClass:"iconfont icon-bofang",on:{click:t.playVideo}}):t._e(),t._v(" "),e("div",{staticClass:"control-box-div"},["vod"==t.playType&&!t.outLineLink||"warm"==t.playType||"vod"==t.playType?e("div",{staticClass:"control-video-box"},[e("video-control",{attrs:{currentTime:t.currentTime,totalTime:t.totalTime,qualitys:t.qualitys},on:{control:t.playControl}})],1):t._e()]),t._v(" "),!t.imageSrc||t.isPlay||"live"!=t.playType&&"warm"!=t.playType?t._e():e("img",{staticClass:"v-mark",attrs:{src:t.imageSrc},on:{click:t.startPlay}})])};m._withStripped=!0;var y=e(105),g=e.n(y),w=e(72),I=e.n(w),S=e(73),_=e.n(S),C=e(218),b=e.n(C),x=e(219),k=e.n(x),P=e(220),T=e.n(P),B=function(t){function i(t,e,n,a){I()(this,i);var o=b()(this,(i.__proto__||g()(i)).call(this,t,n,a));return o.type="live",o.roomId=e,o}return T()(i,t),_()(i,[{key:"initLivePlayer",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=this,e=(arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]?arguments[2]:null);console.log("1调用初始化拉流器");var n={};!!navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)||(n={"x5-video-player-type":"h5","x5-video-orientation":"portrait","x5-video-player-fullscreen":!1}),window.Vhall.ready(function(){console.log("2SDK初始化完成"),window.VhallPlayer.init({roomId:i.roomId,type:"live",videoNode:i.rootEleId,videoAttr:n,complete:function(){console.log("3播放器初始化完成"),e&&e(),t&&window.VhallPlayer.play()}}),i.player=window.VhallPlayer})}},{key:"accountId",set:function(t){k()(i.prototype.__proto__||g()(i.prototype),"accoundId",t,this),console.log("aaa",this.appId,this.roomId,this.rootEleId,this.token),window.Vhall.config({appId:this.appId,accountId:t,token:this.token})}}]),i}(function(){function t(i,e,n){I()(this,t),this.appId=i,this.rootEleId=e,this.token=n,this.type="",this._accountId=null,this.player=null}return _()(t,[{key:"play",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.player.play(),t&&t()}},{key:"pause",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.player.pause(),t&&t()}},{key:"resume",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.player.play(),t&&t()}},{key:"getQuality",value:function(){return this.player.getQuality()}},{key:"setQuality",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.player.setQuality(t),i&&i()}},{key:"setFullScreen",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.player.setFullScreen(t),i&&i()}},{key:"isFullscreen",value:function(){return this.player.isFullscreen()}},{key:"destroy",value:function(){this.player&&this.player.destroy()}},{key:"accoundId",set:function(t){this._accountId=t},get:function(){return this._accountId}},{key:"volume",set:function(t){this.player.setVolume(t)}},{key:"width",set:function(t){this.player.setWidth(t)}},{key:"height",set:function(t){this.player.setHeight(t)}},{key:"netWorkState",get:function(){return this.player.getNetworkState()}}]),t}()),L=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"control-box"},[e("div",{staticClass:"auto-box",staticStyle:{display:"flex"}},[e("div",{staticClass:"mode-item fl"},[t.isPlay?e("i",{staticClass:"iconfont icon-zanting_icon",attrs:{title:"播放"},on:{click:function(i){t.playEvent(!1)}}}):e("i",{staticClass:"iconfont icon-bofang_icon",attrs:{title:"暂停"},on:{click:function(i){t.playEvent(!0)}}})]),t._v(" "),e("div",{staticClass:"mode-item time-box"},[e("span",[t._v(t._s(t.currentDate))]),t._v(" "),e("span",[t._v("/"+t._s(t.allDate))])]),t._v(" "),e("div",{staticClass:"mode-item",staticStyle:{flex:"1"}},[e("div",{staticClass:"progress-box"},[e("el-slider",{attrs:{"format-tooltip":t.formatTooltip},on:{change:t.changeVal},model:{value:t.progress,callback:function(i){t.progress=i},expression:"progress"}})],1)]),t._v(" "),e("div",{staticClass:"mode-item fr",on:{mouseover:function(i){return i.stopPropagation(),t.overEvent(i)},mouseout:function(i){return i.stopPropagation(),t.outEvent(i)}}},[e("span",{staticClass:"quality-info"},[t._v("画质")]),t._v(" "),e("transition",{attrs:{name:"fade"}},[t.showQualityBlock?e("div",{staticClass:"qualitys-box"},t._l(t.qualitys,function(i,n){return e("span",{class:{"quality-item":!0,active:t.selectQuality==n},on:{click:function(i){t.selectQuality=n}}},[t._v(t._s(i))])})):t._e()])],1),t._v(" "),e("div",{staticClass:"mode-item fr"},[e("i",{staticClass:"iconfont icon-zuidahua_icon",on:{click:t.fullScreeEvent}})])])])};L._withStripped=!0;var M="mute",O="play",E="volumeSize",A="fullBrowser",N="progress",$={mute:"声音控制",play:"播放控制",volumeSize:"声音大小",fullScree:"全屏控制",selectQuality:"画质量",fullBrowser:"浏览器-全屏",progress:"播放进度"},V={name:"control",data:function(){return{mute:!1,isPlay:!0,volumeSize:100,fullScree:!1,isFullBrowser:!1,showQualityBlock:!1,selectQuality:0,current:0,progress:0}},computed:{allDate:function(){return this.formatDate(this.totalTime)},currentDate:function(){return this.formatDate(this.currentTime)},rate:function(){return parseInt(100*this.currentTime/this.totalTime)}},props:{currentTime:{type:Number,default:0},totalTime:{type:Number,default:1e3},qualitys:{type:Array,default:["same"]}},watch:{currentTime:{handler:function(t){this.current=t},immediate:!0},rate:{handler:function(t){this.progress=t},immediate:!0},volumeSize:function(t){this.changeControl(E,t)}},methods:{changeControl:function(t,i){this.$emit("control",{type:t,value:i,msg:$[t]})},formatTooltip:function(t){return t+"%"},changeVal:function(){this.changeControl(N,this.progress)},muteEvent:function(){this.mute=!this.mute,this.changeControl(M,this.mute)},overEvent:function(){this.showQualityBlock=!0},outEvent:function(){this.showQualityBlock=!1},playEvent:function(t){this.isPlay=t,this.changeControl(O,this.isPlay)},fullScreeEvent:function(){alert("请把手机横评放置")},fullBrowser:function(){this.isFullBrowser=!this.isFullBrowser,this.changeControl(A,this.isFullBrowser)},formatDate:function(t){var i=(t/3600>>0)+"",e=((t/60%60>>0)+"").padStart(2,0),n=((t%60>>0)+"").padStart(2,0);return i>0?i+":"+e+":"+n:e+":"+n}}},j=(e(284),e(1)),H=Object(j.a)(V,L,[],!1,null,"a65f7196",null);H.options.__file="src/pages/watch/video/control.vue";var D=H.exports,U=e(3),J=e(223),z={name:"index",components:{VideoControl:D},data:function(){return{playComps:{},playBtnShow:!1,imageUrl:"",recordId:"",outLineLink:"",playBoxId:"play-vides-"+Math.random(),sdkPlayParam:{appId:"",accountId:"",token:""},currentTime:0,totalTime:1e4,stInterval:"",isPlay:!1,isAutoPlay:!1,controlPsoition:"1.333vw",qualitys:[]}},props:{role:{type:String,default:"watcher"},playType:{type:String,required:!0,default:""},startInit:{type:Boolean,required:!0,default:!1},paasParams:{appId:"",roomId:"",inavId:"",token:"",accountId:""}},computed:v()({},Object(p.c)("liveMager",{liveDevices:function(t){return t.liveDevices},roomPaas:function(t){return t.roomPaas},activityInfo:function(t){return t.activityInfo}}),{imageSrc:function(){return this.imageUrl?this.$imgHost+"/"+this.imageUrl:"//cnstatic01.e.vhall.com/static/img/v35-webinar.png"}}),mounted:function(){var t=this;window.addEventListener("onorientationchange"in window?"orientationchange":"resize",function(){90===window.orientation||-90===window.orientation?(t.$emit("orientationchange","horizontalScreen"),t.horizontalScreen()):(t.herticalScreen(),t.$emit("orientationchange","herticalScreen"))},!1)},watch:{startInit:function(t){t||this.stopPlay()},playType:{handler:function(){this.changePlayType()}},liveDevices:function(){this.changeLiveDevice()}},beforeDestroy:function(){console.log("--video-com--beforeDestroy"),clearInterval(this.setIntervalHandler),window.hostPusher&&window.hostPusher.destroy(),window.playComps&&window.playComps.destroy(),window.VhallPlayer&&window.VhallPlayer.destroy()},methods:v()({},Object(p.b)("liveMager",{storeRoomPaas:U.h}),{initComponent:function(){"live"===this.playType?this.initLivePlay():"pre"===this.playType?this.imageUrl=this.activityInfo.imgUrl:"warm"===this.playType?this.queryWarmInfo():"vod"===this.playType?this.initPlayBack():"end"===this.playType&&this.playEnd()},changePlayType:function(){this.startInit&&-1!=="live|warm|vod|end|pre".indexOf(this.playType)&&(this.isAutoPlay=!1,this.destoryComs(),this.initComponent())},playEnd:function(){},playVideo:function(){"warm"===this.playType&&this.playBackVideo()},startPlay:function(){this.isPlay=!this.isPlay,window.VhallPlayer.play(),this.dealWithVideo()},changeLiveDevice:function(){window.hostPusher&&window.hostPusher.changeSetting({video:{deviceId:this.liveDevices.camera},audio:{deviceId:this.liveDevices.mic},conf:{videoSize:[800,450,800,450]}})},initLivePlay:function(){"watcher"===this.role&&this.initPuller()},initPlayBack:function(){var t=this;this.$config({handlers:!0}).$get(J.a.GET_DEFAULEREPLAY,{activityId:this.$route.params.id}).then(function(i){i.data&&(t.imageUrl=i.data.cover,"LINK"===i.data.replay.type?t.outLineLink=i.data.replay.link:"VIDEO"!==i.data.replay.type&&"SLICE"!==i.data.replay.type||(t.recordId=i.data.replay.video,t.totalTime=i.data.replay.duration,t.playBackVideo()))}).catch(function(){})},playBackVideo:function(){var t=this;this.$nextTick(function(){if(t.recordId){var i={};!!navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)||(i={"x5-video-player-type":"h5","x5-video-orientation":"portrait","x5-video-player-fullscreen":!1}),window.Vhall.ready(function(){window.VhallPlayer.init({recordId:t.recordId,type:"vod",videoNode:t.playBoxId,videoAttr:i,complete:function(){t.playBtnShow=!1,t.qualitys=window.VhallPlayer.getQualitys(),document.getElementsByClassName("vjs-tech")[0].addEventListener("x5videoexitfullscreen",function(){document.getElementsByClassName("icon-zanting_icon")[0].click()}),document.getElementsByClassName("vjs-tech")[0].style["object-position"]="0px 10.667vw"}})}),window.Vhall.config({appId:t.roomPaas.appId,accountId:t.roomPaas.accountId,token:t.roomPaas.token})}})},dealWithVideo:function(){var t=this;clearInterval(this.setIntervalHandler),this.setIntervalHandler=setInterval(function(){t.currentTime=window.VhallPlayer.getCurrentTime(),t.totalTime<=t.currentTime&&(clearInterval(t.setIntervalHandler),t.isAutoPlay?(window.VhallPlayer.play(),t.dealWithVideo()):(t.isPlay=!1,window.VhallPlayer&&window.VhallPlayer.destroy()))},1e3)},queryWarmInfo:function(){var t=this.activityInfo.warm;this.imageUrl=t.imgUrl,this.playBtnShow=!0,this.filename=t.filename,this.recordId=t.recordId,this.isAutoPlay="AUTO"===t.playType,this.isPlayState=this.isAutoPlay,this.totalTime=parseInt(t.record.duration),this.playBackVideo()},initPuller:function(){var t=this;window.playComps&&window.playComps.destroy(),this.$nextTick(function(){t.playComps=new B(t.roomPaas.appId,t.roomPaas.liveRoom,t.playBoxId,t.roomPaas.token),t.playComps.initLivePlayer(!0,!0,function(){document.getElementsByClassName("vjs-tech")[0].style["object-position"]="0px 10.667vw",document.getElementsByClassName("vjs-tech")[0].addEventListener("x5videoexitfullscreen",function(){document.getElementsByClassName("icon-zanting_icon")[0].click()}),console.log("----------开始播放----------")}),t.playComps.accountId=t.roomPaas.accountId})},pullBroadCast:function(){var t=this;this.hostPusher.stopBroadCast().then(function(){t.hostPusher.startBroadCast().then(function(){console.log("----------旁路推流成功----------")}).catch(function(i){console.error("旁路推流失败:"+i);var e=setTimeout(function(){clearTimeout(e),t.pullBroadCast()},500)})}).catch(function(t){console.error("停止旁路推流失败:"+t)})},stopPlay:function(){"live"===this.playType&&window.hostPusher.stop()},showVideo:function(t){this.isShowVideo=t,"live"===this.playType?"master"===this.role?window.hostPusher.showVideo(t):"watcher"===this.role&&window.playComps.showVideo(t):"warm"===this.playType||this.playType},mutoAuto:function(t){this.isMutoAuto=t,"live"===this.playType?"master"===this.role?window.hostPusher.mute(t):"watcher"===this.role&&(window.playComps.volume=t?0:50):"warm"===this.playType||this.playType},formatTooltip:function(t){return t/1e4},formatTime:function(t){var i={hour:"",min:"",sed:""};return i.hour=((t/3600%24>>0)+"").padStart(2,0),i.min=((t/60%60>>0)+"").padStart(2,0),i.sed=((t%60>>0)+"").padStart(2,0),i.hour+":"+i.min+":"+i.sed},fullScreen:function(){alert("请把手机横评放置")},horizontalScreen:function(){this.isShowCover=!1,this.height="100%",this.controlPsoition="9.333vw"},herticalScreen:function(){this.isShowCover=!0,this.height="56.267vw",this.controlPsoition="1.333vw"},start:function(){this.isStart=!0,this.puller.play()},play:function(t){"warm"!==this.playType&&"vod"!==this.playType||(t?window.VhallPlayer.play():window.VhallPlayer.pause())},playControl:function(t){var i=t.type;"progress"===i?this.seekProgress(t.value):"play"===i?this.play(t.value):"mute"===i?this.mutoAuto(t.value):"volumeSize"===i?this.changeVolume(t.value):"selectQuality"===i?window.VhallPlayer.setQuality(t.value):"fullScree"===i?this.fullScree(t.value):"fullBrowser"===i&&this.$emit("fullBrowser",t.value)},seekProgress:function(t){window.VhallPlayer&&window.VhallPlayer.seek(this.totalTime*t/100)},destoryComs:function(){clearInterval(this.setIntervalHandler),window.hostPusher&&window.hostPusher.destroy(),window.playComps&&window.playComps.destroy(),window.VhallPlayer&&window.VhallPlayer.destroy()}})},F=(e(286),Object(j.a)(z,m,[],!1,null,"2bb9b82a",null));F.options.__file="src/pages/watch/video/index.vue";var G=F.exports,W=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"chat-wrap",on:{click:t.boxClick}},[e("div",{ref:"bscroll",staticClass:"bscroll",class:"live"!==t.type?"vod":"live",on:{mouseover:function(i){t.stopScroll=!0},mouseout:function(i){t.stopScroll=!1}}},[e("ol",{staticClass:"chat-list bscroll-container"},t._l(t.chatData,function(i,n){return e("li",{class:{right:1*t.joinInfo.activityUserId==1*i.id},attrs:{"data-joinId":i.id}},[e("dl",{staticClass:"clearfix"},[""!==i.avatar?e("dt",[e("img",{attrs:{src:t.imgHost+"/"+i.avatar}})]):e("dt",{staticClass:"avatar"},[t._v(t._s(i.name.substr(0,1)))]),t._v(" "),e("dd",[e("div",{staticClass:"name"},[t._v(t._s(i.name)+"\n              "),i.detail.role?e("em",[t._v(t._s(i.detail.role))]):t._e()]),t._v(" "),e("div",{staticClass:"txt",domProps:{innerHTML:t._s(i.detail.txt)}})])])])})),t._v(" "),t.tipsShow&&t.tipsCount>0?e("transition",[e("span",{staticClass:"msg-tips",on:{click:t.scrollBtm}},[t._v("有"+t._s(t.tipsCount)+"条新消息\n        "),e("i",{staticClass:"iconfont icon-xiangxia"})])]):t._e(),t._v(" "),e("transition",{attrs:{name:"left-right",mode:"out-in"}},[t.announceShow?e("div",{staticClass:"announce-box"},[e("svg",{staticClass:"icon",staticStyle:{width:"6.667vw",height:"6.667vw","vertical-align":"middle",fill:"currentColor",overflow:"hidden"},attrs:{viewBox:"0 0 1305 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"3285"}},[e("path",{attrs:{d:"M236.3648 689.6384a102.4 102.4 0 0 1 144.6144 7.5776l119.9104 133.1712a102.4 102.4 0 1 1-152.2176 137.0368l-119.9104-133.1712a102.4 102.4 0 0 1 7.6032-144.64z",fill:"#222222","p-id":"3286"}}),t._v(" "),e("path",{attrs:{d:"M277.4528 734.4384a25.6 25.6 0 0 0-1.8944 36.1472l119.9104 133.1968a25.6 25.6 0 0 0 38.0672-34.2784l-119.9104-133.1712a25.6 25.6 0 0 0-36.1728-1.8944z",fill:"#FFD021","p-id":"3287"}}),t._v(" "),e("path",{attrs:{d:"M144.5888 482.4832l47.2064-12.416a464.8448 464.8448 0 0 0 278.3744-207.104l72.832-119.1168c-15.3088 169.7024-7.9104 291.7888 22.1696 366.208 30.08 74.4704 107.52 162.304 232.2944 263.6032l-138.3168-37.7088a456.064 456.064 0 0 0-342.9376 42.1376l-42.5472 23.8336a173.6704 173.6704 0 0 1-245.9392-86.4256 173.6704 173.6704 0 0 1 116.864-233.0112z",fill:"#222222","p-id":"3288"}}),t._v(" "),e("path",{attrs:{d:"M211.328 544.3328l-47.2064 12.4416a96.8448 96.8448 0 0 0-59.904 141.056 96.8704 96.8704 0 0 0 131.8656 37.12l42.5472-23.8336a532.8384 532.8384 0 0 1 389.632-52.1472L528.896 313.9328a541.7728 541.7728 0 0 1-317.5424 230.4z",fill:"#FFD021","p-id":"3289"}}),t._v(" "),e("path",{attrs:{d:"M819.5072 795.9552c-94.4896 38.1696-217.088-93.1072-293.3248-281.856-76.2624-188.7232-79.2832-368.3072 15.2064-406.5024 94.5152-38.144 217.088 93.1328 293.3504 281.856 76.2368 188.7232 79.2576 368.3072-15.232 406.5024z",fill:"#222222","p-id":"3290"}}),t._v(" "),e("path",{attrs:{d:"M790.7328 724.736c12.9792-5.248 24.2944-35.7888 23.424-88.0384-1.024-61.3888-18.7904-139.6736-50.6368-218.496s-73.472-147.456-115.3536-192.3072c-35.6608-38.1952-65.024-52.3264-78.0032-47.104s-24.2688 35.8144-23.3984 88.064c1.024 61.3888 18.7648 139.6736 50.6112 218.496s73.472 147.456 115.3792 192.3328c35.6608 38.1696 65.024 52.3008 77.9776 47.0528z",fill:"#FFD021","p-id":"3291"}}),t._v(" "),e("path",{attrs:{d:"M668.8256 525.4912a76.8 76.8 0 1 1-57.5488-142.3872 76.8 76.8 0 0 1 57.5488 142.3872zM840.9088 233.2928a38.4 38.4 0 1 1-50.176-58.1376l172.544-148.8896a38.4 38.4 0 1 1 50.1504 58.1376l-172.544 148.8896zM951.04 575.1552a38.4 38.4 0 0 1-3.712-76.7232l256.9472-12.3648a38.4 38.4 0 0 1 3.6864 76.7232l-256.9472 12.3648zM902.4 407.9872a38.4 38.4 0 1 1-31.9488-69.8368l370.0736-169.344a38.4 38.4 0 1 1 31.9488 69.8368L902.4 407.9872zM201.3696 637.8496a25.6 25.6 0 1 1-12.1856-49.7152c14.08-3.456 24.576-6.144 31.488-8.0128a25.6 25.6 0 1 1 13.5936 49.3312c-7.4752 2.0736-18.4064 4.864-32.896 8.3968z m111.1552-35.4048a25.6 25.6 0 1 1-20.864-46.7712c40.2688-17.9712 84.7872-42.5216 133.4272-73.6256a25.6 25.6 0 1 1 27.5712 43.136c-50.688 32.4096-97.3568 58.1632-140.1344 77.2608z",fill:"#222222","p-id":"3292"}})]),t._v(" "),e("div",{staticClass:"txt-box"},[e("p",{staticClass:"txt"},[t._v(t._s(t.receiveAnnounce))])]),t._v(" "),e("i",{staticClass:"iconfont icon-close",on:{click:function(i){t.announceShow=!1}}})]):t._e()])],1),t._v(" "),"live"===t.type&&t.isLogin&&t.sendBoxShow?e("div",{staticClass:"v-send-box-bg"},[e("div",{staticClass:"send-box clearfix",attrs:{id:"sendBox"}},[e("div",{staticClass:"top"},[e("span",{staticClass:"cancel-btn fl",on:{click:t.cancelClick}},[t._v("取消")]),t._v(" "),e("span",{staticClass:"v-title"},[t._v("\n          聊天\n        ")]),t._v(" "),(t.mute||t.allMuted)&&t.isWatch?[e("div",{staticClass:"mute-box"},[t._v(t._s(t.allMuted?"已开启全体禁言":"您已被禁言"))])]:[e("span",{staticClass:"send-btn fr",on:{click:t.sendAction}},[t._v("发送")])],t._v(" "),"HOST"!==t.joinInfo.roleName||t.isWatch?t._e():e("div",{staticClass:"fr"},[e("i",{staticClass:"icon-swap",attrs:{title:"切换发送聊天/公告"},on:{click:function(i){t.swapAnnounce?t.swapAnnounce=!1:t.swapAnnounce=!0}}}),t._v(" "),e("div",{staticClass:"switch-box"},[e("span",[t._v("全体禁言")]),t._v(" "),e("el-switch",{staticClass:"switch",attrs:{"inactive-color":"#DEE1FF",width:32,"active-color":"#FFD021"},on:{change:t.muteAll},model:{value:t.allMuted,callback:function(i){t.allMuted=i},expression:"allMuted"}})],1)])],2),t._v(" "),e("div",{staticClass:"bottom clearfix"},[t.swapAnnounce?[e("com-input",{staticClass:"inp",attrs:{value:t.value,placeholder:t.chatPlaceholder,"max-length":140,type:"textarea"},on:{"update:value":function(i){t.value=i}}})]:[e("com-input",{staticClass:"inp",attrs:{value:t.valueAnnounce,placeholder:t.announcePlaceholder,"max-length":140,type:"textarea"},on:{"update:value":function(i){t.valueAnnounce=i}}})],t._v(" "),e("div",{staticClass:"v-emoji"},[e("i",{staticClass:"iconfont icon-biaoqing",attrs:{title:"表情"},on:{click:function(i){return i.stopPropagation(),t.changeFace(i)}}}),t._v(" "),t.faceOpen?e("div",{staticClass:"face-box"},t._l(t.faceArr,function(i,n){return e("img",{key:n,attrs:{src:"//cnstatic01.e.vhall.com/static/img/arclist/Expression_"+(n+1)+"@2x.png"},on:{click:function(i){i.stopPropagation(),t.inFace(n)}}})})):t._e()])],2)])]):t._e()])};W._withStripped=!0;var R=e(29),K=e.n(R),q=e(104),Q=e.n(q),Y=Q()("msgHandler"),Z=Q()("dispatchHandler"),X=function(){function t(){if(I()(this,t),this._instance)throw new Error("ChatService is singlton");this._instance=this,this._activityId="",this.handlerMap={}}return _()(t,[{key:"init",value:function(t){var i=this;this.service||window.vhallChat||(window.Vhall.ready(function(){i.service=VhallChat({channelId:t.channelId}),window.vhallChat=i.service,i[Y](),console.log("初始化成功")}),window.Vhall.config({appId:t.appId,accountId:t.accountId,token:t.token}),console.log(h()(t)))}},{key:"sendChat",value:function(t){this.service.emit(t)}},{key:"sendCustomMsg",value:function(t,i){this.service.emitCustomMsg({type:t,body:i})}},{key:Y,value:function(){var t=this;console.log("[chat]listening..."),window.vhallChat.onCustomMsg(function(i){var e=JSON.parse(i),n=e.type,a=e.body;t[Z](n,a)}),window.vhallChat.on(function(i){t[Z]("chat",i)})}},{key:"regHandler",value:function(t,i){this.handlerMap[t]||(this.handlerMap[t]=[]);var e=this.handlerMap[t];e.includes(i)?console.log("重复注册消息"):e.push(i)}},{key:"unregHandler",value:function(t,i){if(this.handlerMap[t]){var e=this.handlerMap[t],n=e.indexOf(i);-1!==n&&e.splice(n,1)}}},{key:Z,value:function(t,i){var e=this.handlerMap[t];e&&0!==e.length&&e.forEach(function(t){t(i)})}},{key:"activityId",set:function(t){this._activityId=t},get:function(){return this._activityId}}],[{key:"OBJ",get:function(){return this._instance||(this._instance=new t),this._instance}}]),t}(),tt=e(221),it={name:"chat",data:function(){return{vhallParams:{token:"",appId:"",channelId:"",accountId:""},activityId:this.$route.params.id,value:"",valueAnnounce:"",receiveAnnounce:"",service:null,chatData:[],tipsShow:!1,announceShow:!1,faceOpen:!1,swapAnnounce:!0,mute:!1,allMuted:!1,tipsCount:0,timer:null,isLogin:!1,stopScroll:!1,chatPlaceholder:"输入想说的话…",announcePlaceholder:"请输入公告内容",aBScroll:null,imgHost:"http://dev-zhike.oss-cn-beijing.aliyuncs.com/",faceArr:[{"[微笑]":"1"},{"[撇嘴]":"2"},{"[色]":"3"},{"[发呆]":"4"},{"[得意]":"5"},{"[流泪]":"6"},{"[害羞]":"7"},{"[闭嘴]":"8"},{"[睡]":"9"},{"[哭]":"10"},{"[尴尬]":"11"},{"[发怒]":"12"},{"[调皮]":"13"},{"[呲牙]":"14"},{"[惊讶]":"15"},{"[难过]":"16"},{"[酷]":"17"},{"[汗]":"18"},{"[抓狂]":"19"},{"[吐]":"20"},{"[偷笑]":"21"},{"[愉快]":"22"},{"[白眼]":"23"},{"[傲慢]":"24"},{"[饥饿]":"25"},{"[困]":"26"},{"[惊恐]":"27"},{"[流汗]":"28"},{"[憨笑]":"29"},{"[悠闲]":"30"},{"[奋斗]":"31"},{"[咒骂]":"32"},{"[疑问]":"33"},{"[嘘]":"34"},{"[晕]":"35"},{"[疯了]":"36"},{"[衰]":"37"},{"[骷髅]":"38"},{"[敲打]":"39"},{"[再见]":"40"},{"[擦汗]":"41"},{"[抠鼻]":"42"},{"[鼓掌]":"43"},{"[糗大了]":"44"},{"[坏笑]":"45"},{"[左哼哼]":"46"},{"[右哼哼]":"47"},{"[哈欠]":"48"},{"[鄙视]":"49"},{"[委屈]":"50"},{"[快哭了]":"51"},{"[阴险]":"52"},{"[亲亲]":"53"},{"[吓]":"54"},{"[可怜]":"55"},{"[菜刀]":"56"},{"[西瓜]":"57"},{"[啤酒]":"58"},{"[篮球]":"59"},{"[乒乓]":"60"},{"[咖啡]":"61"},{"[饭]":"62"},{"[猪头]":"63"},{"[玫瑰]":"64"},{"[凋谢]":"65"},{"[嘴唇]":"66"},{"[爱心]":"67"},{"[心碎]":"68"},{"[蛋糕]":"69"},{"[闪电]":"70"},{"[炸弹]":"71"},{"[刀]":"72"},{"[足球]":"73"},{"[瓢虫]":"74"},{"[便便]":"75"},{"[月亮]":"76"},{"[太阳]":"77"},{"[礼物]":"78"},{"[拥抱]":"79"},{"[强]":"80"},{"[弱]":"81"},{"[握手]":"82"},{"[胜利]":"83"},{"[抱拳]":"84"},{"[勾引]":"85"},{"[拳头]":"86"},{"[差劲]":"87"},{"[爱你]":"88"},{"[NO]":"89"},{"[OK]":"90"}]}},props:{type:{type:String,default:"live"},isWatch:{type:Boolean,default:!1},sendBoxShow:{type:Boolean,default:!1}},computed:v()({},Object(p.c)("liveMager",{roomPaas:function(t){return t.roomPaas},activityInfo:function(t){return t.activityInfo},joinInfo:function(t){return t.joinInfo}}),Object(p.c)("tokenMager",{chatParams:function(t){return t.chatParams}}),Object(p.c)("login",{loginInfo:function(t){return t.loginInfo}})),mounted:function(){this.isWatch||(this.isLogin=!0)},methods:v()({},Object(p.b)("tokenMager",{setChatParams:U.b}),Object(p.b)("liveMager",{storeJoinInfo:U.d}),{initSdk:function(){var t={channelId:this.roomPaas.channelRoom};K()(this.roomPaas,t),X.OBJ.init(this.roomPaas),X.OBJ.regHandler("chat",this.listenChat),X.OBJ.regHandler("ANNOUNCEMENT",this.listenAnnounce),X.OBJ.regHandler("KICK",this.listenKick),X.OBJ.regHandler("DISABLE_KICK",this.listenCancelkick),X.OBJ.regHandler("GAG",this.listenMute),X.OBJ.regHandler("DISABLE_GAG",this.listenCancelmute),X.OBJ.regHandler("GAG_ALL",this.listenAllmute),X.OBJ.regHandler("DISABLE_GAG_ALL",this.listenCancelallmute)},changeFace:function(){this.faceOpen=!this.faceOpen},sendAction:function(){if(!this.value.replace(/\n/g,"").length)return this.chatPlaceholder="聊天内容不能为空",!1;var t="HOST"===this.joinInfo.roleName?"主持人":"";X.OBJ.activityId=this.activityId;var i={role:t,txt:this.value};X.OBJ.sendChat(h()(i)),this.value="",this.chatPlaceholder="输入想说的话…",this.faceOpen=!1,this.$emit("closeChatBox",!0)},listenChat:function(t){console.log("接收 聊天消息",t),this.reArrange(t),this.tipsShow&&this.tipsCount++},listenAnnounce:function(t){console.log("接收 公告消息",t),this.announceShow=!0,this.receiveAnnounce=t.content;var i=this;clearTimeout(i.timer),i.timer=setTimeout(function(){i.announceShow=!1,this.receiveAnnounce="",clearTimeout(i.timer)},15e3)},listenKick:function(t){console.log("接收 踢出消息",t),this.refreshList(t.activityUserId,"isKick","Y"),this.isSelf(t.activityUserId)&&this.$router.push({path:"/kicked"})},listenCancelkick:function(t){console.log("接收 取消踢出消息"+t),this.refreshList(t.activityUserId,"isKick","N")},listenMute:function(t){console.log("接收 禁言消息",t),this.refreshList(t.activityUserId,"isGag","Y"),this.isSelf(t.activityUserId)&&(this.mute=!0)},listenCancelmute:function(t){this.refreshList(t.activityUserId,"isGag","N"),console.log("接收 取消禁言消息",t),this.isSelf(t.activityUserId)&&(this.mute=!1)},listenAllmute:function(t){console.log("接收 全体禁言消息",t),this.allMuted=!0},listenCancelallmute:function(t){console.log("接收 取消全体禁言消息",t),this.allMuted=!1},isSelf:function(t){return this.joinInfo.activityUserId===t},refreshList:function(t,i,e){this.chatData.forEach(function(n){1*n.id==1*t&&(n[i]=e)})},reArrange:function(t){var i={};if(i.id=t.third_party_user_id,i.avatar=t.avatar,i.name=t.nick_name,i.isGag=t.isGag,i.isKick=t.isKick,i.detail=JSON.parse(t.data),this.faceArr.forEach(function(t,e){for(var n in t){var a=n.replace(/\[/,"\\[").replace(/\]/,"\\]"),o=new RegExp(a,"g");i.detail.txt=i.detail.txt.replace(o,"<img src='//cnstatic01.e.vhall.com/static/img/arclist/Expression_"+t[n]+"@2x.png'>")}}),this.chatData.push(i),!this.tipsShow&&!this.stopScroll){var e=this;setTimeout(function(){e.scrollBtm()},200)}this.stopScroll&&(this.tipsShow=!0)},sendAnnounce:function(){var t=this;if(!this.valueAnnounce.replace(/\n/g,"").length)return this.announcePlaceholder="公告内容不能为空",!1;var i={activityId:this.activityId,message:this.valueAnnounce};this.$get(J.a.GET_SENDANNOUNCEMENT,i).then(function(i){t.$toast({content:"公告发送成功"}),t.valueAnnounce="",t.announcePlaceholder="请输入公告内容",t.$emit("closeChatBox",!0)})},cancelClick:function(){this.$emit("closeChatBox",!0)},scrollBtm:function(){var t=this;this.aBScroll.scrollTo(0,this.aBScroll.maxScrollY,500,"bounce"),setTimeout(function(){t.tipsCount=0},500)},inFace:function(t){for(var i in this.faceArr[t])this.value+=i},boxClick:function(t){"icon-emoji"!==t.target.className&&(this.faceOpen=!1)},getHistroy:function(){var t=this;this.$get(J.a.GET_MESSAGELIST,{activityId:this.activityId}).then(function(i){i.data.reverse().forEach(function(i){t.reArrange(i)})})},muteAll:function(){var t=this,i={activityId:this.activityId,cancel:this.allMuted?"N":"Y"};this.$post(J.a.POST_GAGALL,i).then(function(e){t.$toast({content:"Y"===i.cancel?"已取消全体禁言":"已开启全体禁言"})})},initToken:function(){if(this.isWatch)return this.roomPaas},initScroll:function(){var t=this;this.$nextTick(function(){var i=t.$refs.bscroll;t.aBScroll=new tt.a(i,{scrollbar:!0,click:!0,mouseWheel:!0,"probeType ":3}),t.aBScroll.on("scrollEnd",function(i){var e=document.getElementsByClassName("chat-list")[0].offsetHeight;.5*e>document.getElementsByClassName("bscroll")[0].offsetHeight&&.5*e>-1*i.y?t.tipsShow=!0:t.tipsShow=!1})})},initInfo:function(){var t=this;return l()(c.a.mark(function i(){return c.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:t.initSdk();case 1:case"end":return i.stop()}},i,t)}))()},loginHandler:function(){this.$emit("showLogin")}}),watch:{"loginInfo.consumerUserId":{handler:function(t){t&&this.isWatch&&(this.isLogin=!0)},deep:!0,immediate:!0},allMuted:{handler:function(t){t?this.$emit("isMute",{isMute:!0,type:"allMuted"}):this.$emit("isMute",{isMute:!1,type:"allMuted"})},deep:!0},mute:{handler:function(t){t?this.$emit("isMute",{isMute:!0,type:"mute"}):this.$emit("isMute",{isMute:!1,type:"mute"})},deep:!0},activityInfo:{handler:function(t){"Y"===t.setting.gag?this.allMuted=!0:this.allMuted=!1},deep:!0},"roomPaas.channelId":{handler:function(t){t&&(console.log(t),this.initInfo())},immediate:!0,deep:!0},"joinInfo.isGag":{handler:function(t){"Y"===t&&this.isWatch&&(this.mute=!0)},deep:!0,immediate:!0},"joinInfo.isKick":{handler:function(t){"Y"===t&&this.isWatch&&this.$router.push({path:"/kicked"})},deep:!0,immediate:!0}}},et=(e(288),Object(j.a)(it,W,[],!1,null,"3a2ec7eb",null));et.options.__file="src/components/chat/index.vue";var nt=et.exports,at=e(224),ot=e(225),st={props:{domShow:Boolean},mixins:[at.a],components:{PlayVideo:G,Chating:nt},data:function(){return{playType:"",startInit:!1,tabValue:1,isWatch:!0,chatListInit:!1,sendBoxShow:!1,isLogin:!1,isMuteShow:!1,allMuted:!1}},computed:v()({},Object(p.c)("liveMager",{activityInfo:function(t){return t.activityInfo},roomPaas:function(t){return t.roomPaas},joinInfo:function(t){return t.joinInfo}}),Object(p.c)("login",{loginInfo:function(t){return t.loginInfo}})),mounted:function(){this.storeLoginInfo(this.getLoginInfo()),this.playType="vod",this.startInit=!0},created:function(){this.initToken()},watch:{"loginInfo.consumerUserId":{handler:function(t){t&&this.isWatch&&(this.isLogin=!0)},deep:!0},activityInfo:{}},methods:v()({},Object(p.b)("login",{storeLoginInfo:U.g}),Object(p.b)("liveMager",{storeActivityInfo:U.a,storeJoinInfo:U.d}),{tabChange:function(){if(2===this.tabValue&&(this.$refs.chatbox.aBScroll||(this.$refs.chatbox.initScroll(),this.$refs.chatbox.getHistroy()),!this.$refs.chatbox.tipsShow)){var t=this;setTimeout(function(){t.$refs.chatbox.scrollBtm()},200)}},initToken:function(){var t=this;this.$nextTick(function(){t.startInit=!0})},initMsgServe:function(){var t=this;X.OBJ.init({accountId:this.roomPaas.accountId,token:this.roomPaas.token,appId:this.roomPaas.appId,channelId:this.roomPaas.channelRoom}),X.OBJ.regHandler(ot.a.onLineNum,function(i){var e=JSON.parse(h()(t.liveInfo));e.showOnlineNum=parseInt(e.setting.initOnlineNum)+parseInt(i.num),t.storeLiveInfo(e)}),X.OBJ.regHandler(ot.a.beginLive,function(i){t.playType="live";var e=JSON.parse(h()(t.activityInfo));e.status="LIVING",e.statusName="直播中",t.storeActivityInfo(e)}),X.OBJ.regHandler(ot.a.endLive,function(i){t.playType="end";var e=JSON.parse(h()(t.activityInfo));e.status="FINISH",e.statusName="结束",t.storeActivityInfo(e)})},isMute:function(t){this.isMuteShow=t.isMute,this.allMuted="allMuted"===t.type},chatClick:function(){this.sendBoxShow=!0},closeChatBox:function(){this.sendBoxShow=!1},loginSuccess:function(t){this.storeLoginInfo(t),this.isLogin=!0,this.$router.go(0)},loginHandler:function(){this.$emit("showLogin")}})},ct=(e(290),Object(j.a)(st,f,[],!1,null,"3304695f",null));ct.options.__file="src/pages/watch/playback.vue";var rt=ct.exports,lt=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"v-video-box"},[e("div",{staticClass:"v-video"},[e("play-video",{attrs:{role:"watcher","play-type":t.playType,startInit:t.startInit}})],1),t._v(" "),t.domShow?e("div",{staticClass:"v-function-box"},[e("div",{staticClass:"v-nav"},[e("com-tabs",{attrs:{value:t.tabValue},on:{"update:value":function(i){t.tabValue=i},change:t.tabChange}},[e("com-tab",{attrs:{label:"活动简介",index:1}},[e("div",{staticClass:"v-introduction",domProps:{innerHTML:t._s(t.activityInfo.description)}})]),t._v(" "),e("com-tab",{attrs:{label:"互动聊天",index:2}},[e("div",{staticClass:"chat-content"},[e("chating",{ref:"chatbox",attrs:{type:t.playType,isWatch:t.isWatch,sendBoxShow:t.sendBoxShow},on:{closeChatBox:t.closeChatBox,isMute:function(i){t.isMute(i)}}})],1),t._v(" "),"live"===t.playType&&t.isLogin?[t.isMuteShow?[e("div",{staticClass:"v-chat-control v-noLogin",attrs:{id:"sendBoxBtn"}},[t._v("\n                "+t._s(t.allMuted?"已开启全体禁言":"您已被禁言")+"\n              ")])]:[e("div",{staticClass:"v-chat-control",attrs:{id:"sendBoxBtn"},on:{click:function(i){t.chatClick()}}},[e("i",{staticClass:"iconfont icon-biaoqing"}),t._v(" "),e("span",{staticClass:"v-chat-clickbox"},[t._v("\n                  输入文字聊天\n                ")])])]]:"live"!==t.playType||t.isLogin?t._e():[e("div",{staticClass:"v-chat-control v-noLogin",attrs:{id:"sendBoxBtn"}},[t._v("\n              需要登录才能参与聊天\n              "),e("span",{on:{click:t.doLogin}},[t._v("登录")])])]],2)],1)],1)]):t._e(),t._v(" "),e("com-login",{on:{login:t.loginSuccess}})],1)};lt._withStripped=!0;var ut={props:{domShow:Boolean},mixins:[at.a],components:{PlayVideo:G,Chating:nt},data:function(){return{playType:"",startInit:!1,tabValue:1,isWatch:!0,chatListInit:!1,sendBoxShow:!1,isLogin:!1,isMuteShow:!1,allMuted:!1}},computed:v()({},Object(p.c)("liveMager",{activityInfo:function(t){return t.activityInfo},roomPaas:function(t){return t.roomPaas},joinInfo:function(t){return t.joinInfo}}),Object(p.c)("login",{loginInfo:function(t){return t.loginInfo}})),mounted:function(){this.storeLoginInfo(this.getLoginInfo()),"PREPARE"===this.activityInfo.status?this.activityInfo.warm&&"Y"===this.activityInfo.warm.enabled&&this.activityInfo.warm.record&&this.activityInfo.warm.record.list.length>0&&1===this.activityInfo.warm.record.list[0].transcode_status?this.playType="warm":this.playType="pre":"FINISH"===this.activityInfo.status?this.playType="end":this.playType="live",this.startInit=!0,this.initMsgServe()},created:function(){this.initToken()},watch:{"loginInfo.consumerUserId":{handler:function(t){t&&this.isWatch&&(this.isLogin=!0)},deep:!0}},methods:v()({},Object(p.b)("login",{storeLoginInfo:U.g}),Object(p.b)("liveMager",{storeActivityInfo:U.a,storeJoinInfo:U.d}),{tabChange:function(){if(2===this.tabValue&&(this.$refs.chatbox.aBScroll||(this.$refs.chatbox.initScroll(),this.$refs.chatbox.getHistroy()),!this.$refs.chatbox.tipsShow)){var t=this;setTimeout(function(){t.$refs.chatbox.scrollBtm()},200)}},initToken:function(){var t=this;this.$nextTick(function(){t.startInit=!0})},initMsgServe:function(){var t=this;X.OBJ.init({accountId:this.roomPaas.accountId,token:this.roomPaas.token,appId:this.roomPaas.appId,channelId:this.roomPaas.channelRoom}),X.OBJ.regHandler(ot.a.onLineNum,function(i){var e=JSON.parse(h()(t.liveInfo));e.showOnlineNum=parseInt(e.setting.initOnlineNum)+parseInt(i.num),t.storeLiveInfo(e)}),X.OBJ.regHandler(ot.a.beginLive,function(i){t.playType="live";var e=JSON.parse(h()(t.activityInfo));console.log(e),e.status="LIVING",e.statusName="直播中",t.storeActivityInfo(e)}),X.OBJ.regHandler(ot.a.endLive,function(i){t.playType="end";var e=JSON.parse(h()(t.activityInfo));e.status="FINISH",e.statusName="结束",t.storeActivityInfo(e)})},isMute:function(t){this.isMuteShow=t.isMute,this.allMuted="allMuted"===t.type},chatClick:function(){this.sendBoxShow=!0},closeChatBox:function(){this.sendBoxShow=!1},loginSuccess:function(t){this.storeLoginInfo(t),this.isLogin=!0,this.$router.go(0)},loginHandler:function(){this.$emit("showLogin")}})},ht=(e(292),Object(j.a)(ut,lt,[],!1,null,"8c492ca0",null));ht.options.__file="src/pages/watch/live.vue";var dt=ht.exports,vt=function(){var t=this.$createElement;return(this._self._c||t)("div")};vt._withStripped=!0;var pt={name:"empty"},ft=Object(j.a)(pt,vt,[],!1,null,null,null);ft.options.__file="src/pages/watch/empty.vue";var mt=ft.exports,yt=e(226),gt=e(70),wt={PREPARE:"pre",LIVING:"live",FINISH:"end",PLAYBACK:"vod"},It={PREPARE:"预告",LIVING:"直播中",FINISH:"结束",PLAYBACK:"回放"},St={mixins:[at.a],data:function(){return{MOBILE_HOST:"//test-zhike.vhall.com/m/",activityId:"",companyName:"",playType:"",playStatus:"",imgUrl:"",currentView:mt,vhallParams:{token:"",appId:"",channelId:"",accountId:""},subscribeShow:!1,businessUserId:"",domShow:!0,autoClose:0,email:"",errorTips:"",successShow:!1,isShowSite:"",wxShare:{wxShareData:{appId:"",timestamp:"",nonceStr:"",signature:""},shareData:{title:"",shareDatadesc:"",shareDatalink:"",shareDataimgUrl:""},shareUser:{shareId:""}}}},mounted:function(){this.storeLoginInfo(this.getLoginInfo())},computed:v()({},Object(p.c)("liveMager",{activityInfo:function(t){return t.activityInfo},joinInfo:function(t){return t.joinInfo},roomPaas:function(t){return t.roomPaas}}),Object(p.c)("tokenMager",{chatParams:function(t){return t.chatParams}}),Object(p.c)("login",{loginInfo:function(t){return t.loginInfo}}),{showPersonCount:function(){return parseInt(this.activityInfo.setting.initOnlineNum?this.activityInfo.setting.initOnlineNum:0)+parseInt(this.activityInfo.onlineNum?this.activityInfo.onlineNum:0)},activityStatus:function(){return this.activityInfo.statusName},defaultImg:function(){return this.imgUrl?this.$imgHost+"/"+this.imgUrl:""}}),created:function(){var t=this.$route.params.id;t||this.$router.go(-1),this.activityId=t,this.initPage();var i=this;window.addEventListener("onorientationchange"in window?"orientationchange":"resize",function(){90===window.orientation||-90===window.orientation?(i.domShow=!1,document.getElementsByClassName("vjs-tech")[0].style["object-position"]="50% 50%",document.getElementsByClassName("control-box-div")[0].style.top="auto",document.getElementsByClassName("control-box-div")[0].style.bottom="0"):(i.domShow=!0,document.getElementsByClassName("control-box-div")[0].style.top="56.267vw",document.getElementsByClassName("control-box-div")[0].style.bottom="auto",document.getElementsByClassName("vjs-tech")[0].style["object-position"]="0px 10.667vw")},!1)},methods:v()({},Object(p.b)("tokenMager",{setChatParams:U.b}),Object(p.b)("liveMager",{storeActivityInfo:U.a,storeRoomPaas:U.h,storeJoinInfo:U.d}),Object(p.b)("login",{storeLoginInfo:U.g}),{subscribe:function(){this.loginInfo?this.loginInfo.email?this.sendSubScribe():this.subscribeShow=!0:this.doLogin()},emailFocus:function(){this.errorTips=""},sendSubScribe:function(){var t=this;this.$config({handlers:!0}).$post(J.a.POST_EMAILSUBSCRIBE,{businessUserId:this.activityInfo.userId,email:this.loginInfo.email?this.loginInfo.email:this.email}).then(function(i){t.autoClose=3,t.subscribeShow=!1,t.successShow=!0;var e=JSON.parse(h()(t.loginInfo));e.email=t.emailInput,t.updateLoginInfo(e),t.storeLoginInfo(e)}).catch(function(i){t.subscribeShow=!1,t.$messageBox({header:"提示",content:i.msg,confirmText:"确定",handleClick:function(t){"cancel"===t.action||t.action}})})},subscribeClick:function(t){if("cancel"===t.action)this.subscribeShow=!1;else if("confirm"===t.action){if(this.email&&!/^[A-Za-z\d]+([-_.][A-Za-z\d]+)*@([A-Za-z\d]+[-.])+[A-Za-z\d]{2,4}$/.test(this.email))return this.errorTips="邮箱格式不正确",!1;this.errorTips="",this.sendSubScribe()}},successClick:function(t){"cancel"===t.action?this.successShow=!1:"confirm"===t.action&&(this.successShow=!1)},initPage:function(){var t=this;return l()(c.a.mark(function i(){var e,n;return c.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,t.initRoomPaas();case 2:return t.isWx()&&t.share(),e=null,n=null,i.next=7,t.$config({handlers:!0}).$get(J.a.GET_LIVEINFO,{activityId:t.$route.params.id}).then(function(i){document.title=i.data.activity.title,t.companyName=i.data.businessUserInfo.company,t.imgUrl=i.data.businessUserInfo.avatar,e=v()({},e,i.data.activity),n=i.data.joinInfo,e.setting=i.data.setting,e.warm=i.data.warm,e.statusName=It[e.status],t.playType=wt[e.status],t.playStatus=It[e.status],t.businessUserId=i.data.activity.userId,"LIVING"===e.status?"APPOINT"!==e.viewCondition||n.isApplay||t.doAuth(t.MOBILE_HOST+"guide/"+t.$route.params.id):e.countDown<1800?"APPOINT"===e.viewCondition&&(n.isApplay||t.doAuth(t.MOBILE_HOST+"guide/"+t.$route.params.id)):t.doAuth(t.MOBILE_HOST+"guide/"+t.$route.params.id)}).catch(function(i){t.$messageBox({header:"提示",content:i.msg,confirmText:"确定",handleClick:function(t){"cancel"===t.action||t.action}})});case 7:return i.next=9,t.$config({handlers:!0}).$get(J.a.GET_ONLINENUM,{activityId:t.$route.params.id}).then(function(t){e.onlineNum=t.data.onlineNum});case 9:t.storeActivityInfo(e),"vod"===t.playType?t.currentView=rt:t.currentView=dt;case 11:case"end":return i.stop()}},i,t)}))()},initSdk:function(){},initRoomPaas:function(){var t=this,i=this.$route.query.shareid,e={activityId:this.activityId,__errHandler:!0};return i&&(e.shareId=i),new o.a(function(i,n){t.roomPaas.token&&i(t.roomPaas),t.$config({handlers:!0}).$get(gt.a.GET_USERREGACTIVITY,e).then(function(e){t.storeJoinInfo(e.data),t.$config({handlers:!0}).$get(J.a.GET_SDKTOKEN,{activityId:t.activityId,activityUserId:e.data.activityUserId}).then(function(e){e.data&&(i(e.data),t.storeRoomPaas(e.data))})}).catch(function(i){12004===i.code||11030===i.code?t.doAuth(t.MOBILE_HOST+"guide/"+t.$route.params.id):12031===i.code&&t.$router.replace("/kicked")})})},share:function(){var t=this;return l()(c.a.mark(function i(){var e;return c.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return e=window.location.href,i.next=3,t.$config({handlers:!0}).$get(J.a.GET_SHARESIGN,{url:e}).then(function(i){t.wxShare.wxShareData.appId=i.data.appId,t.wxShare.wxShareData.timestamp=i.data.timestamp,t.wxShare.wxShareData.nonceStr=i.data.nonceStr,t.wxShare.wxShareData.signature=i.data.signature});case 3:return i.next=5,t.$config({handlers:!0}).$get(J.a.GET_SHAREINFO,{route:"live_route",param:t.$route.params.id}).then(function(i){if(i.data){var n=e;t.joinInfo.activityUserId&&(n=t.joinInfo.activityUserId?n+"?shareId="+t.joinInfo.activityUserId:n),t.wxShare.shareData.shareDatalink=n,t.wxShare.shareData.title=i.data.title?i.data.title:"",t.wxShare.shareData.shareDatadesc=i.data.description?i.data.description:"",t.wxShare.shareData.shareDataimgUrl=i.data.imgUrl?"https:"+t.$imgHost+"/"+i.data.imgUrl:""}});case 5:Object(yt.a)(t.wxShare);case 6:case"end":return i.stop()}},i,t)}))()},loginSuccess:function(t){this.storeLoginInfo(t),this.$router.go(0)},isWx:function(){return!(-1===navigator.userAgent.toLowerCase().indexOf("micromessenger"))}})},_t=(e(294),Object(j.a)(St,n,[],!1,null,"3753a13b",null));_t.options.__file="src/pages/watch/watch.vue";i.default=_t.exports}}]);
//# sourceMappingURL=8.4c4fc899.js.map