(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{199:function(t,e,i){},240:function(t,e,i){"use strict";var s=i(199);i.n(s).a},291:function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"v-checkState"},[t.user.isDisabled?i("com-input",{attrs:{inputVal:t.user.phone,placeholder:"请输入手机号",maxLength:11,isDisabled:"disabled",errorMsg:t.phoneError},on:{"update:inputVal":function(e){t.$set(t.user,"phone",e)},"update:errorMsg":function(e){t.phoneError=e}}}):i("com-input",{attrs:{inputVal:t.user.phone,placeholder:"请输入手机号",maxLength:11,type:"mobile",errorMsg:t.phoneError},on:{"update:inputVal":function(e){t.$set(t.user,"phone",e)},"update:errorMsg":function(e){t.phoneError=e}}}),t._v(" "),t.user.isDisabled?t._e():i("com-verification-code",{attrs:{phone:t.user.phone,inputVal:t.code,code:t.code,isGetCode:t.isGetCode,placeholder:"输入验证码",maxLength:6,errorMsg:t.codeError,codeType:"CONSUMER_USER_LOGIN"},on:{"update:inputVal":function(e){t.code=e},"update:code":function(e){t.code=e},inputFocus:function(e){t.getCode(e)},"update:errorMsg":function(e){t.codeError=e}}}),t._v(" "),i("button",{staticClass:"primary-button",on:{click:t.submit}},[t._v("提交")])],1)};s._withStripped=!0;var o=i(11),r=i.n(o),a=i(221),n=i(222),c=i(182),h=i(58),d={mixins:[i(184).a],data:()=>({MOBILE_HOST:"//test-zhike.vhall.com/m/",code:"",isGetCode:!0,activity:{viewCondition:"",countDown:"",status:""},user:{phone:"",isApplay:!1,isOrder:!1,isDisabled:!1},codeError:"",phoneError:"",isClick:!0}),mounted(){},components:{"com-input":a.a,"com-verification-code":n.a},created(){this.getActivity();let t=JSON.parse(sessionStorage.getItem("login"));t&&(this.user.phone=t.mobile,this.user.phone&&(this.user.isDisabled=!0))},watch:{},methods:{getCode(t){this.code=t},subScribe(){let t={activityId:this.$route.params.id};this.$config({handlers:!0}).$post(c.a.POST_SUBSCRIBE,t).then(t=>{this.$router.replace("/guide/"+this.$route.params.id)}).catch(t=>{12001===t.code?this.$router.replace("/success/"+this.$route.params.id):(this.isClick=!1,this.$messageBox({header:"提示",content:t.msg,confirmText:"确定",handleClick:t=>{"cancel"===t.action||t.action}}))})},submit(){return!!this.isClick&&(this.verification(this.user.phone,"Y","mobile")?this.user.isDisabled||this.verification(this.code,"Y","code")?(this.isClick=!1,void(this.user.isOrder||this.user.isDisabled?this.subScribe():this.$config({handlers:!0}).$post(h.a.POST_MOBILELOGIN,{mobile:this.user.phone,code:this.code,wechatAuth:sessionStorage.getItem("wechatAuth")}).then(t=>{t.data?(sessionStorage.setItem("login",r()(t.data)),this.$config({handlers:!0}).$get(c.a.GET_LIVEINFO,{activityId:this.$route.params.id}).then(t=>{t.data.joinInfo.isOrder?this.$router.replace("/guide/"+this.$route.params.id):this.subScribe()}).catch(t=>{this.isClick=!0,this.$messageBox({header:"提示",content:t.msg,confirmText:"确定",handleClick:t=>{"cancel"===t.action||t.action}})})):(this.$messageBox({header:"提示",content:t.msg,confirmText:"确定",handleClick:t=>{"cancel"===t.action||t.action}}),sessionStorage.removeItem("login"),sessionStorage.removeItem("wechatAuth"))}).catch(t=>{10020===t.code?this.codeError="请输入正确验证码":12002===t.code?this.$router.replace("/Success/"+this.$route.params.id):this.$messageBox({header:"提示",content:t.msg,confirmText:"确定",handleClick:t=>{"cancel"===t.action||t.action}})}))):(this.codeError="请输入正确验证码",!1):(this.phoneError="请正确填写手机号",!1))},verification(t,e,i){let s=/^1[3|4|5|6|7|8|9][0-9]\d{8}$/,o=/^[A-Za-z\d]+([-_.][A-Za-z\d]+)*@([A-Za-z\d]+[-.])+[A-Za-z\d]{2,4}$/,r=/^[0-9]*$/,a=/^\d{6}$/;if("mobile"===i&&(t=""===this.user.phone?t:this.user.phone),"code"===i)return a.test(t);if(""===t){if("Y"===e)return!1}else switch(i){case"mobile":return t=""===this.user.phone?t:this.user.phone,s.test(t);case"integer":return r.test(t);case"email":return o.test(t)}return!0},getActivity(){this.$config({handlers:!0}).$get(c.a.GET_LIVEINFO,{activityId:this.$route.params.id}).then(t=>{this.activity.viewCondition=t.data.activity.viewCondition,this.activity.status=t.data.activity.status,this.user.isApplay=t.data.joinInfo.isApplay,this.user.isOrder=t.data.joinInfo.isOrder,this.activity.countDown<1800&&(this.user.isApplay&&"APPOINT"===this.activity.viewCondition?this.doAuth(this.MOBILE_HOST+"watch/"+this.$route.params.id):"NONE"===this.activity.viewCondition&&(this.user.isOrder?this.doAuth(this.MOBILE_HOST+"watch/"+this.$route.params.id):this.doAuth(this.MOBILE_HOST+"guide/"+this.$route.params.id))),"LIVING"===this.activity.status&&(this.user.isApplay&&"APPOINT"===this.activity.viewCondition?this.doAuth(this.MOBILE_HOST+"watch/"+this.$route.params.id):"NONE"===this.activity.viewCondition&&(this.user.isOrder?this.doAuth(this.MOBILE_HOST+"watch/"+this.$route.params.id):this.doAuth(this.MOBILE_HOST+"guide/"+this.$route.params.id)))})}}},u=(i(240),i(1)),p=Object(u.a)(d,s,[],!1,null,"40b23aa5",null);p.options.__file="src/pages/guide/check-state.vue";e.default=p.exports}}]);
//# sourceMappingURL=7.887d4815.js.map