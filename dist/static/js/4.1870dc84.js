(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{184:function(e,t,i){"use strict";t.a={POST_SUBSCRIBE:"/frontend/user/order-activity",GET_LIVEINFO:"/frontend/live/info",GET_SHAREINFO:"/frontend/share/info",GET_QUESTIONINFO:"/frontend/question/info",POST_QUESTIONINFO:"/frontend/user/apply-activity",GET_CREATEACCESSTOKEN:"/common/paas/create-access-token",GET_ONLINENUM:"/frontend/channel/get-online-num",GET_SHARESIGN:"/common/wechat/get-share-sign",GET_SDKTOKEN:"/frontend/live/sdk-token",GET_SEND:"/index/send",GET_SENDANNOUNCEMENT:"/initiator/channel/send-announcement",POST_GAG:"/initiator/user/gag",POST_GAGALL:"/initiator/user/gag-all",POST_KICK:"/initiator/user/kick",POST_EMAILSUBSCRIBE:"/frontend/user/email-subscribe",GET_MESSAGELIST:"/common/paas/message-list",GET_CAPTCHAID:"/common/message/get-captchaid",GET_CODE:"/common/message/send-code",GET_TEMPLATE:"/frontend/live/template",GET_DEFAULEREPLAY:"/frontend/replay/default-replay",GET_WARMINFO:"/manage/warm-up-manage/get"}},185:function(e,t,i){},186:function(e,t,i){"use strict";var s=i(7),o=i.n(s),n=i(11),a=i.n(n),r=i(0),c=i.n(r),l=i(46),h=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"login-container"},[i("com-dialog",{attrs:{visible:e.visible,center:""},on:{"update:visible":function(t){e.visible=t},close:e.closed}},[i("div",[i("div",{staticClass:"rule"},[e._v("登录参与直播互动")]),e._v(" "),i("com-input",{staticClass:"mobile",attrs:{type:"input",placeholder:"请输入手机"},model:{value:e.mobile,callback:function(t){e.mobile=t},expression:"mobile"}}),e._v(" "),i("div",{attrs:{id:"captcha"}}),e._v(" "),i("com-input",{staticClass:"code",attrs:{type:"input",placeholder:"请输入验证码"},model:{value:e.code,callback:function(t){e.code=t},expression:"code"}}),e._v(" "),i("com-button",{staticClass:"codeBtn",attrs:{disabled:!e.codeEnable,type:"primary"},on:{click:e.getCode}},[e._v(e._s(e.codeText))])],1),e._v(" "),i("div",{staticClass:"footer",attrs:{slot:"footer"},slot:"footer"},[i("com-button",{attrs:{type:"primary",disabled:!e.submitEnable},on:{click:e.doLogin}},[e._v("登录")])],1)])],1)};h._withStripped=!0;var d=i(184),u=i(58),p={name:"ComLogin",data:()=>({visible:!1,time:60,captchaIns:null,key:null,verify:!1,mobile:"",code:"",mobileReg:/^1[3|4|5|6|7|8|9][0-9]\d{8}$/,captchaKey:""}),mounted(){this.$get(d.a.GET_CAPTCHAID).then(e=>{this.key=e.data,window.initNECaptcha({element:"#captcha",mode:"float",width:"100%",captchaId:this.key,onVerify:(e,t)=>{e?console.log(e):(this.verify=!0,this.captchaKey=t.validate)}},e=>{this.captchaIns=e},e=>{console.log(e)})})},methods:{getCode(){this.$config({handlers:!0}).$get(d.a.GET_CODE,{mobile:this.mobile,type:"CONSUMER_USER_LOGIN",captcha:this.captchaKey,__errHandler:!0}).then(e=>{this.time--,this.timer=setInterval(()=>{this.time--,0===this.time&&(clearInterval(this.timer),this.time=60)},1e3),console.log(e)})},doLogin(){this.$config({handlers:!0}).$post(u.a.POST_MOBILELOGIN,{mobile:this.mobile,code:this.code,wechatAuth:sessionStorage.getItem("wechatAuth"),__errHandler:!0}).then(e=>{this.$parent.updateLoginInfo(e.data),this.visible=!1,this.closed(),this.$emit("login",e.data)}).catch(()=>{this.verify=!1,this.captchaKey="",this.captchaIns.refresh()})},closed(){this.mobile="",this.time=60,this.verify=!1,this.captchaKey="",this.captchaIns.refresh(),clearInterval(this.timer)}},computed:{codeText(){return this.codeEnable||60===this.time?"发送验证码":`倒计时${this.time}秒`},codeEnable(){return this.mobileReg.test(this.mobile)&&this.verify&&60===this.time},submitEnable(){return this.mobileReg.test(this.mobile)&&this.verify&&this.code}}},m=(i(187),i(1)),g=Object(m.a)(p,h,[],!1,null,"9f4e7bf2",null);g.options.__file="src/components/login-box.vue";var v=g.exports;c.a.use(l.a);const f=new c.a;t.a={components:{ComLogin:v},data:()=>({login:null}),mounted(){this.login=this.$children.find(e=>"ComLogin"===e.$options.name),this.$route.meta.pop&&(this.$route.meta.pop=!1,this.login.visible=!0)},methods:{getAuthInfo:()=>sessionStorage.getItem("wechatAuth"),getLoginInfo:()=>JSON.parse(sessionStorage.getItem("login")),doAuth(e){let t=location.href;e&&(t=e),sessionStorage.getItem("wechatAuth")?location.href=t:(console.log(t),location.href=`/api/frontend/user/wechat-login?backUrl=${encodeURIComponent(t)}`)},doLogin(e){if(sessionStorage.getItem("wechatAuth"))this.login.visible=!0;else{let t=location.href;"string"==typeof e&&(t=e),-1===t.indexOf("?")?t+="?_pop=true":t+="&_pop=true",location.href=`/api/frontend/user/wechat-login?backUrl=${encodeURIComponent(t)}`}},updateLoginInfo(e){e?sessionStorage.setItem("login",a()(e)):(sessionStorage.removeItem("login"),sessionStorage.removeItem("wechatAuth"))},getMasterInfo:e=>new o.a((e,t)=>{sessionStorage.getItem("master")?e(JSON.parse(sessionStorage.getItem("master"))):f.$config({loading:!0,handlers:!0}).$get(u.a.GET_JOININFO).then(t=>{sessionStorage.setItem("master",a()(t.data)),e(t.data)}).catch(e=>{t(e)})})}}},187:function(e,t,i){"use strict";var s=i(185);i.n(s).a},190:function(e,t,i){},191:function(e,t,i){},200:function(e,t,i){"use strict";var s=i(190);i.n(s).a},202:function(e,t,i){"use strict";var s=i(191);i.n(s).a},204:function(e,t,i){},205:function(e,t,i){},234:function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"input-form"},[i("label",{staticClass:"v-label"},[e._v("\n    "+e._s(e.label)+"\n  ")]),e._v(" "),i("com-input",{class:{warning:e.errorMsg},attrs:{value:e.val,placeholder:e.placeholder,type:"input","max-length":e.maxLength,"error-tips":e.errorMsg,disabled:e.isDisabled},on:{"update:value":function(t){e.val=t},focus:e.inputFocus}})],1)};s._withStripped=!0;var o={props:{label:String,inputVal:String,placeholder:String,errorMsg:String,maxLength:Number,isDisabled:String},data:()=>({val:""}),mounted(){},components:{},created(){},watch:{val:{handler(e){this.$emit("update:inputVal",e)},immediate:!0},inputVal:{handler(e){this.val=e},immediate:!0}},methods:{inputFocus(){this.$emit("update:errorMsg","")}}},n=(i(200),i(1)),a=Object(n.a)(o,s,[],!1,null,"5a5e988b",null);a.options.__file="src/components/common/signup/com-input.vue";t.a=a.exports},235:function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"v-vercode"},[i("div",{attrs:{id:"captcha"}}),e._v(" "),i("div",{staticClass:"v-input-from"},[i("com-input",{class:{warning:e.errorMsg},attrs:{value:e.val,placeholder:e.placeholder,type:"input","max-length":e.maxLength,"error-tips":e.errorMsg,codeType:e.codeType},on:{"update:value":function(t){e.val=t},blur:e.pushCode,focus:e.inputFocus}}),e._v(" "),i("a",{staticClass:"v-getcode",class:{prohibit:e.isProhibit},attrs:{href:"javascript:;"},on:{click:function(t){e.getCode()}}},[e._v("获取验证码"),i("span",{directives:[{name:"show",rawName:"v-show",value:e.isSend,expression:"isSend"}],staticClass:"v-getcode-span"},[e._v("("),i("em",[e._v(e._s(e.second))]),e._v("s)")])])],1)])};s._withStripped=!0;var o=i(184),n={props:{code:String,phone:String,isGetCode:Boolean,placeholder:String,maxLength:Number,errorMsg:String,codeType:String},data:()=>({key:"",isProhibit:!0,isSend:!1,second:60,timerr:"",phoneKey:"",isImg:!1,cap:null,val:""}),mounted(){console.log(this.phone)},components:{},created(){this.$get(o.a.GET_CAPTCHAID).then(e=>{let t=this;this.key=e.data,window.initNECaptcha({captchaId:t.key,element:"#captcha",mode:"float",width:"100%",onReady:function(e){},onVerify:function(e,i){i&&(t.phoneKey=i.validate,t.isImg=!0),e&&console.log(e)},onError:function(){}},function(e){t.cap=e})})},destroyed(){clearInterval(this.timerr)},watch:{phone:function(e){this.isGetCodePermission(!0)},isImg:function(e){this.isGetCodePermission()},isGetCode:function(){this.isGetCode&&(clearInterval(this.timerr),this.isSend=!1,this.isProhibit=!0,this.second=60,this.isImg=!1,this.phoneKey="",this.cap.refresh())},val:{handler(e){this.$emit("update:code",e)},immediate:!0}},methods:{getCode(){if(this.isProhibit)return!1;let e={mobile:this.phone,type:this.codeType,captcha:this.phoneKey,__errHandler:!0};this.$config({handlers:!0}).$get(o.a.GET_CODE,e).then(e=>{this.isSend=!0,this.isProhibit=!0,clearInterval(this.timerr),this.timerr=setInterval(()=>{this.second--,this.second<=0&&(clearInterval(this.timerr),this.isSend=!1,this.isProhibit=!0,this.second=60,this.isImg=!1,this.phoneKey="",this.cap.refresh())},1e3)}).catch(e=>{10050===e.code?this.$emit("update:errorMsg","验证码输入过于频繁"):200!==e.code&&this.$emit("update:errorMsg",e.msg)})},isGetCodePermission(e){this.isImg&&this.verificationPhone()?(this.isProhibit=!1,this.second>0&&(this.isSend=!1,this.isProhibit=!1,this.second=60,this.mobileOpacity=1,clearInterval(this.timerr),e&&(this.isImg=!1,this.phoneKey="",this.cap.refresh()))):this.isProhibit=!0},pushCode(){this.$emit("inputFocus",this.code)},inputFocus(){this.$emit("update:errorMsg","")},verificationPhone(){return console.log(this.phone),!(""===this.phone||!/^1[3|4|5|6|7|8|9][0-9]\d{8}$/.test(this.phone))}}},a=(i(202),i(1)),r=Object(a.a)(n,s,[],!1,null,"15c0d488",null);r.options.__file="src/components/common/signup/com-code.vue";t.a=r.exports},239:function(e,t,i){"use strict";var s=i(204);i.n(s).a},241:function(e,t,i){"use strict";var s=i(205);i.n(s).a},292:function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"v-signup"},[i("p",{staticClass:"v-title"},[e._v("\n    为了更好的接收活动直播提醒，请填写如下信息：\n  ")]),e._v(" "),"APPOINT"===e.activity.viewCondition?i("div",{staticClass:"v-operation"},[e._l(e.questionList,function(t){return["mobile"===t.type?[e.user.isDisabled?i("com-input",{attrs:{inputVal:e.user.phone,placeholder:t.placeholder,errorMsg:t.errorMsg,maxLength:11,isDisabled:"disabled"},on:{"update:inputVal":function(t){e.$set(e.user,"phone",t)},"update:errorMsg":function(i){e.$set(t,"errorMsg",i)}}}):i("com-input",{attrs:{inputVal:t.val,placeholder:t.placeholder,errorMsg:t.errorMsg,maxLength:11},on:{"update:inputVal":function(i){e.$set(t,"val",i)},"update:errorMsg":function(i){e.$set(t,"errorMsg",i)}}}),e._v(" "),e.user.isDisabled?e._e():i("com-verification-code",{attrs:{inputVal:e.code,code:e.code,phone:t.val,isGetCode:e.isGetCode,placeholder:"请输入验证码",maxLength:6,errorMsg:e.codeError,codeType:"APPLY_ACTIVITY"},on:{"update:inputVal":function(t){e.code=t},"update:code":function(t){e.code=t},inputFocus:function(t){e.getCode(t)},"update:errorMsg":function(t){e.codeError=t}}})]:"email"===t.type?i("com-input",{attrs:{inputVal:t.val,placeholder:t.placeholder,errorMsg:t.errorMsg},on:{"update:inputVal":function(i){e.$set(t,"val",i)},"update:errorMsg":function(i){e.$set(t,"errorMsg",i)}}}):"integer"===t.type?i("com-input",{attrs:{inputVal:t.val,placeholder:t.placeholder,errorMsg:t.errorMsg},on:{"update:inputVal":function(i){e.$set(t,"val",i)},"update:errorMsg":function(i){e.$set(t,"errorMsg",i)}}}):"select"===t.type?i("com-select",{attrs:{selectOptions:t.detail},on:{selected:function(i){e.selected(i,t.id)}}}):"text"===t.type?i("com-input",{attrs:{inputVal:t.val,placeholder:t.placeholder,errorMsg:t.errorMsg},on:{"update:inputVal":function(i){e.$set(t,"val",i)},"update:errorMsg":function(i){e.$set(t,"errorMsg",i)}}}):e._e()]}),e._v(" "),i("button",{staticClass:"primary-button",on:{click:e.submitAppoint}},[e._v("提交")])],2):i("div",{staticClass:"v-operation"},[e.user.isDisabled?i("com-input",{attrs:{inputVal:e.user.phone,placeholder:"请输入手机号",maxLength:11,isDisabled:"disabled",errorMsg:e.phoneError},on:{"update:inputVal":function(t){e.$set(e.user,"phone",t)},"update:errorMsg":function(t){e.phoneError=t}}}):i("com-input",{attrs:{inputVal:e.user.phone,placeholder:"请输入手机号",maxLength:11,errorMsg:e.phoneError},on:{"update:inputVal":function(t){e.$set(e.user,"phone",t)},"update:errorMsg":function(t){e.phoneError=t}}}),e._v(" "),e.user.isDisabled?e._e():i("com-verification-code",{attrs:{phone:e.user.phone,inputVal:e.code,code:e.code,isGetCode:e.isGetCode,placeholder:"输入验证码",maxLength:6,errorMsg:e.codeError,codeType:"CONSUMER_USER_LOGIN"},on:{"update:inputVal":function(t){e.code=t},"update:code":function(t){e.code=t},inputFocus:function(t){e.getCode(t)},"update:errorMsg":function(t){e.codeError=t}}}),e._v(" "),i("button",{staticClass:"primary-button",on:{click:e.submit}},[e._v("提交")])],1),e._v(" "),e._m(0)])};s._withStripped=!0;var o=i(11),n=i.n(o),a=i(234),r=i(235),c=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"v-select"},[i("el-select",{attrs:{placeholder:"请选择"},model:{value:e.val,callback:function(t){e.val=t},expression:"val"}},e._l(e.selectOptions,function(e){return i("el-option",{key:e.id,attrs:{label:e.value,value:e.key}})}))],1)};c._withStripped=!0;var l={props:{selectOptions:Array},data:()=>({val:""}),mounted(){},components:{},created(){},watch:{val:function(){this.$emit("selected",this.val)}},methods:{}},h=(i(239),i(1)),d=Object(h.a)(l,c,[],!1,null,"3eb9eb8b",null);d.options.__file="src/components/common/signup/com-select.vue";var u=d.exports,p=i(186),m=i(184),g=i(58),v={mixins:[p.a],data:()=>({code:"",isGetCode:!0,activity:{viewCondition:"APPOINT",status:""},questionList:[],codeError:"",phoneError:"",user:{phone:"",isApplay:!1,isOrder:!1,isDisabled:!1},selectVal:[]}),mounted(){},components:{"com-input":a.a,"com-verification-code":r.a,"com-select":u},created(){this.getActivity();let e=JSON.parse(sessionStorage.getItem("login"));e&&(this.user.phone=e.mobile,this.user.phone&&(this.user.isDisabled=!0))},watch:{},methods:{getCode(e){this.code=e},selected(e,t){let i=!1;for(let s=0;s<this.selectVal.length;s++)if(this.selectVal[s].questionId===t)return this.selectVal[s].answer=e,i=!0,!1;if(!i){let i=[];i.questionId=t,i.answer=e,this.selectVal.push(i)}},submitAppoint(){let e=!0,t={activityId:this.$route.params.id,answer:[],__errHandler:!0};if(this.questionList.forEach(i=>{if(e&&!this.verification(i.val,i.required,i.type)){switch(i.type){case"mobile":i.errorMsg="请正确填写手机号";break;case"email":i.errorMsg="请正确填写邮箱";break;default:i.errorMsg="请正确填写表格"}e=!1}if("mobile"===i.type){t.mobile=""===this.user.phone?i.val:this.user.phone;let e={};e.questionId=i.id,e.answer=t.mobile,t.answer.push(e)}else if("select"!==i.type){let e={};e.questionId=i.id,e.answer=i.val,t.answer.push(e)}}),e){if(this.user.isDisabled||(this.verification(this.code,"Y","integer")||(this.codeError="请输入正确验证码"),t.code=this.code),this.selectVal)for(let e=0;e<this.selectVal.length;e++){let i={};i.questionId=this.selectVal[e].questionId,i.answer=this.selectVal[e].answer,t.answer.push(i)}this.$post(m.a.POST_QUESTIONINFO,t).then(e=>{this.$router.replace("/Success/"+this.$route.params.id)})}},getActivity(){this.$config({handlers:!0}).$get(m.a.GET_LIVEINFO,{activityId:this.$route.params.id}).then(e=>{this.activity.viewCondition=e.data.activity.viewCondition,this.activity.status=e.data.activity.status,this.user.isApplay=e.data.joinInfo.isApplay,this.user.isOrder=e.data.joinInfo.isOrder,"APPOINT"===this.activity.viewCondition&&this.getQuestionLists()})},subScribe(){let e={activityId:this.$route.params.id};this.$config({handlers:!0}).$post(m.a.POST_SUBSCRIBE,e).then(e=>{this.$router.replace("/Success/"+this.$route.params.id)}).catch(e=>{this.$messageBox({header:"提示",content:e.msg,confirmText:"确定",handleClick:e=>{"cancel"===e.action||e.action}})})},submit(){return this.verification(this.user.phone,"Y","mobile")?this.user.isDisabled||this.verification(this.code,"Y","integer")?void(this.user.isOrder||this.user.isDisabled?this.subScribe():this.$config({handlers:!0}).$post(g.a.POST_MOBILELOGIN,{mobile:this.user.phone,code:this.code,wechatAuth:sessionStorage.getItem("wechatAuth")}).then(e=>{200===e.code&&(e.data?(sessionStorage.setItem("login",n()(e.data)),this.$config({handlers:!0}).$get(m.a.GET_LIVEINFO,{activityId:this.$route.params.id}).then(e=>{e.data.joinInfo.isOrder?this.$router.replace("/Success/"+this.$route.params.id):this.subScribe()}).catch(e=>{this.$messageBox({header:"提示",content:e.msg,confirmText:"确定",handleClick:e=>{"cancel"===e.action||e.action}})})):(this.$messageBox({header:"提示",content:e.msg,confirmText:"确定",handleClick:e=>{"cancel"===e.action||e.action}}),sessionStorage.removeItem("login"),sessionStorage.removeItem("wechatAuth")))})):(this.codeError="请输入正确验证码",!1):(this.phoneError="请正确填写手机号",!1)},getQuestionLists(){this.$get(m.a.GET_QUESTIONINFO,{activityId:this.$route.params.id}).then(e=>{this.questionList=e.data.questionList.map(e=>(e.val="",e.errorMsg="",e))})},verification(e,t,i){let s=/^1[3|4|5|6|7|8|9][0-9]\d{8}$/,o=/^[A-Za-z\d]+([-_.][A-Za-z\d]+)*@([A-Za-z\d]+[-.])+[A-Za-z\d]{2,4}$/,n=/^[0-9]*$/;if("mobile"===i&&(e=""===this.user.phone?e:this.user.phone),""===e){if("Y"===t)return!1}else switch(i){case"mobile":return e=""===this.user.phone?e:this.user.phone,s.test(e);case"integer":return n.test(e);case"email":return o.test(e)}return!0}}},f=(i(241),Object(h.a)(v,s,[function(){var e=this.$createElement,t=this._self._c||e;return t("p",{staticClass:"v-explain"},[this._v("\n    我已阅读并遵守"),t("span",{staticClass:"v-blue"},[this._v("《服务条款》")])])}],!1,null,"052ec8c4",null));f.options.__file="src/pages/guide/sign-up.vue";t.default=f.exports}}]);
//# sourceMappingURL=4.1870dc84.js.map