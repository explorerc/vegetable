(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{263:function(e,t,o){},264:function(e,t,o){},338:function(e,t,o){"use strict";var n=o(263);o.n(n).a},340:function(e,t,o){"use strict";var n=o(264);o.n(n).a},357:function(e,t,o){"use strict";o.r(t);var n=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"v-user-info"},[n("a",{staticClass:"v-return-user clearfix",attrs:{href:e.MOBILE_HOST+"user"}},[n("i",{staticClass:"iconfont icon-jiantouzuo fl"}),e._v("个人中心\n  ")]),e._v(" "),n("div",{staticClass:"v-list"},[n("a",{staticClass:"v-item v-avatar clearfix",on:{click:e.upload}},[n("ve-upload",{ref:"uploadFile",attrs:{title:"图片支持jpg、png、bmp格式，建议比例16:9，大小不超过2M",accept:"png|jpg|jpeg|bmp",defaultImg:e.defaultImg,fileSize:2048},on:{error:e.uploadError,success:e.uploadImgSuccess}}),e._v(" "),n("span",{staticClass:"v-title"},[e._v("\n        头像\n      ")]),e._v(" "),n("i",{staticClass:"iconfont icon-jiantou1 fr"}),e._v(" "),n("img",{staticClass:"fr",attrs:{src:e.defaultImg,alt:""}})],1),e._v(" "),n("a",{staticClass:"v-item clearfix",attrs:{href:e.MOBILE_HOST+"userInfoEdit/name"}},[n("span",{staticClass:"v-title"},[e._v("\n        昵称\n      ")]),e._v(" "),n("i",{staticClass:"iconfont icon-jiantou1 fr"}),e._v(" "),n("span",{staticClass:"v-content fr"},[e._v("\n        "+e._s(e.centerInfo.consumerUser.nickName?e.centerInfo.consumerUser.nickName:"未填写")+"\n      ")])]),e._v(" "),n("a",{staticClass:"v-item clearfix",attrs:{href:"javascript:;"},on:{click:e.changeMobile}},[n("span",{staticClass:"v-title"},[e._v("\n        手机号\n      ")]),e._v(" "),n("i",{staticClass:"iconfont icon-jiantou1 fr"}),e._v(" "),n("span",{staticClass:"v-content fr"},[e._v("\n        "+e._s(e.centerInfo.consumerUser.mobile?e.centerInfo.consumerUser.mobile:"未填写")+"\n      ")])]),e._v(" "),n("a",{staticClass:"v-item clearfix",attrs:{href:e.MOBILE_HOST+"userInfoEdit/email"}},[n("span",{staticClass:"v-title"},[e._v("\n        邮箱\n      ")]),e._v(" "),n("i",{staticClass:"iconfont icon-jiantou1 fr"}),e._v(" "),n("span",{staticClass:"v-content fr"},[e._v("\n        "+e._s(e.centerInfo.consumerUser.email?e.centerInfo.consumerUser.email:"未填写")+"\n      ")])])]),e._v(" "),n("com-login",{on:{login:e.loginSuccess}}),e._v(" "),n("message-box",{directives:[{name:"show",rawName:"v-show",value:e.messageBoxShow,expression:"messageBoxShow"}],staticClass:"message-box",attrs:{confirmText:e.confirmText,type:"prompt",header:""},on:{handleClick:e.messageBoxClick}},["initialPhone"===e.step||"newPhone"===e.step?n("div",[n("div",{staticClass:"rule"},[e._v(e._s(e.messageBoxTitle))]),e._v(" "),e.isOldphone?n("com-input",{staticClass:"v-input",attrs:{value:e.centerInfo.consumerUser.mobile,placeholder:"输入原有注册手机号",disabled:"disabled"},on:{"update:value":function(t){e.$set(e.centerInfo.consumerUser,"mobile",t)}}}):e._e(),e._v(" "),e.isOldphone?e._e():n("com-input",{staticClass:"v-input",attrs:{value:e.saveNewPhone,placeholder:"输入新手机号",type:"mobile","max-length":11,errorTips:e.errorTips.newPhone},on:{"update:value":function(t){e.saveNewPhone=t},focus:function(t){e.phoneFocus("newphone")}}}),e._v(" "),n("div",{attrs:{id:"captchaChangeMobile"}}),e._v(" "),n("div",{staticClass:"v-getcode-from clearfix"},[n("com-input",{staticClass:"v-input phone-code",attrs:{value:e.phoneCode,placeholder:"输入验证码",type:"mobile","max-length":6,errorTips:e.errorTips.code},on:{"update:value":function(t){e.phoneCode=t},focus:e.codeFocus}}),e._v(" "),n("a",{staticClass:"phone-code-btn ",class:{prohibit:e.isProhibit},attrs:{href:"javascript:;"},on:{click:function(t){e.getCode()}}},[e._v(e._s(e.codeText)+"\n        ")])],1)],1):e._e(),e._v(" "),"phoneSuccess"===e.step?n("div",[n("img",{staticClass:"v-success-img",attrs:{src:o(229),alt:"成功"}}),e._v(" "),n("p",{staticClass:"v-success-explain"},[e._v("\n        修改成功\n      ")])]):e._e()])],1)};n._withStripped=!0;var s=o(17),i=o.n(s),r=o(12),a=o.n(r),c=o(226),l=o(50),h=o(3),p=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{directives:[{name:"ComLoading",rawName:"v-ComLoading",value:e.loading,expression:"loading"}],staticClass:"ve-upload-box"},[e.fileSrc||!e.fileSrc&&e.coverImg?o("div",{staticClass:"upload-img-box"},[o("transition",{attrs:{name:"fade"}},[e.fileSrc?o("div",{staticClass:"temp-img",style:{backgroundImage:"url("+e.imgHost+"/"+e.fileSrc+")"}}):e._e(),e._v(" "),!e.fileSrc&&e.coverImg?o("div",{staticClass:"temp-img",style:{backgroundImage:"url("+e.coverImg+")"}}):e._e()]),e._v(" "),o("div",{staticClass:"over-upload"},[o("span",{on:{click:function(t){return t.stopPropagation(),e.deleteImage(t)}}},[o("i",{staticClass:"iconfont icon-icon-shanchu"}),e._v("\n        删除\n      ")]),e._v(" "),o("span",{on:{click:function(t){return t.stopPropagation(),e.overUpload(t)}}},[o("i",{staticClass:"iconfont icon-yulanxuanzhuan"}),e._v("\n        重置\n      ")])])],1):e._e(),e._v(" "),o("com-upload",{attrs:{accept:e.accept,actionUrl:"/api/upload/image",inputName:"file",fileSize:e.fileSize},on:{error:e.uploadError,selected:e.selected,progress:e.uploadProgress,load:e.uploadImgSuccess}},[o("div",{directives:[{name:"show",rawName:"v-show",value:!(e.fileSrc||!e.fileSrc&&e.coverImg),expression:"!(fileSrc||(!fileSrc && coverImg))"}],ref:"uploadFile",staticClass:"upload-file-box",attrs:{title:"点击上传"}},[o("i",{staticClass:"upload-icon"}),e._v(" "),e.errorTxt?o("span",{staticClass:"error-msg"},[e._v(e._s(e.errorTxt))]):o("span",{domProps:{innerHTML:e._s(e.tipTxt)}})])])],1)};p._withStripped=!0;var u={name:"ve-upload-image",components:{ComUpload:o(71).a},data:function(){return{imgHost:"",fileSrc:"",coverImg:"",tipTxt:"",percentImg:0,errorTxt:"",loading:!1}},props:{accept:{type:String,default:"png|jpg|jpeg|bmp|gif|doc|mp4"},fileSize:{type:Number,default:1024},defaultImg:{type:String,default:""},title:{type:String,default:"上传文件"},errorMsg:{type:String,default:""}},watch:{errorMsg:function(e){this.errorTxt=e,e.length&&(this.fileSrc="",this.coverImg="")},defaultImg:{handler:function(e){this.coverImg=e,e||(this.fileSrc="")},immediate:!0},title:{handler:function(e){this.tipTxt=e},immediate:!0}},methods:{deleteImage:function(){this.coverImg="",this.fileSrc="",this.errorTxt="",this.$emit("success",{name:"",host:""})},overUpload:function(){this.$refs.uploadFile.click()},selected:function(){console.log("selected"),this.loading=!0},uploadProgress:function(e){this.loading=!1,this.percentImg=parseFloat(parseFloat(e.percent.replace("%","")).toFixed(2)),100===this.percentImg&&(this.percentImg=0)},uploadImgSuccess:function(e){var t=JSON.parse(e.data).data;t.host&&(this.imgHost=t.host),t.name&&(this.fileSrc=t.name),this.$emit("success",t)},uploadError:function(e){this.loading=!1;var t=e.data[0].state,o="";o="size-limit"===t?"上传图片过大":"type-limit"===t?"不支持该格式，请重新上传":"图片上传失败",this.fileSrc="",this.coverImg="",this.$emit("error",{type:t,msg:o})}}},f=(o(338),o(1)),m=Object(f.a)(u,p,[],!1,null,"1fb9a34e",null);m.options.__file="src/components/common/ve-upload-image.vue";var d=m.exports,v=o(72),g=o(225),I={mixins:[c.a],data:function(){return{MOBILE_HOST:"//test-zhike.vhall.com/m/",messageBoxShow:!1,confirmText:"提交",messageBoxTitle:"修改手机号",step:"initialPhone",isOldphone:!0,phone:"",newPhone:"",saveNewPhone:"",phoneStatus:!1,phoneCode:"",phoneCodeError:"",phoneCodeTip:"",isProhibit:"",second:60,codeText:"获取验证码",errorTips:{oldPhone:"",newPhone:"",code:""},phoneKey:"",isImg:"",cap:""}},components:{"ve-upload":d},created:function(){var e=this;this.getLoginInfo()?(this.storeLoginInfo(this.getLoginInfo()),this.centerInfo.consumerUser.consumerUserId||this.$config({handlers:!0}).$post(v.a.GET_CENTER_INFO,{}).then(function(t){e.storeCenterInfo(t.data),e.phone=e.centerInfo.consumerUser.mobile}).catch(function(t){e.$messageBox({header:"提示",content:t.msg,confirmText:"确定",handleClick:function(t){"cancel"===t.action?e.$router.replace("/user"):"confirm"===t.action&&e.$router.replace("/user")}})}),this.$config({handlers:!0}).$get(g.a.GET_CAPTCHAID).then(function(t){e.key=t.data}).catch(function(t){e.$messageBox({header:"提示",content:t.msg,confirmText:"确定",handleClick:function(e){"cancel"===e.action||e.action}})})):location.replace(this.MOBILE_HOST+"user")},computed:a()({},Object(l.c)("login",{centerInfo:function(e){return e.centerInfo},loginInfo:function(e){return e.loginInfo}}),{defaultImg:function(){return this.centerInfo.consumerUser.avatar?this.$imgHost+"/"+this.centerInfo.consumerUser.avatar:""}}),props:{},watch:{phone:function(){this.checkPhone(this.centerInfo.consumerUser.mobile)},newPhone:function(){this.checkPhone(this.newPhone)},saveNewPhone:function(){this.checkPhone(this.saveNewPhone)},phoneStatus:function(e){this.isGetCodePermission(!0)},isImg:function(e){this.isGetCodePermission()}},methods:a()({},Object(l.b)("login",{storeCenterInfo:h.b,storeLoginInfo:h.h}),{loginSuccess:function(e){this.storeLoginInfo(e),this.$router.go(0)},upload:function(){this.$refs.uploadFile.overUpload()},uploadImgSuccess:function(e){var t=this;this.$config({handlers:!0}).$get(v.a.POST_CENTER_UPDATE,{avatar:e.name}).then(function(o){var n=JSON.parse(i()(t.centerInfo));n.avatar=e.name,t.storeLoginInfo(n);var s=JSON.parse(i()(t.centerInfo));s.consumerUser.avatar=e.name,t.storeCenterInfo(s)}).catch(function(e){t.$messageBox({header:"提示",content:e.msg,confirmText:"确定",handleClick:function(e){"cancel"===e.action||e.action}})})},uploadError:function(e){this.$messageBox({header:"提示",content:e,confirmText:"确定",handleClick:function(e){"cancel"===e.action||e.action}})},changeMobile:function(){this.messageBoxShow=!0,this.confirmText="提交";var e=this;window.initNECaptcha({captchaId:e.key,element:"#captchaChangeMobile",mode:"float",width:"100%",onReady:function(e){},onVerify:function(t,o){o&&(e.phoneKey=o.validate,e.isImg=!0),t&&console.log(t)},onError:function(e){console.log(e)}},function(t){e.cap=t})},messageBoxClick:function(e){var t=this;if("cancel"===e.action)this.messageBoxShow=!1;else if("confirm"===e.action)if("initialPhone"===this.step){if(!this.centerInfo.consumerUser.mobile)return this.errorTips.oldPhone="请输入手机号",!1;if(!/^1[3|4|5|6|7|8|9][0-9]\d{8}$/.test(parseInt(this.phone)))return this.errorTips.oldPhone="手机格式不正确",!1;if(!this.phoneCode)return this.errorTips.code="请输入验证码",!1;var o={mobile:this.centerInfo.consumerUser.mobile,code:this.phoneCode,type:"CONSUMER_USER_VERIFY_MOBILE"};this.$config({handlers:!0}).$post(v.a.POST_VERIFY_MOBILE,o).then(function(e){t.errorTips.code=e.msg,t.token=e.data.codeToken,t.fontColor="#4B5AFE",t.messageBoxExplain="验证成功，请输入新的手机号",t.phoneCode="",t.isOldphone=!1,t.step="newPhone",clearInterval(t.timerr),t.codeText="获取验证码",t.isProhibit=!0,t.second=60,t.isImg=!1,t.phoneKey="",t.cap.refresh()}).catch(function(e){t.errorTips.code=e.msg})}else if("newPhone"===this.step){if(!this.saveNewPhone)return this.errorTips.newPhone="请输入新手机号",!1;if(!/^1[3|4|5|6|7|8|9][0-9]\d{8}$/.test(parseInt(this.saveNewPhone)))return this.errorTips.newPhone="新手机号格式不正确",!1;if(!this.phoneCode)return this.errorTips.code="请输入验证码",!1;var n={mobile:this.saveNewPhone,codeToken:this.token,code:this.phoneCode};this.$config({handlers:!0}).$post(v.a.POST_UPDATE_MOBILE,n).then(function(e){t.step="phoneSuccess",t.confirmText="完成",t.accountPhone=t.saveNewPhone,t.newPhone=t.saveNewPhone,t.saveNewPhone="";var o=JSON.parse(i()(t.centerInfo));o.mobile=n.mobile,t.storeLoginInfo(o);var s=JSON.parse(i()(t.centerInfo));s.consumerUser.mobile=n.mobile,t.storeCenterInfo(s)}).catch(function(e){t.errorTips.code=e.msg})}else"phoneSuccess"===this.step&&(this.messageBoxExplain="修改成功",this.step="initialPhone",this.phoneCode="",this.messageBoxShow=!1)},phoneFocus:function(e){switch(e){case"oldphone":this.errorTips.oldPhone="";break;case"newphone":this.errorTips.newPhone=""}},codeFocus:function(){this.errorTips.code=""},getCode:function(){var e=this;if(this.isProhibit)return!1;var t={};t=this.isOldphone?{mobile:this.centerInfo.consumerUser.mobile,type:"CONSUMER_USER_VERIFY_MOBILE",captcha:this.phoneKey}:{mobile:this.saveNewPhone,type:"CONSUMER_USER_UPDATE_MOBILE",captcha:this.phoneKey},this.$config({handlers:!0}).$get(g.a.GET_CODE,t).then(function(t){e.errorTips.code=t.msg,e.isProhibit=!0,clearInterval(e.timerr),e.timerr=setInterval(function(){e.codeText="倒计时"+e.second+"秒",e.second--,e.second<=0&&(clearInterval(e.timerr),e.codeText="获取验证码",e.isProhibit=!1,e.second=60,e.isImg=!1,e.phoneKey="",e.cap.refresh())},1e3)}).catch(function(t){10001===t.code?(e.errorTips.code=t.msg,e.opacity=1,clearInterval(e.timerr),e.codeText="获取验证码",e.isProhibit=!1,e.second=60,e.isImg=!1,e.phoneKey="",e.cap.refresh()):10050===t.code?e.errorTips.code="验证码输入过于频繁":(e.errorTips.code=t.msg,e.opacity=1,clearInterval(e.timerr),e.codeText="获取验证码",e.isProhibit=!1,e.second=60,e.isImg=!1,e.phoneKey="",e.cap.refresh())})},isGetCodePermission:function(e){this.isImg&&this.phoneStatus?(this.isProhibit=!1,this.second>0&&(this.isSend=!1,this.isProhibit=!1,this.second=60,this.mobileOpacity=1,clearInterval(this.timerr),e&&(this.isImg=!1,this.phoneKey="",this.cap.refresh()))):this.isProhibit=!0},checkPhone:function(e){/^1[3|4|5|6|7|8|9][0-9]\d{8}$/.test(parseInt(e))?this.phoneStatus=!0:this.phoneStatus=!1}})},_=(o(340),Object(f.a)(I,n,[],!1,null,"2c16459e",null));_.options.__file="src/pages/user/info.vue";t.default=_.exports}}]);
//# sourceMappingURL=12.051c5b3e.js.map